<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>俄罗斯方块</title><link rel="stylesheet" href="/games/common.css"><style>body{background:#020617;color:#e2e8f0}.wrap{max-width:500px;margin:20px auto;padding:0 12px}canvas{background:#0f172a;border:1px solid #334155;border-radius:8px;display:block;touch-action:none}button{background:#0ea5e9;color:#fff;border:0;border-radius:8px;padding:10px 14px;min-height:44px;font-size:18px}</style></head><body><div class="wrap"><div class="top"><h2>俄罗斯方块</h2><a href="/games/">返回</a></div><p>分数：<span id="s">0</span>｜最高：<span id="b">0</span></p><p>（←→移动，↑旋转，↓加速）</p><canvas id="c" width="300" height="600"></canvas><p><button id="l">←</button> <button id="u">↻</button> <button id="r">→</button> <button id="d">↓</button></p></div><script src="/games/common.js"></script><script>const c=document.getElementById('c'),x=c.getContext('2d'),W=10,H=20,S=30;const shapes=[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]]];let board,cur,pos,score,drop,best=GameStore.getBest('best_tetris');document.getElementById('b').textContent=best;function reset(){board=Array.from({length:H},()=>Array(W).fill(0));score=0;document.getElementById('s').textContent=0;spawn();clearInterval(drop);drop=setInterval(step,450)}function spawn(){cur=JSON.parse(JSON.stringify(shapes[Math.floor(Math.random()*shapes.length)]));pos={x:3,y:0};if(collide(pos.x,pos.y,cur)){if(score>best){best=score;GameStore.setBest('best_tetris',best);document.getElementById('b').textContent=best}alert('游戏结束，得分：'+score);reset()}}function rot(m){return m[0].map((_,i)=>m.map(r=>r[i]).reverse())}function collide(px,py,m){for(let y=0;y<m.length;y++)for(let z=0;z<m[y].length;z++)if(m[y][z]){const nx=px+z,ny=py+y;if(nx<0||nx>=W||ny>=H||(ny>=0&&board[ny][nx]))return true}return false}function merge(){for(let y=0;y<cur.length;y++)for(let z=0;z<cur[y].length;z++)if(cur[y][z])board[pos.y+y][pos.x+z]=1;for(let y=H-1;y>=0;y--){if(board[y].every(v=>v)){board.splice(y,1);board.unshift(Array(W).fill(0));score+=100;document.getElementById('s').textContent=score;y++}}spawn()}function step(){if(!collide(pos.x,pos.y+1,cur))pos.y++;else merge();draw()}function draw(){x.clearRect(0,0,c.width,c.height);for(let y=0;y<H;y++)for(let z=0;z<W;z++){x.fillStyle=board[y][z]?'#38bdf8':'#0f172a';x.fillRect(z*S,y*S,S-1,S-1)}for(let y=0;y<cur.length;y++)for(let z=0;z<cur[y].length;z++)if(cur[y][z]){x.fillStyle='#22c55e';x.fillRect((pos.x+z)*S,(pos.y+y)*S,S-1,S-1)}}window.addEventListener('keydown',e=>{if(e.key==='ArrowLeft'&&!collide(pos.x-1,pos.y,cur))pos.x--;if(e.key==='ArrowRight'&&!collide(pos.x+1,pos.y,cur))pos.x++;if(e.key==='ArrowDown'&&!collide(pos.x,pos.y+1,cur))pos.y++;if(e.key==='ArrowUp'){const r=rot(cur);if(!collide(pos.x,pos.y,r))cur=r}draw()});document.getElementById('l').onclick=()=>{if(!collide(pos.x-1,pos.y,cur))pos.x--;draw()};document.getElementById('r').onclick=()=>{if(!collide(pos.x+1,pos.y,cur))pos.x++;draw()};document.getElementById('d').onclick=()=>{if(!collide(pos.x,pos.y+1,cur))pos.y++;draw()};document.getElementById('u').onclick=()=>{const r=rot(cur);if(!collide(pos.x,pos.y,r))cur=r;draw()};reset();draw();</script></body></html>