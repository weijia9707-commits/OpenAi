<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡æ ¼å¼è½¬æ¢ - åœ¨çº¿å›¾ç‰‡æ ¼å¼æ‰¹é‡è½¬æ¢å·¥å…· | Web Toolbox</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="å…è´¹åœ¨çº¿å›¾ç‰‡æ ¼å¼è½¬æ¢å·¥å…·ï¼Œæ”¯æŒ PNGã€JPEGã€WebPã€GIFã€BMPã€ICO ç­‰æ ¼å¼äº’è½¬ã€‚æ‰¹é‡è½¬æ¢ã€è°ƒèŠ‚è´¨é‡ã€æœ¬åœ°å¤„ç†ä¿æŠ¤éšç§ï¼Œæ— éœ€ä¸Šä¼ æœåŠ¡å™¨ã€‚">
    <meta name="keywords" content="å›¾ç‰‡æ ¼å¼è½¬æ¢,å›¾ç‰‡è½¬æ¢å™¨,PNGè½¬JPG,JPGè½¬PNG,WebPè½¬æ¢,å›¾ç‰‡æ‰¹é‡è½¬æ¢,åœ¨çº¿å›¾ç‰‡è½¬æ¢,å…è´¹å›¾ç‰‡è½¬æ¢">
    <meta name="author" content="heyuan110">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.heyuan110.com/web-toolbox/image-converter.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.heyuan110.com/web-toolbox/image-converter.html">
    <meta property="og:title" content="å›¾ç‰‡æ ¼å¼è½¬æ¢ - åœ¨çº¿å›¾ç‰‡æ ¼å¼æ‰¹é‡è½¬æ¢å·¥å…·">
    <meta property="og:description" content="å…è´¹åœ¨çº¿å›¾ç‰‡æ ¼å¼è½¬æ¢ï¼Œæ”¯æŒ PNGã€JPEGã€WebPã€GIFã€BMP ç­‰æ ¼å¼äº’è½¬ã€‚">
    <meta property="og:image" content="https://www.heyuan110.com/web-toolbox/screenshots/image-converter.png">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="Web Toolbox">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="å›¾ç‰‡æ ¼å¼è½¬æ¢ - åœ¨çº¿å›¾ç‰‡æ ¼å¼æ‰¹é‡è½¬æ¢å·¥å…·">
    <meta name="twitter:description" content="å…è´¹åœ¨çº¿å›¾ç‰‡æ ¼å¼è½¬æ¢ï¼Œæ”¯æŒå¤šç§æ ¼å¼äº’è½¬ã€‚">
    <meta name="twitter:image" content="https://www.heyuan110.com/web-toolbox/screenshots/image-converter.png">

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "å›¾ç‰‡æ ¼å¼è½¬æ¢",
        "url": "https://www.heyuan110.com/web-toolbox/image-converter.html",
        "description": "åœ¨çº¿å›¾ç‰‡æ ¼å¼è½¬æ¢å·¥å…·ï¼Œæ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼äº’è½¬",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CNY"},
        "author": {"@type": "Person", "name": "heyuan110"}
    }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e4e4e7;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* è¿”å›æŒ‰é’® */
        .back-home {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #a1a1aa;
            text-decoration: none;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 20px;
        }

        .back-home:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        /* æ ‡é¢˜ */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(120deg, #00d4ff, #7c3aed, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a1a1aa;
            font-size: 0.95rem;
        }

        /* ä¸»é¢æ¿ */
        .converter-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 50px 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 25px;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #7c3aed;
            background: rgba(124, 58, 237, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #d4d4d8;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #71717a;
            font-size: 0.9rem;
        }

        .upload-btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.2s ease;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #8b5cf6, #818cf8);
            transform: translateY(-2px);
        }

        #fileInput {
            display: none;
        }

        /* æ ¼å¼é€‰æ‹© */
        .format-section {
            margin-bottom: 25px;
        }

        .section-title {
            color: #d4d4d8;
            font-size: 1rem;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .format-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .format-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: #d4d4d8;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .format-btn:hover {
            background: rgba(124, 58, 237, 0.2);
            border-color: #7c3aed;
        }

        .format-btn.active {
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            border-color: transparent;
            color: #fff;
        }

        /* è´¨é‡è®¾ç½® */
        .quality-section {
            margin-bottom: 25px;
            display: none;
        }

        .quality-section.show {
            display: block;
        }

        .quality-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quality-slider {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        .quality-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            border-radius: 50%;
            cursor: pointer;
        }

        .quality-value {
            min-width: 50px;
            text-align: center;
            color: #e4e4e7;
            font-size: 0.95rem;
        }

        /* æ–‡ä»¶åˆ—è¡¨ */
        .file-list {
            margin-bottom: 25px;
        }

        .file-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .file-count {
            color: #a1a1aa;
            font-size: 0.9rem;
        }

        .clear-all-btn {
            padding: 6px 15px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 6px;
            color: #fca5a5;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clear-all-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .file-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .file-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .file-preview {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.05);
        }

        .file-info {
            flex: 1;
            min-width: 0;
        }

        .file-name {
            color: #e4e4e7;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 5px;
        }

        .file-meta {
            color: #71717a;
            font-size: 0.8rem;
        }

        .file-status {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .file-status.pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .file-status.converting {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .file-status.done {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }

        .file-status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .download-btn {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }

        .download-btn:hover {
            background: rgba(34, 197, 94, 0.4);
        }

        .download-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .remove-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .remove-btn:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        /* æ“ä½œæŒ‰é’® */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .action-btn {
            padding: 14px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .convert-btn {
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            color: #fff;
        }

        .convert-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #8b5cf6, #818cf8);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
        }

        .convert-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .download-all-btn {
            background: linear-gradient(135deg, #059669, #10b981);
            color: #fff;
        }

        .download-all-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #10b981, #34d399);
            transform: translateY(-2px);
        }

        .download-all-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ä¿¡æ¯åŒºåŸŸ */
        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .info-section h2 {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 15px;
        }

        .info-section p {
            color: #a1a1aa;
            font-size: 0.95rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .info-section ul, .info-section ol {
            color: #a1a1aa;
            font-size: 0.9rem;
            padding-left: 20px;
        }

        .info-section li {
            margin-bottom: 8px;
        }

        .warning-box {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 10px;
            padding: 15px 20px;
            margin-top: 15px;
            color: #fbbf24;
            font-size: 0.9rem;
        }

        /* æ ¼å¼æ”¯æŒè¯´æ˜ */
        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .format-tag {
            background: rgba(124, 58, 237, 0.15);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            color: #a78bfa;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* éšè—æ–‡ä»¶åˆ—è¡¨æ—¶ */
        .file-list.hidden {
            display: none;
        }

        /* å“åº”å¼ */
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
            }

            h1 {
                font-size: 1.6rem;
            }

            .converter-panel {
                padding: 20px;
            }

            .upload-area {
                padding: 30px 20px;
            }

            .format-btn {
                padding: 8px 15px;
                font-size: 0.85rem;
            }

            .file-items {
                grid-template-columns: 1fr;
            }

            .action-btn {
                padding: 12px 25px;
                font-size: 1rem;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-home">â† è¿”å›å·¥å…·ç®±</a>

        <header>
            <h1>å›¾ç‰‡æ ¼å¼è½¬æ¢</h1>
            <p class="subtitle">æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼äº’è½¬ï¼Œæœ¬åœ°å¤„ç†ä¿æŠ¤éšç§</p>
        </header>

        <div class="converter-panel">
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ–¼ï¸</div>
                <div class="upload-text">æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
                <div class="upload-hint">æ”¯æŒ PNGã€JPGã€JPEGã€WebPã€GIFã€BMP ç­‰æ ¼å¼</div>
                <button class="upload-btn" id="uploadBtn">é€‰æ‹©å›¾ç‰‡</button>
                <input type="file" id="fileInput" accept="image/*" multiple>
            </div>

            <!-- ç›®æ ‡æ ¼å¼ -->
            <div class="format-section">
                <div class="section-title">è½¬æ¢ä¸º</div>
                <div class="format-options" id="formatOptions">
                    <button class="format-btn active" data-format="png">PNG</button>
                    <button class="format-btn" data-format="jpeg">JPEG</button>
                    <button class="format-btn" data-format="webp">WebP</button>
                    <button class="format-btn" data-format="gif">GIF</button>
                    <button class="format-btn" data-format="bmp">BMP</button>
                    <button class="format-btn" data-format="ico">ICO</button>
                </div>
            </div>

            <!-- è´¨é‡è®¾ç½® -->
            <div class="quality-section" id="qualitySection">
                <div class="section-title">å›¾ç‰‡è´¨é‡</div>
                <div class="quality-row">
                    <input type="range" class="quality-slider" id="qualitySlider" min="10" max="100" value="90">
                    <span class="quality-value" id="qualityValue">90%</span>
                </div>
            </div>

            <!-- æ–‡ä»¶åˆ—è¡¨ -->
            <div class="file-list hidden" id="fileList">
                <div class="file-list-header">
                    <span class="file-count" id="fileCount">å·²é€‰æ‹© 0 ä¸ªæ–‡ä»¶</span>
                    <button class="clear-all-btn" id="clearAllBtn">æ¸…ç©ºå…¨éƒ¨</button>
                </div>
                <div class="file-items" id="fileItems"></div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="action-buttons">
                <button class="action-btn convert-btn" id="convertBtn" disabled>å¼€å§‹è½¬æ¢</button>
                <button class="action-btn download-all-btn" id="downloadAllBtn" disabled>æ‰“åŒ…ä¸‹è½½</button>
            </div>
        </div>

        <!-- è¯´æ˜ -->
        <div class="info-section">
            <h2>å…³äºå›¾ç‰‡æ ¼å¼è½¬æ¢</h2>
            <p>åœ¨çº¿å°†å›¾ç‰‡åœ¨å„ä¸ªæ–‡ä»¶æ ¼å¼ä¹‹é—´è½¬æ¢ï¼Œæ”¯æŒå¸¸è§çš„å›¾ç‰‡æ ¼å¼äº’è½¬ã€‚æ‰€æœ‰è½¬æ¢æ“ä½œå‡åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­å®Œæˆï¼Œæ— éœ€ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨ã€‚</p>

            <h2>æ”¯æŒçš„æ ¼å¼</h2>
            <div class="format-grid">
                <span class="format-tag">PNG</span>
                <span class="format-tag">JPEG</span>
                <span class="format-tag">WebP</span>
                <span class="format-tag">GIF</span>
                <span class="format-tag">BMP</span>
                <span class="format-tag">ICO</span>
            </div>

            <div class="warning-box">
                âš ï¸ ç§»åŠ¨è®¾å¤‡æµè§ˆå™¨ä¸Šå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ç”µè„‘æµè§ˆå™¨è¿›è¡Œè½¬æ¢ã€‚
            </div>
        </div>

        <div class="info-section">
            <h2>ä½¿ç”¨è¯´æ˜</h2>
            <ol>
                <li><strong>é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</strong>ï¼š
                    <ul>
                        <li>æ‹–æ‹½æ–‡ä»¶åˆ°è™šçº¿æ¡†å†…</li>
                        <li>ç‚¹å‡»"é€‰æ‹©å›¾ç‰‡"æŒ‰é’®</li>
                    </ul>
                </li>
                <li><strong>é€‰æ‹©ç›®æ ‡æ ¼å¼</strong>ï¼šç‚¹å‡»è¦è½¬æ¢çš„ç›®æ ‡æ ¼å¼æŒ‰é’®</li>
                <li><strong>è°ƒèŠ‚è´¨é‡ï¼ˆå¯é€‰ï¼‰</strong>ï¼šJPEG å’Œ WebP æ ¼å¼æ”¯æŒè´¨é‡è°ƒèŠ‚</li>
                <li><strong>å¼€å§‹è½¬æ¢</strong>ï¼šç‚¹å‡»"å¼€å§‹è½¬æ¢"æŒ‰é’®</li>
                <li><strong>ä¸‹è½½ç»“æœ</strong>ï¼šå•ç‹¬ä¸‹è½½æˆ–æ‰“åŒ…ä¸‹è½½å…¨éƒ¨</li>
            </ol>
        </div>
    </div>

    <!-- JSZip for packaging -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        // çŠ¶æ€
        let files = [];
        let targetFormat = 'png';
        let quality = 0.9;

        // å…ƒç´ 
        const uploadArea = document.getElementById('uploadArea');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const formatOptions = document.getElementById('formatOptions');
        const qualitySection = document.getElementById('qualitySection');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const fileList = document.getElementById('fileList');
        const fileItems = document.getElementById('fileItems');
        const fileCount = document.getElementById('fileCount');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const convertBtn = document.getElementById('convertBtn');
        const downloadAllBtn = document.getElementById('downloadAllBtn');

        // ä¸Šä¼ äº‹ä»¶
        uploadBtn.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('click', (e) => {
            if (e.target === uploadArea || e.target.classList.contains('upload-icon') ||
                e.target.classList.contains('upload-text') || e.target.classList.contains('upload-hint')) {
                fileInput.click();
            }
        });

        fileInput.addEventListener('change', (e) => {
            addFiles(Array.from(e.target.files));
            fileInput.value = '';
        });

        // æ‹–æ‹½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const droppedFiles = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
            addFiles(droppedFiles);
        });

        // æ ¼å¼é€‰æ‹©
        formatOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('.format-btn');
            if (!btn) return;

            document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            targetFormat = btn.dataset.format;

            // æ˜¾ç¤º/éšè—è´¨é‡è®¾ç½®
            if (targetFormat === 'jpeg' || targetFormat === 'webp') {
                qualitySection.classList.add('show');
            } else {
                qualitySection.classList.remove('show');
            }
        });

        // è´¨é‡æ»‘å—
        qualitySlider.addEventListener('input', () => {
            quality = qualitySlider.value / 100;
            qualityValue.textContent = qualitySlider.value + '%';
        });

        // æ·»åŠ æ–‡ä»¶
        function addFiles(newFiles) {
            newFiles.forEach(file => {
                const id = Date.now() + Math.random();
                files.push({
                    id,
                    file,
                    name: file.name,
                    size: file.size,
                    status: 'pending',
                    result: null
                });
            });
            updateFileList();
        }

        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
        function updateFileList() {
            if (files.length === 0) {
                fileList.classList.add('hidden');
                convertBtn.disabled = true;
                downloadAllBtn.disabled = true;
                return;
            }

            fileList.classList.remove('hidden');
            fileCount.textContent = `å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`;
            convertBtn.disabled = false;

            const doneCount = files.filter(f => f.status === 'done').length;
            downloadAllBtn.disabled = doneCount === 0;

            fileItems.innerHTML = files.map(f => `
                <div class="file-item" data-id="${f.id}">
                    <img class="file-preview" src="${URL.createObjectURL(f.file)}" alt="é¢„è§ˆ">
                    <div class="file-info">
                        <div class="file-name">${f.name}</div>
                        <div class="file-meta">${formatSize(f.size)}</div>
                    </div>
                    <span class="file-status ${f.status}">${getStatusText(f.status)}</span>
                    <div class="file-actions">
                        <button class="file-action-btn download-btn" onclick="downloadFile('${f.id}')" ${f.status !== 'done' ? 'disabled' : ''}>â¬‡</button>
                        <button class="file-action-btn remove-btn" onclick="removeFile('${f.id}')">âœ•</button>
                    </div>
                </div>
            `).join('');
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const map = {
                pending: 'ç­‰å¾…ä¸­',
                converting: 'è½¬æ¢ä¸­...',
                done: 'å®Œæˆ',
                error: 'å¤±è´¥'
            };
            return map[status] || status;
        }

        // ç§»é™¤æ–‡ä»¶
        window.removeFile = function(id) {
            files = files.filter(f => f.id != id);
            updateFileList();
        };

        // æ¸…ç©ºå…¨éƒ¨
        clearAllBtn.addEventListener('click', () => {
            files = [];
            updateFileList();
        });

        // å¼€å§‹è½¬æ¢
        convertBtn.addEventListener('click', async () => {
            convertBtn.disabled = true;
            convertBtn.textContent = 'è½¬æ¢ä¸­...';

            for (let f of files) {
                if (f.status === 'done') continue;

                f.status = 'converting';
                updateFileList();

                try {
                    f.result = await convertImage(f.file, targetFormat, quality);
                    f.status = 'done';
                } catch (err) {
                    console.error(err);
                    f.status = 'error';
                }

                updateFileList();
            }

            convertBtn.disabled = false;
            convertBtn.textContent = 'å¼€å§‹è½¬æ¢';
        });

        // è½¬æ¢å›¾ç‰‡
        function convertImage(file, format, quality) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');

                        // éé€æ˜æ ¼å¼éœ€è¦ç™½è‰²èƒŒæ™¯
                        if (format === 'jpeg' || format === 'bmp') {
                            ctx.fillStyle = '#ffffff';
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                        }

                        ctx.drawImage(img, 0, 0);

                        let mimeType = 'image/' + format;
                        if (format === 'ico') {
                            // ICO ç‰¹æ®Šå¤„ç†ï¼šå…ˆç¼©æ”¾åˆ° 256x256ï¼Œç„¶åè¾“å‡º PNG
                            const icoCanvas = document.createElement('canvas');
                            const size = Math.min(256, img.width, img.height);
                            icoCanvas.width = size;
                            icoCanvas.height = size;
                            const icoCtx = icoCanvas.getContext('2d');
                            icoCtx.drawImage(img, 0, 0, size, size);
                            mimeType = 'image/png';
                            canvas.width = size;
                            canvas.height = size;
                            ctx.drawImage(icoCanvas, 0, 0);
                        }

                        canvas.toBlob(blob => {
                            if (blob) {
                                resolve(blob);
                            } else {
                                reject(new Error('è½¬æ¢å¤±è´¥'));
                            }
                        }, mimeType, quality);
                    } catch (err) {
                        reject(err);
                    }
                };
                img.onerror = () => reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                img.src = URL.createObjectURL(file);
            });
        }

        // ä¸‹è½½å•ä¸ªæ–‡ä»¶
        window.downloadFile = function(id) {
            const f = files.find(x => x.id == id);
            if (!f || !f.result) return;

            const ext = targetFormat === 'jpeg' ? 'jpg' : targetFormat;
            const baseName = f.name.replace(/\.[^.]+$/, '');
            const link = document.createElement('a');
            link.href = URL.createObjectURL(f.result);
            link.download = baseName + '.' + ext;
            link.click();
        };

        // æ‰“åŒ…ä¸‹è½½
        downloadAllBtn.addEventListener('click', async () => {
            const doneFiles = files.filter(f => f.status === 'done' && f.result);
            if (doneFiles.length === 0) return;

            downloadAllBtn.disabled = true;
            downloadAllBtn.textContent = 'æ‰“åŒ…ä¸­...';

            try {
                const zip = new JSZip();
                const ext = targetFormat === 'jpeg' ? 'jpg' : targetFormat;

                doneFiles.forEach(f => {
                    const baseName = f.name.replace(/\.[^.]+$/, '');
                    zip.file(baseName + '.' + ext, f.result);
                });

                const content = await zip.generateAsync({ type: 'blob' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = `converted_images_${targetFormat}.zip`;
                link.click();
            } catch (err) {
                console.error(err);
                alert('æ‰“åŒ…å¤±è´¥ï¼š' + err.message);
            }

            downloadAllBtn.disabled = false;
            downloadAllBtn.textContent = 'æ‰“åŒ…ä¸‹è½½';
        });
    </script>
</body>
</html>
