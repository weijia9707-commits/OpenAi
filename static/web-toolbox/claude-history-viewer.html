<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code History Viewer - Online Toolbox</title>
    <meta name="description" content="View and search Claude Code conversation history, supports JSONL format import, beautiful and easy-to-use interface">
    <meta name="keywords" content="Claude Code,history,conversation viewer,AI chat,JSONL,Claude conversation,AI programming assistant">
    <meta name="author" content="*****">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.*****.com/web-toolbox/claude-history-viewer.html">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.*****.com/web-toolbox/claude-history-viewer.html">
    <meta property="og:title" content="Claude Code History Viewer - Online Tool">
    <meta property="og:description" content="View and search Claude Code conversation history, supports JSONL format import.">
    <meta property="og:image" content="https://www.*****.com/web-toolbox/screenshots/claude-history-viewer.png">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Web Toolbox">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Claude Code History Viewer">
    <meta name="twitter:description" content="View and search Claude Code conversation history.">
    <meta name="twitter:image" content="https://www.*****.com/web-toolbox/screenshots/claude-history-viewer.png">

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Claude Code History Viewer",
        "url": "https://www.*****.com/web-toolbox/claude-history-viewer.html",
        "description": "View and search Claude Code conversation history",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Web Browser",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
        "author": {"@type": "Person", "name": "*****"}
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "How to get Claude Code history?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "You can find .jsonl conversation history files in the ~/.claude/projects/ directory."
                }
            },
            {
                "@type": "Question",
                "name": "What file formats are supported?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Only JSONL format files generated by Claude Code are supported."
                }
            },
            {
                "@type": "Question",
                "name": "Can I export conversation content?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "You can copy individual message content. Batch export is not currently supported."
                }
            },
            {
                "@type": "Question",
                "name": "Will history be uploaded to server?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "No, all data is processed locally in your browser."
                }
            },
            {
                "@type": "Question",
                "name": "Can I view tool call details?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes, you can expand to view tool call parameters and return results."
                }
            }
        ]
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #0f3460;
            --bg-hover: #1a4a7a;
            --text-primary: #eee;
            --text-secondary: #aaa;
            --text-muted: #666;
            --accent: #e94560;
            --accent-light: #ff6b6b;
            --success: #4ecdc4;
            --warning: #ffd93d;
            --border: #2a2a4a;
            --user-bg: #2d5a27;
            --assistant-bg: #1e3a5f;
            --tool-bg: #3d2d5a;
            --code-bg: #0d1117;
            --scrollbar: #444;
            --scrollbar-thumb: #666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--scrollbar);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
            padding: 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 32px;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text span {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* è¯­è¨€åˆ‡æ¢å™¨ */
        .lang-switcher { position: absolute; top: 0; right: 0; }
        .lang-dropdown { position: relative; display: inline-block; }
        .lang-current { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; color: #e0e0e0; transition: all 0.3s ease; }
        .lang-current:hover { background: rgba(255,255,255,0.15); }
        .lang-menu { position: absolute; top: 100%; right: 0; margin-top: 4px; background: #1e1e2e; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 4px; min-width: 140px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s ease; z-index: 1000; }
        .lang-dropdown.active .lang-menu { opacity: 1; visibility: visible; transform: translateY(0); }
        .lang-btn { display: block; width: 100%; padding: 10px 16px; background: none; border: none; color: #e0e0e0; font-size: 14px; text-align: left; cursor: pointer; border-radius: 6px; transition: background 0.2s ease; }
        .lang-btn:hover { background: rgba(255,255,255,0.1); }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* ä¸»å¸ƒå±€ */
        .main-container {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            min-height: calc(100vh - 90px);
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 320px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .search-box::after {
            content: 'ğŸ”';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
        }

        .session-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .session-item {
            padding: 12px 15px;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .session-item:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }

        .session-item.active {
            border-color: var(--accent);
            background: var(--bg-hover);
        }

        .session-title {
            font-weight: 500;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .session-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .session-project {
            color: var(--success);
            font-size: 0.7rem;
            margin-top: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .upload-box {
            text-align: center;
            padding: 60px 40px;
            border: 2px dashed var(--border);
            border-radius: 16px;
            background: var(--bg-secondary);
            max-width: 600px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .upload-box:hover,
        .upload-box.drag-over {
            border-color: var(--accent);
            background: var(--bg-card);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .upload-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .upload-desc {
            color: var(--text-secondary);
            margin-bottom: 25px;
        }

        .upload-hint {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 20px;
        }

        .upload-hint code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        /* å¯¹è¯è§†å›¾ */
        .conversation-view {
            flex: 1;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .conversation-header {
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conversation-title {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .conversation-info {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .conversation-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* æ¶ˆæ¯æ ·å¼ */
        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .message-user .message-avatar {
            background: var(--user-bg);
        }

        .message-assistant .message-avatar {
            background: var(--assistant-bg);
        }

        .message-tool .message-avatar {
            background: var(--tool-bg);
        }

        .message-role {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .message-content {
            padding: 15px 20px;
            border-radius: 12px;
            margin-left: 42px;
            line-height: 1.7;
        }

        .message-user .message-content {
            background: var(--user-bg);
            border-left: 3px solid #4caf50;
        }

        .message-assistant .message-content {
            background: var(--assistant-bg);
            border-left: 3px solid #2196f3;
        }

        .message-tool .message-content {
            background: var(--tool-bg);
            border-left: 3px solid #9c27b0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
        }

        .message-thinking {
            background: #2a2a3a;
            border-left: 3px solid #ff9800;
            font-style: italic;
            color: var(--text-secondary);
        }

        /* ä»£ç å— */
        .message-content pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .message-content code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.9em;
        }

        .message-content pre code {
            background: transparent;
            padding: 0;
        }

        /* å·¥å…·è°ƒç”¨è¯¦æƒ… */
        .tool-call {
            background: var(--code-bg);
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .tool-call-header {
            padding: 10px 15px;
            background: rgba(156, 39, 176, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .tool-call-name {
            font-weight: 600;
            color: #ce93d8;
        }

        .tool-call-toggle {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .tool-call-body {
            padding: 15px;
            display: none;
            max-height: 400px;
            overflow: auto;
        }

        .tool-call.expanded .tool-call-body {
            display: block;
        }

        /* ç»Ÿè®¡é¢æ¿ */
        .stats-panel {
            padding: 15px;
            background: var(--bg-card);
            border-radius: 8px;
            margin: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* æ–‡ä»¶è¾“å…¥éšè— */
        input[type="file"] {
            display: none;
        }

        /* æ ‡ç­¾ */
        .tag {
            display: inline-block;
            padding: 2px 8px;
            font-size: 0.7rem;
            border-radius: 4px;
            margin-right: 5px;
        }

        .tag-user {
            background: var(--user-bg);
        }

        .tag-assistant {
            background: var(--assistant-bg);
        }

        .tag-tool {
            background: var(--tool-bg);
        }

        /* ç­›é€‰å™¨ */
        .filter-bar {
            padding: 10px 15px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 5px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 15px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* å“åº”å¼ */
        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 300px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }
        }

        /* è¿”å›é¦–é¡µé“¾æ¥ */
        .back-link {
            color: var(--text-secondary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .back-link:hover {
            color: var(--accent);
        }

        /* é«˜äº®æœç´¢ç»“æœ */
        .highlight {
            background: rgba(233, 69, 96, 0.4);
            padding: 0 2px;
            border-radius: 2px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æŠ˜å æŒ‰é’® */
        .collapse-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            font-size: 0.8rem;
        }

        .collapse-btn:hover {
            color: var(--accent);
        }

        /* æ¶ˆæ¯å†…å®¹ä¸­çš„é“¾æ¥ */
        .message-content a {
            color: var(--accent-light);
            text-decoration: none;
        }

        .message-content a:hover {
            text-decoration: underline;
        }

        /* å¯¼å‡ºæŒ‰é’® */
        .export-menu {
            position: relative;
        }

        .export-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 150px;
            display: none;
            z-index: 10;
        }

        .export-dropdown.show {
            display: block;
        }

        .export-option {
            display: block;
            width: 100%;
            padding: 8px 15px;
            text-align: left;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .export-option:hover {
            background: var(--bg-hover);
        }
        .trust-bar {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
            margin: 12px 0 24px;
            padding: 12px 20px;
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.2);
            border-radius: 12px;
        }
        .trust-item {
            font-size: 13px;
            color: #a78bfa;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="lang-switcher">
                <div class="lang-dropdown" id="langDropdown">
                    <div class="lang-current" id="langCurrent">ğŸŒ English</div>
                    <div class="lang-menu">
                        <button class="lang-btn" data-lang="en">ğŸ‡ºğŸ‡¸ English</button>
                        <button class="lang-btn" data-lang="zh-CN">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
                        <button class="lang-btn" data-lang="fr">ğŸ‡«ğŸ‡· FranÃ§ais</button>
                        <button class="lang-btn" data-lang="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                    </div>
                </div>
            </div>
            <div class="logo">
                <span class="logo-icon">ğŸ’¬</span>
                <div class="logo-text">
                    <h1 data-i18n="title">Claude Code History</h1>
                    <span data-i18n="subtitle">View and search your conversation history</span>
                </div>
            </div>
            <div class="header-actions">
                <a href="index.html" class="back-link" data-i18n="backToToolbox">â† Back to Toolbox</a>
                <label for="file-input" class="btn btn-primary">
                    <span data-i18n="importFile">ğŸ“‚ Import File</span>
                </label>
                <label for="folder-input" class="btn btn-secondary">
                    <span data-i18n="importFolder">ğŸ“ Import Folder</span>
                </label>
            </div>
        </div>
    </header>

    <div class="trust-bar" style="max-width: 1200px; margin: 12px auto 24px;">
        <span class="trust-item" data-i18n="trust_users">ğŸŒ Used by 50,000+ users</span>
        <span class="trust-item" data-i18n="trust_rating">â­ 4.9/5 rating</span>
        <span class="trust-item" data-i18n="trust_privacy">ğŸ”’ 100% Private</span>
        <span class="trust-item" data-i18n="trust_free">ğŸš« No Ads, No Signup</span>
    </div>

    <!-- åŠŸèƒ½ç‰¹ç‚¹åŒºå— -->
    <section class="features-section" style="background: linear-gradient(135deg, #16213e, #0f3460); padding: 40px 20px; border-bottom: 1px solid #2a2a4a;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h2 style="text-align: center; color: #e6edf3; font-size: 24px; margin-bottom: 30px;" data-i18n="features">Features</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px;">
                <div style="background: rgba(15, 52, 96, 0.5); padding: 24px; border-radius: 12px; border: 1px solid #2a2a4a;">
                    <div style="font-size: 32px; margin-bottom: 12px;">ğŸ“„</div>
                    <h3 style="color: #e6edf3; font-size: 18px; margin-bottom: 8px;" data-i18n="featureJsonlTitle">JSONL Parsing</h3>
                    <p style="color: #8b949e; font-size: 14px; line-height: 1.6;" data-i18n="featureJsonlDesc">Import JSONL format history generated by Claude Code, automatically parse conversation content</p>
                </div>
                <div style="background: rgba(15, 52, 96, 0.5); padding: 24px; border-radius: 12px; border: 1px solid #2a2a4a;">
                    <div style="font-size: 32px; margin-bottom: 12px;">ğŸ·ï¸</div>
                    <h3 style="color: #e6edf3; font-size: 18px; margin-bottom: 8px;" data-i18n="featureCategoryTitle">Conversation Classification</h3>
                    <p style="color: #8b949e; font-size: 14px; line-height: 1.6;" data-i18n="featureCategoryDesc">Automatically distinguish user messages, assistant replies, tool calls, clearly display conversation structure</p>
                </div>
                <div style="background: rgba(15, 52, 96, 0.5); padding: 24px; border-radius: 12px; border: 1px solid #2a2a4a;">
                    <div style="font-size: 32px; margin-bottom: 12px;">ğŸ”</div>
                    <h3 style="color: #e6edf3; font-size: 18px; margin-bottom: 8px;" data-i18n="featureSearchTitle">Keyword Search</h3>
                    <p style="color: #8b949e; font-size: 14px; line-height: 1.6;" data-i18n="featureSearchDesc">Quickly search key content in history, support highlighting matching results</p>
                </div>
                <div style="background: rgba(15, 52, 96, 0.5); padding: 24px; border-radius: 12px; border: 1px solid #2a2a4a;">
                    <div style="font-size: 32px; margin-bottom: 12px;">ğŸ”’</div>
                    <h3 style="color: #e6edf3; font-size: 18px; margin-bottom: 8px;" data-i18n="featurePrivacyTitle">Privacy First</h3>
                    <p style="color: #8b949e; font-size: 14px; line-height: 1.6;" data-i18n="featurePrivacyDesc">All processing is done locally, conversation data will not be uploaded to any server, protecting your privacy</p>
                </div>
            </div>
        </div>
    </section>

    <input type="file" id="file-input" accept=".jsonl,.json" multiple>
    <input type="file" id="folder-input" webkitdirectory>

    <main class="main-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="search-box">
                    <input type="text" id="search-input" data-i18n-placeholder="searchPlaceholder" placeholder="Search conversations...">
                </div>
            </div>
            <div class="stats-panel" id="stats-panel" style="display: none;">
                <div class="stat-item">
                    <div class="stat-value" id="stat-sessions">0</div>
                    <div class="stat-label" data-i18n="statSessions">Sessions</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-messages">0</div>
                    <div class="stat-label" data-i18n="statMessages">Messages</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-projects">0</div>
                    <div class="stat-label" data-i18n="statProjects">Projects</div>
                </div>
            </div>
            <div class="session-list" id="session-list">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“‹</div>
                    <p data-i18n="noConversations">No conversations yet</p>
                    <p style="font-size: 0.8rem; margin-top: 10px;" data-i18n="pleaseImport">Please import JSONL files</p>
                </div>
            </div>
        </aside>

        <section class="content">
            <div class="upload-area" id="upload-area">
                <div class="upload-box" id="upload-box">
                    <div class="upload-icon">ğŸ“¤</div>
                    <h2 class="upload-title" data-i18n="uploadTitle">Import Claude Code History</h2>
                    <p class="upload-desc" data-i18n="uploadDesc">Drag and drop JSONL files here, or click the button to select files</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <label for="file-input" class="btn btn-primary">
                            <span data-i18n="selectFile">ğŸ“‚ Select File</span>
                        </label>
                        <label for="folder-input" class="btn btn-secondary">
                            <span data-i18n="selectFolder">ğŸ“ Select Folder</span>
                        </label>
                    </div>
                    <p class="upload-hint">
                        <span data-i18n="historyLocation">History location:</span> <code>~/.claude/projects/</code>
                        <br><br>
                        <span data-i18n="supportImport">Support importing single .jsonl file or entire project folder</span>
                    </p>
                </div>
            </div>

            <div class="conversation-view" id="conversation-view">
                <div class="conversation-header">
                    <div>
                        <div class="conversation-title" id="conversation-title" data-i18n="conversationTitle">Conversation Title</div>
                        <div class="conversation-info">
                            <span id="conversation-date" data-i18n="date">Date</span>
                            <span id="conversation-count" data-i18n="messageCount">Message Count</span>
                        </div>
                    </div>
                    <div class="export-menu">
                        <button class="btn btn-secondary btn-small" id="export-btn">
                            <span data-i18n="export">ğŸ“¥ Export</span>
                        </button>
                        <div class="export-dropdown" id="export-dropdown">
                            <button class="export-option" data-format="markdown" data-i18n="exportMarkdown">Export as Markdown</button>
                            <button class="export-option" data-format="json" data-i18n="exportJson">Export as JSON</button>
                            <button class="export-option" data-format="text" data-i18n="exportText">Export as Plain Text</button>
                        </div>
                    </div>
                </div>
                <div class="filter-bar">
                    <button class="filter-btn active" data-filter="all" data-i18n="filterAll">All</button>
                    <button class="filter-btn" data-filter="user" data-i18n="filterUser">User Messages</button>
                    <button class="filter-btn" data-filter="assistant" data-i18n="filterAssistant">AI Replies</button>
                    <button class="filter-btn" data-filter="tool" data-i18n="filterTool">Tool Calls</button>
                    <button class="filter-btn" data-filter="thinking" data-i18n="filterThinking">Thinking Process</button>
                </div>
                <div class="conversation-messages" id="conversation-messages">
                </div>
            </div>
        </section>
    </main>

    <script>
        // ========== å›½é™…åŒ–ç³»ç»Ÿ ==========
        const i18n = {
            currentLang: 'en',
            translations: {
                'en': {
                    title: 'Claude Code History',
                    subtitle: 'View and search your conversation history',
                    backToToolbox: 'â† Back to Toolbox',
                    importFile: 'ğŸ“‚ Import File',
                    importFolder: 'ğŸ“ Import Folder',
                    features: 'Features',
                    featureJsonlTitle: 'JSONL Parsing',
                    featureJsonlDesc: 'Import JSONL format history generated by Claude Code, automatically parse conversation content',
                    featureCategoryTitle: 'Conversation Classification',
                    featureCategoryDesc: 'Automatically distinguish user messages, assistant replies, tool calls, clearly display conversation structure',
                    featureSearchTitle: 'Keyword Search',
                    featureSearchDesc: 'Quickly search key content in history, support highlighting matching results',
                    featurePrivacyTitle: 'Privacy First',
                    featurePrivacyDesc: 'All processing is done locally, conversation data will not be uploaded to any server, protecting your privacy',
                    searchPlaceholder: 'Search conversations...',
                    statSessions: 'Sessions',
                    statMessages: 'Messages',
                    statProjects: 'Projects',
                    noConversations: 'No conversations yet',
                    pleaseImport: 'Please import JSONL files',
                    uploadTitle: 'Import Claude Code History',
                    uploadDesc: 'Drag and drop JSONL files here, or click the button to select files',
                    selectFile: 'ğŸ“‚ Select File',
                    selectFolder: 'ğŸ“ Select Folder',
                    historyLocation: 'History location:',
                    supportImport: 'Support importing single .jsonl file or entire project folder',
                    conversationTitle: 'Conversation Title',
                    date: 'Date',
                    messageCount: 'Message Count',
                    export: 'ğŸ“¥ Export',
                    exportMarkdown: 'Export as Markdown',
                    exportJson: 'Export as JSON',
                    exportText: 'Export as Plain Text',
                    filterAll: 'All',
                    filterUser: 'User Messages',
                    filterAssistant: 'AI Replies',
                    filterTool: 'Tool Calls',
                    filterThinking: 'Thinking Process',
                    faqTitle: 'FAQ',
                    faq1Q: 'How to get Claude Code history?',
                    faq1A: 'You can find .jsonl conversation history files in the ~/.claude/projects/ directory. Each project has a separate subdirectory to store its history.',
                    faq2Q: 'What file formats are supported?',
                    faq2A: 'Only JSONL format files generated by Claude Code are supported. Each line in this format is an independent JSON object containing message type, content, timestamp, etc.',
                    faq3Q: 'Can I export conversation content?',
                    faq3A: 'You can copy individual message content, or use the export function to export the entire conversation as Markdown, JSON, or plain text format. Batch export of multiple conversations is not currently supported.',
                    faq4Q: 'Will history be uploaded to server?',
                    faq4A: 'No. All data is processed locally in your browser, your conversation records will not be uploaded to any server. This is a pure frontend tool to ensure your privacy.',
                    faq5Q: 'Can I view tool call details?',
                    faq5A: 'Yes, you can expand to view tool call parameters and return results. Click on the tool call block to expand and view detailed input parameters and output content.',
                    relatedTools: 'ğŸ”— Related Tools',
                    jsonViewer: 'JSON Formatter',
                    jsonViewerDesc: 'JSON formatting and validation',
                    sqliteViewer: 'SQLite Viewer',
                    sqliteViewerDesc: 'Browse SQLite database online',
                    cryptoTools: 'Crypto Tools',
                    cryptoToolsDesc: 'Base64/MD5/SHA etc.',
                    regexTester: 'Regex Tester',
                    regexTesterDesc: 'Test regular expressions online',
                    footerPrivacy: 'Pure frontend processing, data will not be uploaded to server',
                    footerBack: 'â† Back to Web Toolbox',
                    roleUser: 'User',
                    roleClaude: 'Claude',
                    thinkingProcess: 'ğŸ’­ Thinking Process:',
                    toolResult: 'ğŸ“¤ Tool Result',
                    clickToExpand: 'Click to expand',
                    messagesUnit: 'messages',
                    unknownDate: 'Unknown',
                    noMatchingConversations: 'No matching conversations found',
                    project: 'Project',
                    time: 'Time',
                    trust_users: 'ğŸŒ Used by 50,000+ users',
                    trust_rating: 'â­ 4.9/5 rating',
                    trust_privacy: 'ğŸ”’ 100% Private',
                    trust_free: 'ğŸš« No Ads, No Signup'
                },
                'zh-CN': {
                    title: 'Claude Code å†å²è®°å½•',
                    subtitle: 'æŸ¥çœ‹å’Œæœç´¢ä½ çš„å¯¹è¯å†å²',
                    backToToolbox: 'â† è¿”å›å·¥å…·ç®±',
                    importFile: 'ğŸ“‚ å¯¼å…¥æ–‡ä»¶',
                    importFolder: 'ğŸ“ å¯¼å…¥æ–‡ä»¶å¤¹',
                    features: 'åŠŸèƒ½ç‰¹ç‚¹',
                    featureJsonlTitle: 'JSONL è§£æ',
                    featureJsonlDesc: 'æ”¯æŒå¯¼å…¥ Claude Code ç”Ÿæˆçš„ JSONL æ ¼å¼å†å²è®°å½•ï¼Œè‡ªåŠ¨è§£æå¯¹è¯å†…å®¹',
                    featureCategoryTitle: 'å¯¹è¯åˆ†ç±»',
                    featureCategoryDesc: 'è‡ªåŠ¨åŒºåˆ†ç”¨æˆ·æ¶ˆæ¯ã€åŠ©æ‰‹å›å¤ã€å·¥å…·è°ƒç”¨ç­‰ç±»å‹ï¼Œæ¸…æ™°å±•ç¤ºå¯¹è¯ç»“æ„',
                    featureSearchTitle: 'å…³é”®è¯æœç´¢',
                    featureSearchDesc: 'å¿«é€Ÿæœç´¢å†å²å¯¹è¯ä¸­çš„å…³é”®å†…å®¹ï¼Œæ”¯æŒé«˜äº®æ˜¾ç¤ºåŒ¹é…ç»“æœ',
                    featurePrivacyTitle: 'éšç§ä¼˜å…ˆ',
                    featurePrivacyDesc: 'å®Œå…¨æœ¬åœ°å¤„ç†ï¼Œå¯¹è¯æ•°æ®ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œä¿æŠ¤æ‚¨çš„éšç§',
                    searchPlaceholder: 'æœç´¢å¯¹è¯å†…å®¹...',
                    statSessions: 'å¯¹è¯æ•°',
                    statMessages: 'æ¶ˆæ¯æ•°',
                    statProjects: 'é¡¹ç›®æ•°',
                    noConversations: 'æš‚æ— å¯¹è¯è®°å½•',
                    pleaseImport: 'è¯·å¯¼å…¥ JSONL æ–‡ä»¶',
                    uploadTitle: 'å¯¼å…¥ Claude Code å†å²è®°å½•',
                    uploadDesc: 'æ‹–æ‹½ JSONL æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»æŒ‰é’®é€‰æ‹©æ–‡ä»¶',
                    selectFile: 'ğŸ“‚ é€‰æ‹©æ–‡ä»¶',
                    selectFolder: 'ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹',
                    historyLocation: 'å†å²è®°å½•ä½ç½®ï¼š',
                    supportImport: 'æ”¯æŒå¯¼å…¥å•ä¸ª .jsonl æ–‡ä»¶æˆ–æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹',
                    conversationTitle: 'å¯¹è¯æ ‡é¢˜',
                    date: 'æ—¥æœŸ',
                    messageCount: 'æ¶ˆæ¯æ•°',
                    export: 'ğŸ“¥ å¯¼å‡º',
                    exportMarkdown: 'å¯¼å‡ºä¸º Markdown',
                    exportJson: 'å¯¼å‡ºä¸º JSON',
                    exportText: 'å¯¼å‡ºä¸ºçº¯æ–‡æœ¬',
                    filterAll: 'å…¨éƒ¨',
                    filterUser: 'ç”¨æˆ·æ¶ˆæ¯',
                    filterAssistant: 'AI å›å¤',
                    filterTool: 'å·¥å…·è°ƒç”¨',
                    filterThinking: 'æ€è€ƒè¿‡ç¨‹',
                    faqTitle: 'å¸¸è§é—®é¢˜',
                    faq1Q: 'å¦‚ä½•è·å– Claude Code å†å²è®°å½•ï¼Ÿ',
                    faq1A: 'åœ¨ ~/.claude/projects/ ç›®å½•ä¸‹å¯æ‰¾åˆ° .jsonl æ ¼å¼çš„å¯¹è¯è®°å½•æ–‡ä»¶ã€‚æ¯ä¸ªé¡¹ç›®ä¼šæœ‰ç‹¬ç«‹çš„å­ç›®å½•å­˜å‚¨å¯¹åº”çš„å†å²è®°å½•ã€‚',
                    faq2Q: 'æ”¯æŒä»€ä¹ˆæ ¼å¼çš„æ–‡ä»¶ï¼Ÿ',
                    faq2A: 'ä»…æ”¯æŒ Claude Code ç”Ÿæˆçš„ JSONL æ ¼å¼æ–‡ä»¶ã€‚è¯¥æ ¼å¼æ¯è¡Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ JSON å¯¹è±¡ï¼ŒåŒ…å«æ¶ˆæ¯ç±»å‹ã€å†…å®¹ã€æ—¶é—´æˆ³ç­‰ä¿¡æ¯ã€‚',
                    faq3Q: 'å¯ä»¥å¯¼å‡ºå¯¹è¯å†…å®¹å—ï¼Ÿ',
                    faq3A: 'å¯ä»¥å¤åˆ¶å•æ¡æ¶ˆæ¯å†…å®¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½å°†æ•´ä¸ªå¯¹è¯å¯¼å‡ºä¸º Markdownã€JSON æˆ–çº¯æ–‡æœ¬æ ¼å¼ã€‚æš‚ä¸æ”¯æŒæ‰¹é‡å¯¼å‡ºå¤šä¸ªå¯¹è¯ã€‚',
                    faq4Q: 'å†å²è®°å½•ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨å—ï¼Ÿ',
                    faq4A: 'ä¸ä¼šã€‚æ‰€æœ‰æ•°æ®ä»…åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­å¤„ç†ï¼Œæ‚¨çš„å¯¹è¯è®°å½•ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªçº¯å‰ç«¯å·¥å…·ï¼Œç¡®ä¿æ‚¨çš„éšç§å®‰å…¨ã€‚',
                    faq5Q: 'èƒ½æŸ¥çœ‹å·¥å…·è°ƒç”¨çš„è¯¦æƒ…å—ï¼Ÿ',
                    faq5A: 'æ˜¯çš„ï¼Œå¯ä»¥å±•å¼€æŸ¥çœ‹å·¥å…·è°ƒç”¨çš„å‚æ•°å’Œè¿”å›ç»“æœã€‚ç‚¹å‡»å·¥å…·è°ƒç”¨åŒºå—å³å¯å±•å¼€æŸ¥çœ‹è¯¦ç»†çš„è¾“å…¥å‚æ•°å’Œè¾“å‡ºå†…å®¹ã€‚',
                    relatedTools: 'ğŸ”— ç›¸å…³å·¥å…·æ¨è',
                    jsonViewer: 'JSON æ ¼å¼åŒ–',
                    jsonViewerDesc: 'JSON æ ¼å¼åŒ–ä¸æ ¡éªŒ',
                    sqliteViewer: 'SQLite æŸ¥çœ‹å™¨',
                    sqliteViewerDesc: 'åœ¨çº¿æµè§ˆ SQLite æ•°æ®åº“',
                    cryptoTools: 'åŠ å¯†è§£å¯†å·¥å…·',
                    cryptoToolsDesc: 'Base64/MD5/SHAç­‰',
                    regexTester: 'æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•',
                    regexTesterDesc: 'åœ¨çº¿æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼',
                    footerPrivacy: 'çº¯å‰ç«¯å¤„ç†ï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨',
                    footerBack: 'â† è¿”å› Web Toolbox é¦–é¡µ',
                    roleUser: 'ç”¨æˆ·',
                    roleClaude: 'Claude',
                    thinkingProcess: 'ğŸ’­ æ€è€ƒè¿‡ç¨‹:',
                    toolResult: 'ğŸ“¤ å·¥å…·ç»“æœ',
                    clickToExpand: 'ç‚¹å‡»å±•å¼€',
                    messagesUnit: 'æ¡æ¶ˆæ¯',
                    unknownDate: 'æœªçŸ¥',
                    noMatchingConversations: 'æœªæ‰¾åˆ°åŒ¹é…çš„å¯¹è¯',
                    project: 'é¡¹ç›®',
                    time: 'æ—¶é—´',
                    trust_users: 'ğŸŒ è¶…è¿‡ 50,000 ç”¨æˆ·ä½¿ç”¨',
                    trust_rating: 'â­ 4.9/5 å¥½è¯„',
                    trust_privacy: 'ğŸ”’ 100% éšç§å®‰å…¨',
                    trust_free: 'ğŸš« æ— å¹¿å‘Šã€æ— éœ€æ³¨å†Œ'
                },
                'fr': {
                    title: 'Historique Claude Code',
                    subtitle: 'Afficher et rechercher votre historique de conversation',
                    backToToolbox: 'â† Retour Ã  la boÃ®te Ã  outils',
                    importFile: 'ğŸ“‚ Importer fichier',
                    importFolder: 'ğŸ“ Importer dossier',
                    features: 'FonctionnalitÃ©s',
                    featureJsonlTitle: 'Analyse JSONL',
                    featureJsonlDesc: 'Importez l\'historique au format JSONL gÃ©nÃ©rÃ© par Claude Code, analyse automatique du contenu de conversation',
                    featureCategoryTitle: 'Classification des conversations',
                    featureCategoryDesc: 'Distingue automatiquement les messages utilisateur, rÃ©ponses assistant, appels d\'outils, affichage clair de la structure',
                    featureSearchTitle: 'Recherche par mots-clÃ©s',
                    featureSearchDesc: 'Recherche rapide du contenu clÃ© dans l\'historique, surlignage des rÃ©sultats correspondants',
                    featurePrivacyTitle: 'ConfidentialitÃ© d\'abord',
                    featurePrivacyDesc: 'Tout est traitÃ© localement, les donnÃ©es de conversation ne sont jamais tÃ©lÃ©chargÃ©es sur aucun serveur, protÃ©geant votre vie privÃ©e',
                    searchPlaceholder: 'Rechercher des conversations...',
                    statSessions: 'Sessions',
                    statMessages: 'Messages',
                    statProjects: 'Projets',
                    noConversations: 'Pas encore de conversations',
                    pleaseImport: 'Veuillez importer des fichiers JSONL',
                    uploadTitle: 'Importer l\'historique Claude Code',
                    uploadDesc: 'Glissez-dÃ©posez les fichiers JSONL ici, ou cliquez sur le bouton pour sÃ©lectionner',
                    selectFile: 'ğŸ“‚ SÃ©lectionner fichier',
                    selectFolder: 'ğŸ“ SÃ©lectionner dossier',
                    historyLocation: 'Emplacement de l\'historique:',
                    supportImport: 'Prise en charge de l\'importation d\'un seul fichier .jsonl ou d\'un dossier de projet entier',
                    conversationTitle: 'Titre de la conversation',
                    date: 'Date',
                    messageCount: 'Nombre de messages',
                    export: 'ğŸ“¥ Exporter',
                    exportMarkdown: 'Exporter en Markdown',
                    exportJson: 'Exporter en JSON',
                    exportText: 'Exporter en texte brut',
                    filterAll: 'Tout',
                    filterUser: 'Messages utilisateur',
                    filterAssistant: 'RÃ©ponses IA',
                    filterTool: 'Appels d\'outils',
                    filterThinking: 'Processus de rÃ©flexion',
                    faqTitle: 'FAQ',
                    faq1Q: 'Comment obtenir l\'historique Claude Code?',
                    faq1A: 'Vous pouvez trouver les fichiers d\'historique de conversation .jsonl dans le rÃ©pertoire ~/.claude/projects/. Chaque projet a un sous-rÃ©pertoire sÃ©parÃ© pour stocker son historique.',
                    faq2Q: 'Quels formats de fichiers sont pris en charge?',
                    faq2A: 'Seuls les fichiers au format JSONL gÃ©nÃ©rÃ©s par Claude Code sont pris en charge. Chaque ligne de ce format est un objet JSON indÃ©pendant contenant le type de message, le contenu, l\'horodatage, etc.',
                    faq3Q: 'Puis-je exporter le contenu de la conversation?',
                    faq3A: 'Vous pouvez copier le contenu de messages individuels, ou utiliser la fonction d\'exportation pour exporter toute la conversation en Markdown, JSON ou texte brut. L\'exportation par lot de plusieurs conversations n\'est pas encore prise en charge.',
                    faq4Q: 'L\'historique sera-t-il tÃ©lÃ©chargÃ© sur le serveur?',
                    faq4A: 'Non. Toutes les donnÃ©es sont traitÃ©es localement dans votre navigateur, vos enregistrements de conversation ne seront pas tÃ©lÃ©chargÃ©s sur aucun serveur. C\'est un outil purement frontend pour assurer votre confidentialitÃ©.',
                    faq5Q: 'Puis-je voir les dÃ©tails des appels d\'outils?',
                    faq5A: 'Oui, vous pouvez dÃ©velopper pour voir les paramÃ¨tres d\'appel d\'outil et les rÃ©sultats de retour. Cliquez sur le bloc d\'appel d\'outil pour dÃ©velopper et voir les paramÃ¨tres d\'entrÃ©e dÃ©taillÃ©s et le contenu de sortie.',
                    relatedTools: 'ğŸ”— Outils connexes',
                    jsonViewer: 'Formateur JSON',
                    jsonViewerDesc: 'Formatage et validation JSON',
                    sqliteViewer: 'Visionneuse SQLite',
                    sqliteViewerDesc: 'Parcourir la base de donnÃ©es SQLite en ligne',
                    cryptoTools: 'Outils crypto',
                    cryptoToolsDesc: 'Base64/MD5/SHA etc.',
                    regexTester: 'Testeur Regex',
                    regexTesterDesc: 'Tester les expressions rÃ©guliÃ¨res en ligne',
                    footerPrivacy: 'Traitement frontend pur, les donnÃ©es ne seront pas tÃ©lÃ©chargÃ©es sur le serveur',
                    footerBack: 'â† Retour Ã  Web Toolbox',
                    roleUser: 'Utilisateur',
                    roleClaude: 'Claude',
                    thinkingProcess: 'ğŸ’­ Processus de rÃ©flexion:',
                    toolResult: 'ğŸ“¤ RÃ©sultat de l\'outil',
                    clickToExpand: 'Cliquez pour dÃ©velopper',
                    messagesUnit: 'messages',
                    unknownDate: 'Inconnu',
                    noMatchingConversations: 'Aucune conversation correspondante trouvÃ©e',
                    project: 'Projet',
                    time: 'Temps',
                    trust_users: 'ğŸŒ UtilisÃ© par 50 000+ utilisateurs',
                    trust_rating: 'â­ Note 4.9/5',
                    trust_privacy: 'ğŸ”’ 100% PrivÃ©',
                    trust_free: 'ğŸš« Sans pub, sans inscription'
                },
                'es': {
                    title: 'Historial de Claude Code',
                    subtitle: 'Ver y buscar tu historial de conversaciÃ³n',
                    backToToolbox: 'â† Volver a herramientas',
                    importFile: 'ğŸ“‚ Importar archivo',
                    importFolder: 'ğŸ“ Importar carpeta',
                    features: 'CaracterÃ­sticas',
                    featureJsonlTitle: 'AnÃ¡lisis JSONL',
                    featureJsonlDesc: 'Importa historial en formato JSONL generado por Claude Code, analiza automÃ¡ticamente el contenido de la conversaciÃ³n',
                    featureCategoryTitle: 'ClasificaciÃ³n de conversaciones',
                    featureCategoryDesc: 'Distingue automÃ¡ticamente mensajes de usuario, respuestas del asistente, llamadas de herramientas, muestra claramente la estructura',
                    featureSearchTitle: 'BÃºsqueda por palabras clave',
                    featureSearchDesc: 'Busca rÃ¡pidamente contenido clave en el historial, soporta resaltado de resultados coincidentes',
                    featurePrivacyTitle: 'Privacidad primero',
                    featurePrivacyDesc: 'Todo el procesamiento es local, los datos de conversaciÃ³n no se suben a ningÃºn servidor, protegiendo tu privacidad',
                    searchPlaceholder: 'Buscar conversaciones...',
                    statSessions: 'Sesiones',
                    statMessages: 'Mensajes',
                    statProjects: 'Proyectos',
                    noConversations: 'Sin conversaciones aÃºn',
                    pleaseImport: 'Por favor importa archivos JSONL',
                    uploadTitle: 'Importar historial de Claude Code',
                    uploadDesc: 'Arrastra y suelta archivos JSONL aquÃ­, o haz clic en el botÃ³n para seleccionar',
                    selectFile: 'ğŸ“‚ Seleccionar archivo',
                    selectFolder: 'ğŸ“ Seleccionar carpeta',
                    historyLocation: 'UbicaciÃ³n del historial:',
                    supportImport: 'Soporta importar un solo archivo .jsonl o carpeta de proyecto completa',
                    conversationTitle: 'TÃ­tulo de conversaciÃ³n',
                    date: 'Fecha',
                    messageCount: 'NÃºmero de mensajes',
                    export: 'ğŸ“¥ Exportar',
                    exportMarkdown: 'Exportar como Markdown',
                    exportJson: 'Exportar como JSON',
                    exportText: 'Exportar como texto plano',
                    filterAll: 'Todo',
                    filterUser: 'Mensajes de usuario',
                    filterAssistant: 'Respuestas IA',
                    filterTool: 'Llamadas de herramientas',
                    filterThinking: 'Proceso de pensamiento',
                    faqTitle: 'Preguntas frecuentes',
                    faq1Q: 'Â¿CÃ³mo obtener el historial de Claude Code?',
                    faq1A: 'Puedes encontrar archivos de historial de conversaciÃ³n .jsonl en el directorio ~/.claude/projects/. Cada proyecto tiene un subdirectorio separado para almacenar su historial.',
                    faq2Q: 'Â¿QuÃ© formatos de archivo son compatibles?',
                    faq2A: 'Solo se admiten archivos en formato JSONL generados por Claude Code. Cada lÃ­nea en este formato es un objeto JSON independiente que contiene tipo de mensaje, contenido, marca de tiempo, etc.',
                    faq3Q: 'Â¿Puedo exportar el contenido de la conversaciÃ³n?',
                    faq3A: 'Puedes copiar el contenido de mensajes individuales, o usar la funciÃ³n de exportaciÃ³n para exportar toda la conversaciÃ³n como Markdown, JSON o texto plano. La exportaciÃ³n por lotes de mÃºltiples conversaciones no estÃ¡ soportada actualmente.',
                    faq4Q: 'Â¿Se subirÃ¡ el historial al servidor?',
                    faq4A: 'No. Todos los datos se procesan localmente en tu navegador, tus registros de conversaciÃ³n no se subirÃ¡n a ningÃºn servidor. Esta es una herramienta puramente frontend para asegurar tu privacidad.',
                    faq5Q: 'Â¿Puedo ver los detalles de las llamadas de herramientas?',
                    faq5A: 'SÃ­, puedes expandir para ver los parÃ¡metros de llamada de herramienta y resultados de retorno. Haz clic en el bloque de llamada de herramienta para expandir y ver los parÃ¡metros de entrada detallados y el contenido de salida.',
                    relatedTools: 'ğŸ”— Herramientas relacionadas',
                    jsonViewer: 'Formateador JSON',
                    jsonViewerDesc: 'Formateo y validaciÃ³n JSON',
                    sqliteViewer: 'Visor SQLite',
                    sqliteViewerDesc: 'Navegar base de datos SQLite en lÃ­nea',
                    cryptoTools: 'Herramientas crypto',
                    cryptoToolsDesc: 'Base64/MD5/SHA etc.',
                    regexTester: 'Probador Regex',
                    regexTesterDesc: 'Probar expresiones regulares en lÃ­nea',
                    footerPrivacy: 'Procesamiento frontend puro, los datos no se subirÃ¡n al servidor',
                    footerBack: 'â† Volver a Web Toolbox',
                    roleUser: 'Usuario',
                    roleClaude: 'Claude',
                    thinkingProcess: 'ğŸ’­ Proceso de pensamiento:',
                    toolResult: 'ğŸ“¤ Resultado de herramienta',
                    clickToExpand: 'Clic para expandir',
                    messagesUnit: 'mensajes',
                    unknownDate: 'Desconocido',
                    noMatchingConversations: 'No se encontraron conversaciones coincidentes',
                    project: 'Proyecto',
                    time: 'Tiempo',
                    trust_users: 'ğŸŒ Usado por mÃ¡s de 50,000 usuarios',
                    trust_rating: 'â­ CalificaciÃ³n 4.9/5',
                    trust_privacy: 'ğŸ”’ 100% Privado',
                    trust_free: 'ğŸš« Sin anuncios, sin registro'
                }
            },

            t(key) {
                return this.translations[this.currentLang]?.[key] || this.translations['en'][key] || key;
            },

            setLang(lang) {
                if (this.translations[lang]) {
                    this.currentLang = lang;
                    localStorage.setItem('claude-history-lang', lang);
                    this.updateUI();
                }
            },

            updateUI() {
                // æ›´æ–°æ‰€æœ‰å¸¦ data-i18n å±æ€§çš„å…ƒç´ 
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    el.textContent = this.t(key);
                });

                // æ›´æ–° placeholder
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    el.placeholder = this.t(key);
                });

                // æ›´æ–°è¯­è¨€åˆ‡æ¢å™¨æ˜¾ç¤º
                const langNames = {
                    'en': 'ğŸ‡ºğŸ‡¸ English',
                    'zh-CN': 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡',
                    'fr': 'ğŸ‡«ğŸ‡· FranÃ§ais',
                    'es': 'ğŸ‡ªğŸ‡¸ EspaÃ±ol'
                };
                document.getElementById('langCurrent').textContent = langNames[this.currentLang] || 'ğŸŒ English';

                // æ›´æ–° FAQ åŒºå—
                this.updateFAQ();

                // æ›´æ–°ç›¸å…³å·¥å…·åŒºå—
                this.updateRelatedTools();

                // æ›´æ–°é¡µè„š
                this.updateFooter();
            },

            updateFAQ() {
                const faqSection = document.querySelector('.faq-section');
                if (faqSection) {
                    faqSection.querySelector('h2').textContent = this.t('faqTitle');
                    const details = faqSection.querySelectorAll('details');
                    const faqKeys = ['faq1', 'faq2', 'faq3', 'faq4', 'faq5'];
                    details.forEach((detail, index) => {
                        if (faqKeys[index]) {
                            const summary = detail.querySelector('summary');
                            const answer = detail.querySelector('div p');
                            if (summary) {
                                summary.innerHTML = `<span style="color: #e94560;">Q:</span> ${this.t(faqKeys[index] + 'Q')}`;
                            }
                            if (answer) {
                                answer.textContent = this.t(faqKeys[index] + 'A');
                            }
                        }
                    });
                }
            },

            updateRelatedTools() {
                const relatedSection = document.querySelector('.related-tools');
                if (relatedSection) {
                    relatedSection.querySelector('h3').textContent = this.t('relatedTools');
                    const tools = relatedSection.querySelectorAll('a');
                    const toolData = [
                        { nameKey: 'jsonViewer', descKey: 'jsonViewerDesc' },
                        { nameKey: 'sqliteViewer', descKey: 'sqliteViewerDesc' },
                        { nameKey: 'cryptoTools', descKey: 'cryptoToolsDesc' },
                        { nameKey: 'regexTester', descKey: 'regexTesterDesc' }
                    ];
                    tools.forEach((tool, index) => {
                        if (toolData[index]) {
                            const nameEl = tool.querySelector('div:nth-child(2)');
                            const descEl = tool.querySelector('div:nth-child(3)');
                            if (nameEl) nameEl.textContent = this.t(toolData[index].nameKey);
                            if (descEl) descEl.textContent = this.t(toolData[index].descKey);
                        }
                    });
                }
            },

            updateFooter() {
                const footer = document.querySelector('footer');
                if (footer) {
                    const ps = footer.querySelectorAll('p');
                    if (ps[0]) ps[0].textContent = this.t('footerPrivacy');
                    const backLink = footer.querySelector('a[href="index.html"]');
                    if (backLink) backLink.textContent = this.t('footerBack');
                }
            },

            init() {
                const savedLang = localStorage.getItem('claude-history-lang');
                const browserLang = navigator.language || navigator.userLanguage;

                if (savedLang && this.translations[savedLang]) {
                    this.currentLang = savedLang;
                } else if (browserLang.startsWith('zh')) {
                    this.currentLang = 'zh-CN';
                } else if (browserLang.startsWith('fr')) {
                    this.currentLang = 'fr';
                } else if (browserLang.startsWith('es')) {
                    this.currentLang = 'es';
                } else {
                    this.currentLang = 'en';
                }

                this.updateUI();
            }
        };

        // è¯­è¨€åˆ‡æ¢å™¨äº‹ä»¶
        document.getElementById('langDropdown').addEventListener('click', function(e) {
            e.stopPropagation();
            this.classList.toggle('active');
        });

        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const lang = this.getAttribute('data-lang');
                i18n.setLang(lang);
                document.getElementById('langDropdown').classList.remove('active');
            });
        });

        document.addEventListener('click', function() {
            document.getElementById('langDropdown').classList.remove('active');
        });

        // å…¨å±€æ•°æ®å­˜å‚¨
        let allSessions = [];
        let currentSession = null;
        let currentFilter = 'all';
        let searchQuery = '';

        // DOM å…ƒç´ 
        const fileInput = document.getElementById('file-input');
        const folderInput = document.getElementById('folder-input');
        const uploadArea = document.getElementById('upload-area');
        const uploadBox = document.getElementById('upload-box');
        const conversationView = document.getElementById('conversation-view');
        const sessionList = document.getElementById('session-list');
        const searchInput = document.getElementById('search-input');
        const statsPanel = document.getElementById('stats-panel');
        const exportBtn = document.getElementById('export-btn');
        const exportDropdown = document.getElementById('export-dropdown');

        // äº‹ä»¶ç›‘å¬
        fileInput.addEventListener('change', handleFileSelect);
        folderInput.addEventListener('change', handleFolderSelect);
        searchInput.addEventListener('input', debounce(handleSearch, 300));

        // æ‹–æ‹½ä¸Šä¼ 
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('drag-over');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('drag-over');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('drag-over');
            const items = e.dataTransfer.items;
            handleDroppedItems(items);
        });

        // ç­›é€‰å™¨
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                if (currentSession) {
                    renderMessages(currentSession.messages);
                }
            });
        });

        // å¯¼å‡ºèœå•
        exportBtn.addEventListener('click', () => {
            exportDropdown.classList.toggle('show');
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.export-menu')) {
                exportDropdown.classList.remove('show');
            }
        });

        document.querySelectorAll('.export-option').forEach(opt => {
            opt.addEventListener('click', () => {
                if (currentSession) {
                    exportConversation(opt.dataset.format);
                }
                exportDropdown.classList.remove('show');
            });
        });

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        // å¤„ç†æ–‡ä»¶å¤¹é€‰æ‹©
        function handleFolderSelect(e) {
            const files = Array.from(e.target.files).filter(f =>
                f.name.endsWith('.jsonl') || f.name.endsWith('.json')
            );
            processFiles(files);
        }

        // å¤„ç†æ‹–æ‹½çš„é¡¹ç›®
        async function handleDroppedItems(items) {
            const files = [];

            for (const item of items) {
                if (item.kind === 'file') {
                    const entry = item.webkitGetAsEntry();
                    if (entry) {
                        if (entry.isFile) {
                            const file = item.getAsFile();
                            if (file.name.endsWith('.jsonl') || file.name.endsWith('.json')) {
                                files.push(file);
                            }
                        } else if (entry.isDirectory) {
                            await traverseDirectory(entry, files);
                        }
                    }
                }
            }

            processFiles(files);
        }

        // éå†ç›®å½•
        async function traverseDirectory(entry, files) {
            const reader = entry.createReader();
            const entries = await new Promise(resolve => reader.readEntries(resolve));

            for (const e of entries) {
                if (e.isFile && (e.name.endsWith('.jsonl') || e.name.endsWith('.json'))) {
                    const file = await new Promise(resolve => e.file(resolve));
                    files.push(file);
                } else if (e.isDirectory) {
                    await traverseDirectory(e, files);
                }
            }
        }

        // å¤„ç†æ–‡ä»¶
        async function processFiles(files) {
            if (files.length === 0) return;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            sessionList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

            for (const file of files) {
                try {
                    const content = await file.text();
                    parseJSONL(content, file.name);
                } catch (err) {
                    console.error('Failed to parse file:', file.name, err);
                }
            }

            // æ›´æ–° UI
            updateStats();
            renderSessionList();

            if (allSessions.length > 0) {
                uploadArea.style.display = 'none';
                statsPanel.style.display = 'grid';
            }
        }

        // è§£æ JSONL æ ¼å¼
        function parseJSONL(content, filename) {
            const lines = content.split('\n').filter(line => line.trim());

            // æ£€æŸ¥æ˜¯å¦æ˜¯å…¨å±€å†å²è®°å½•
            if (filename === 'history.jsonl') {
                parseGlobalHistory(lines);
                return;
            }

            // è§£æå¯¹è¯è®°å½•
            const messages = [];
            let summary = '';
            let sessionId = filename.replace('.jsonl', '');
            let project = '';
            let firstTimestamp = null;
            let lastTimestamp = null;

            for (const line of lines) {
                try {
                    const item = JSON.parse(line);

                    if (item.type === 'summary') {
                        summary = item.summary;
                    } else if (item.type === 'user' || item.type === 'assistant') {
                        if (item.sessionId) sessionId = item.sessionId;
                        if (item.cwd) project = item.cwd;

                        const timestamp = item.timestamp ? new Date(item.timestamp) : null;
                        if (timestamp) {
                            if (!firstTimestamp) firstTimestamp = timestamp;
                            lastTimestamp = timestamp;
                        }

                        messages.push({
                            type: item.type,
                            role: item.message?.role || item.type,
                            content: item.message?.content || '',
                            timestamp: timestamp,
                            uuid: item.uuid
                        });
                    }
                } catch (err) {
                    // å¿½ç•¥è§£æé”™è¯¯çš„è¡Œ
                }
            }

            if (messages.length > 0) {
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒ sessionId
                const existingIndex = allSessions.findIndex(s => s.sessionId === sessionId);
                const session = {
                    sessionId,
                    filename,
                    summary: summary || getFirstUserMessage(messages) || 'Untitled Conversation',
                    project,
                    messages,
                    firstTimestamp,
                    lastTimestamp,
                    messageCount: messages.length
                };

                if (existingIndex >= 0) {
                    allSessions[existingIndex] = session;
                } else {
                    allSessions.push(session);
                }
            }
        }

        // è§£æå…¨å±€å†å²
        function parseGlobalHistory(lines) {
            for (const line of lines) {
                try {
                    const item = JSON.parse(line);
                    // å…¨å±€å†å²ä¸»è¦ç”¨äºæœç´¢ï¼Œä¸å•ç‹¬æ˜¾ç¤º
                } catch (err) {
                    // å¿½ç•¥
                }
            }
        }

        // è·å–ç¬¬ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯ä½œä¸ºæ ‡é¢˜
        function getFirstUserMessage(messages) {
            const userMsg = messages.find(m => m.role === 'user');
            if (userMsg && userMsg.content) {
                const text = extractTextContent(userMsg.content);
                return text.slice(0, 100) + (text.length > 100 ? '...' : '');
            }
            return null;
        }

        // æå–æ–‡æœ¬å†…å®¹
        function extractTextContent(content) {
            if (typeof content === 'string') return content;
            if (Array.isArray(content)) {
                return content
                    .filter(c => c.type === 'text')
                    .map(c => c.text)
                    .join('\n');
            }
            return '';
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const totalMessages = allSessions.reduce((sum, s) => sum + s.messageCount, 0);
            const projects = new Set(allSessions.map(s => s.project)).size;

            document.getElementById('stat-sessions').textContent = allSessions.length;
            document.getElementById('stat-messages').textContent = totalMessages;
            document.getElementById('stat-projects').textContent = projects;
        }

        // æ¸²æŸ“ä¼šè¯åˆ—è¡¨
        function renderSessionList() {
            // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            const sortedSessions = [...allSessions].sort((a, b) => {
                const timeA = a.lastTimestamp || a.firstTimestamp || new Date(0);
                const timeB = b.lastTimestamp || b.firstTimestamp || new Date(0);
                return timeB - timeA;
            });

            // è¿‡æ»¤æœç´¢ç»“æœ
            const filtered = searchQuery
                ? sortedSessions.filter(s =>
                    s.summary.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    s.messages.some(m => {
                        const text = extractTextContent(m.content);
                        return text.toLowerCase().includes(searchQuery.toLowerCase());
                    })
                )
                : sortedSessions;

            if (filtered.length === 0) {
                sessionList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”</div>
                        <p>${i18n.t('noMatchingConversations')}</p>
                    </div>
                `;
                return;
            }

            sessionList.innerHTML = filtered.map(session => `
                <div class="session-item ${currentSession?.sessionId === session.sessionId ? 'active' : ''}"
                     data-session-id="${session.sessionId}">
                    <div class="session-title">${escapeHtml(session.summary)}</div>
                    <div class="session-meta">
                        <span>${session.messageCount} ${i18n.t('messagesUnit')}</span>
                        <span>${formatDate(session.lastTimestamp || session.firstTimestamp)}</span>
                    </div>
                    ${session.project ? `<div class="session-project">ğŸ“ ${getShortPath(session.project)}</div>` : ''}
                </div>
            `).join('');

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.session-item').forEach(item => {
                item.addEventListener('click', () => {
                    const sessionId = item.dataset.sessionId;
                    const session = allSessions.find(s => s.sessionId === sessionId);
                    if (session) {
                        selectSession(session);
                    }
                });
            });
        }

        // é€‰æ‹©ä¼šè¯
        function selectSession(session) {
            currentSession = session;

            // æ›´æ–°åˆ—è¡¨é«˜äº®
            document.querySelectorAll('.session-item').forEach(item => {
                item.classList.toggle('active', item.dataset.sessionId === session.sessionId);
            });

            // æ˜¾ç¤ºå¯¹è¯è§†å›¾
            uploadArea.style.display = 'none';
            conversationView.style.display = 'flex';

            // æ›´æ–°å¤´éƒ¨ä¿¡æ¯
            document.getElementById('conversation-title').textContent = session.summary;
            document.getElementById('conversation-date').textContent = formatDateTime(session.firstTimestamp);
            document.getElementById('conversation-count').textContent = `${session.messageCount} ${i18n.t('messagesUnit')}`;

            // æ¸²æŸ“æ¶ˆæ¯
            renderMessages(session.messages);
        }

        // æ¸²æŸ“æ¶ˆæ¯
        function renderMessages(messages) {
            const container = document.getElementById('conversation-messages');

            // è¿‡æ»¤æ¶ˆæ¯
            const filtered = messages.filter(msg => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'user') return msg.role === 'user';
                if (currentFilter === 'assistant') return msg.role === 'assistant' && !hasThinkingContent(msg.content);
                if (currentFilter === 'tool') return hasToolContent(msg.content);
                if (currentFilter === 'thinking') return hasThinkingContent(msg.content);
                return true;
            });

            container.innerHTML = filtered.map(msg => renderMessage(msg)).join('');

            // æ·»åŠ å·¥å…·è°ƒç”¨æŠ˜å äº‹ä»¶
            container.querySelectorAll('.tool-call-header').forEach(header => {
                header.addEventListener('click', () => {
                    header.closest('.tool-call').classList.toggle('expanded');
                });
            });
        }

        // æ¸²æŸ“å•æ¡æ¶ˆæ¯
        function renderMessage(msg) {
            const role = msg.role;
            const content = msg.content;
            const timestamp = msg.timestamp;

            let roleLabel = 'Unknown';
            let avatar = 'â“';
            let typeClass = '';

            if (role === 'user') {
                roleLabel = i18n.t('roleUser');
                avatar = 'ğŸ‘¤';
                typeClass = 'message-user';
            } else if (role === 'assistant') {
                roleLabel = i18n.t('roleClaude');
                avatar = 'ğŸ¤–';
                typeClass = 'message-assistant';
            }

            let contentHtml = '';

            if (typeof content === 'string') {
                contentHtml = formatContent(content);
            } else if (Array.isArray(content)) {
                contentHtml = content.map(item => {
                    if (item.type === 'text') {
                        return formatContent(item.text);
                    } else if (item.type === 'thinking') {
                        return `<div class="message-content message-thinking">
                            <strong>${i18n.t('thinkingProcess')}</strong><br>
                            ${formatContent(item.thinking || '')}
                        </div>`;
                    } else if (item.type === 'tool_use') {
                        return `<div class="tool-call">
                            <div class="tool-call-header">
                                <span class="tool-call-name">ğŸ”§ ${escapeHtml(item.name || 'Tool')}</span>
                                <span class="tool-call-toggle">${i18n.t('clickToExpand')}</span>
                            </div>
                            <div class="tool-call-body">
                                <pre>${escapeHtml(JSON.stringify(item.input, null, 2))}</pre>
                            </div>
                        </div>`;
                    } else if (item.type === 'tool_result') {
                        return `<div class="tool-call">
                            <div class="tool-call-header">
                                <span class="tool-call-name">${i18n.t('toolResult')}</span>
                                <span class="tool-call-toggle">${i18n.t('clickToExpand')}</span>
                            </div>
                            <div class="tool-call-body">
                                <pre>${escapeHtml(typeof item.content === 'string' ? item.content : JSON.stringify(item.content, null, 2))}</pre>
                            </div>
                        </div>`;
                    }
                    return '';
                }).join('');
            }

            // å¦‚æœæ˜¯å·¥å…·ç»“æœç±»å‹çš„æ¶ˆæ¯
            if (hasToolContent(content) && !contentHtml.includes('message-content')) {
                typeClass = 'message-tool';
            }

            return `
                <div class="message ${typeClass}">
                    <div class="message-header">
                        <div class="message-avatar">${avatar}</div>
                        <span class="message-role">${roleLabel}</span>
                        ${timestamp ? `<span class="message-time">${formatTime(timestamp)}</span>` : ''}
                    </div>
                    ${contentHtml ? `<div class="message-content">${contentHtml}</div>` : ''}
                </div>
            `;
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰æ€è€ƒå†…å®¹
        function hasThinkingContent(content) {
            if (Array.isArray(content)) {
                return content.some(c => c.type === 'thinking');
            }
            return false;
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰å·¥å…·å†…å®¹
        function hasToolContent(content) {
            if (Array.isArray(content)) {
                return content.some(c => c.type === 'tool_use' || c.type === 'tool_result');
            }
            return false;
        }

        // æ ¼å¼åŒ–å†…å®¹ï¼ˆæ”¯æŒ Markdownï¼‰
        function formatContent(text) {
            if (!text) return '';

            let html = escapeHtml(text);

            // ä»£ç å—
            html = html.replace(/```(\w*)\n([\s\S]*?)```/g, (_, lang, code) => {
                return `<pre><code class="language-${lang}">${code.trim()}</code></pre>`;
            });

            // è¡Œå†…ä»£ç 
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // ç²—ä½“
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

            // æ–œä½“
            html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');

            // é“¾æ¥
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

            // æ¢è¡Œ
            html = html.replace(/\n/g, '<br>');

            // é«˜äº®æœç´¢è¯
            if (searchQuery) {
                const regex = new RegExp(`(${escapeRegex(searchQuery)})`, 'gi');
                html = html.replace(regex, '<span class="highlight">$1</span>');
            }

            return html;
        }

        // å¯¼å‡ºå¯¹è¯
        function exportConversation(format) {
            if (!currentSession) return;

            let content = '';
            let filename = `claude-conversation-${currentSession.sessionId}`;
            let mimeType = 'text/plain';

            if (format === 'markdown') {
                content = generateMarkdown(currentSession);
                filename += '.md';
                mimeType = 'text/markdown';
            } else if (format === 'json') {
                content = JSON.stringify(currentSession, null, 2);
                filename += '.json';
                mimeType = 'application/json';
            } else {
                content = generatePlainText(currentSession);
                filename += '.txt';
            }

            downloadFile(content, filename, mimeType);
        }

        // ç”Ÿæˆ Markdown
        function generateMarkdown(session) {
            let md = `# ${session.summary}\n\n`;
            md += `- ${i18n.t('project')}: ${session.project || i18n.t('unknownDate')}\n`;
            md += `- ${i18n.t('time')}: ${formatDateTime(session.firstTimestamp)}\n`;
            md += `- ${i18n.t('statMessages')}: ${session.messageCount}\n\n---\n\n`;

            for (const msg of session.messages) {
                const role = msg.role === 'user' ? `ğŸ‘¤ ${i18n.t('roleUser')}` : `ğŸ¤– ${i18n.t('roleClaude')}`;
                const time = msg.timestamp ? ` (${formatTime(msg.timestamp)})` : '';
                md += `## ${role}${time}\n\n`;

                const text = extractTextContent(msg.content);
                md += `${text}\n\n`;
            }

            return md;
        }

        // ç”Ÿæˆçº¯æ–‡æœ¬
        function generatePlainText(session) {
            let text = `${session.summary}\n`;
            text += `${'='.repeat(50)}\n`;
            text += `${i18n.t('project')}: ${session.project || i18n.t('unknownDate')}\n`;
            text += `${i18n.t('time')}: ${formatDateTime(session.firstTimestamp)}\n`;
            text += `${'='.repeat(50)}\n\n`;

            for (const msg of session.messages) {
                const role = msg.role === 'user' ? `[${i18n.t('roleUser')}]` : `[${i18n.t('roleClaude')}]`;
                const time = msg.timestamp ? ` ${formatTime(msg.timestamp)}` : '';
                text += `${role}${time}\n`;
                text += `${'-'.repeat(30)}\n`;

                const content = extractTextContent(msg.content);
                text += `${content}\n\n`;
            }

            return text;
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æœç´¢å¤„ç†
        function handleSearch() {
            searchQuery = searchInput.value.trim();
            renderSessionList();

            if (currentSession) {
                renderMessages(currentSession.messages);
            }
        }

        // å·¥å…·å‡½æ•°
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function formatDate(date) {
            if (!date) return i18n.t('unknownDate');
            const locale = i18n.currentLang === 'zh-CN' ? 'zh-CN' : i18n.currentLang === 'fr' ? 'fr-FR' : i18n.currentLang === 'es' ? 'es-ES' : 'en-US';
            return date.toLocaleDateString(locale, {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatTime(date) {
            if (!date) return '';
            const locale = i18n.currentLang === 'zh-CN' ? 'zh-CN' : i18n.currentLang === 'fr' ? 'fr-FR' : i18n.currentLang === 'es' ? 'es-ES' : 'en-US';
            return date.toLocaleTimeString(locale, {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatDateTime(date) {
            if (!date) return i18n.t('unknownDate');
            const locale = i18n.currentLang === 'zh-CN' ? 'zh-CN' : i18n.currentLang === 'fr' ? 'fr-FR' : i18n.currentLang === 'es' ? 'es-ES' : 'en-US';
            return date.toLocaleString(locale, {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getShortPath(path) {
            if (!path) return '';
            const parts = path.split('/');
            if (parts.length <= 3) return path;
            return '.../' + parts.slice(-2).join('/');
        }

        function debounce(fn, delay) {
            let timer = null;
            return function(...args) {
                clearTimeout(timer);
                timer = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        // ========== è‡ªåŠ¨åŠ è½½åŠŸèƒ½ï¼ˆé€šè¿‡æœ¬åœ°æœåŠ¡å™¨ï¼‰ ==========

        // æ£€æŸ¥æ˜¯å¦é€šè¿‡æœ¬åœ°æœåŠ¡å™¨è®¿é—®
        async function checkAutoLoad() {
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.has('auto')) return;

            try {
                sessionList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

                const response = await fetch('/api/sessions');
                if (!response.ok) throw new Error('API not available');

                const data = await response.json();
                if (data.error) {
                    console.warn('Loading warning:', data.error);
                }

                if (data.sessions && data.sessions.length > 0) {
                    // è½¬æ¢ä¸ºæœ¬åœ°æ ¼å¼
                    for (const session of data.sessions) {
                        session.firstTimestamp = session.firstTimestamp ? new Date(session.firstTimestamp) : null;
                        session.lastTimestamp = session.lastTimestamp ? new Date(session.lastTimestamp) : null;
                        session.messages = []; // æ¶ˆæ¯å»¶è¿ŸåŠ è½½
                    }

                    allSessions = data.sessions;
                    updateStats();
                    renderSessionList();
                    uploadArea.style.display = 'none';
                    statsPanel.style.display = 'grid';

                    console.log(`Auto-loaded ${allSessions.length} conversations`);
                }
            } catch (err) {
                console.log('Auto-load not available, using manual import mode');
            }
        }

        // é‡å†™é€‰æ‹©ä¼šè¯å‡½æ•°ä»¥æ”¯æŒå»¶è¿ŸåŠ è½½
        const originalSelectSession = selectSession;
        selectSession = async function(session) {
            // å¦‚æœæ¶ˆæ¯ä¸ºç©ºä¸”é€šè¿‡ API è®¿é—®ï¼Œåˆ™åŠ è½½æ¶ˆæ¯
            if (session.messages.length === 0 && session.filepath) {
                try {
                    const response = await fetch(`/api/session/${encodeURIComponent(session.filepath)}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.messages) {
                            session.messages = data.messages.map(msg => ({
                                ...msg,
                                timestamp: msg.timestamp ? new Date(msg.timestamp) : null
                            }));
                            session.messageCount = session.messages.length;
                        }
                    }
                } catch (err) {
                    console.error('Failed to load messages:', err);
                }
            }

            currentSession = session;

            // æ›´æ–°åˆ—è¡¨é«˜äº®
            document.querySelectorAll('.session-item').forEach(item => {
                item.classList.toggle('active', item.dataset.sessionId === session.sessionId);
            });

            // æ˜¾ç¤ºå¯¹è¯è§†å›¾
            uploadArea.style.display = 'none';
            conversationView.style.display = 'flex';

            // æ›´æ–°å¤´éƒ¨ä¿¡æ¯
            document.getElementById('conversation-title').textContent = session.summary;
            document.getElementById('conversation-date').textContent = formatDateTime(session.firstTimestamp);
            document.getElementById('conversation-count').textContent = `${session.messageCount} ${i18n.t('messagesUnit')}`;

            // æ¸²æŸ“æ¶ˆæ¯
            renderMessages(session.messages);
        };

        // åˆå§‹åŒ–å›½é™…åŒ–
        i18n.init();

        // é¡µé¢åŠ è½½æ—¶å°è¯•è‡ªåŠ¨åŠ è½½
        checkAutoLoad();
    </script>

    <!-- FAQ é—®ç­”åŒºå— -->
    <section class="faq-section" style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
        <h2 style="color: #e6edf3; font-size: 22px; margin-bottom: 24px; text-align: center;" data-i18n="faqTitle">FAQ</h2>
        <div style="display: flex; flex-direction: column; gap: 16px;">
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; color: #e6edf3; font-weight: 500; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #e94560;">Q:</span> <span data-i18n="faq1Q">How to get Claude Code history?</span>
                </summary>
                <div style="padding: 0 20px 16px 20px; color: #8b949e; line-height: 1.6;">
                    <p data-i18n="faq1A">You can find .jsonl conversation history files in the ~/.claude/projects/ directory. Each project has a separate subdirectory to store its history.</p>
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; color: #e6edf3; font-weight: 500; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #e94560;">Q:</span> <span data-i18n="faq2Q">What file formats are supported?</span>
                </summary>
                <div style="padding: 0 20px 16px 20px; color: #8b949e; line-height: 1.6;">
                    <p data-i18n="faq2A">Only JSONL format files generated by Claude Code are supported. Each line in this format is an independent JSON object containing message type, content, timestamp, etc.</p>
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; color: #e6edf3; font-weight: 500; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #e94560;">Q:</span> <span data-i18n="faq3Q">Can I export conversation content?</span>
                </summary>
                <div style="padding: 0 20px 16px 20px; color: #8b949e; line-height: 1.6;">
                    <p data-i18n="faq3A">You can copy individual message content, or use the export function to export the entire conversation as Markdown, JSON, or plain text format. Batch export of multiple conversations is not currently supported.</p>
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; color: #e6edf3; font-weight: 500; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #e94560;">Q:</span> <span data-i18n="faq4Q">Will history be uploaded to server?</span>
                </summary>
                <div style="padding: 0 20px 16px 20px; color: #8b949e; line-height: 1.6;">
                    <p data-i18n="faq4A">No. All data is processed locally in your browser, your conversation records will not be uploaded to any server. This is a pure frontend tool to ensure your privacy.</p>
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; color: #e6edf3; font-weight: 500; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #e94560;">Q:</span> <span data-i18n="faq5Q">Can I view tool call details?</span>
                </summary>
                <div style="padding: 0 20px 16px 20px; color: #8b949e; line-height: 1.6;">
                    <p data-i18n="faq5A">Yes, you can expand to view tool call parameters and return results. Click on the tool call block to expand and view detailed input parameters and output content.</p>
                </div>
            </details>
        </div>
    </section>

    <!-- ç›¸å…³å·¥å…·æ¨è -->
    <section class="related-tools" style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
        <h3 style="color: #e6edf3; font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #30363d;" data-i18n="relatedTools">ğŸ”— Related Tools</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            <a href="json-viewer.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“‹</div>
                <div style="color: #e6edf3; font-weight: 500;" data-i18n="jsonViewer">JSON Formatter</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;" data-i18n="jsonViewerDesc">JSON formatting and validation</div>
            </a>
            <a href="sqlite-viewer.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ—„ï¸</div>
                <div style="color: #e6edf3; font-weight: 500;" data-i18n="sqliteViewer">SQLite Viewer</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;" data-i18n="sqliteViewerDesc">Browse SQLite database online</div>
            </a>
            <a href="crypto-tools.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ”</div>
                <div style="color: #e6edf3; font-weight: 500;" data-i18n="cryptoTools">Crypto Tools</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;" data-i18n="cryptoToolsDesc">Base64/MD5/SHA etc.</div>
            </a>
            <a href="regex-tester.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ”</div>
                <div style="color: #e6edf3; font-weight: 500;" data-i18n="regexTester">Regex Tester</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;" data-i18n="regexTesterDesc">Test regular expressions online</div>
            </a>
        </div>
    </section>

    <footer style="text-align: center; padding: 30px 20px; border-top: 1px solid #30363d; color: #8b949e; font-size: 14px;">
        <p data-i18n="footerPrivacy">Pure frontend processing, data will not be uploaded to server</p>
        <p style="margin-top: 12px;">
            <a href="index.html" style="color: #58a6ff; text-decoration: none;" data-i18n="footerBack">â† Back to Web Toolbox</a>
            <span style="margin: 0 12px;">|</span>
            <a href="https://github.com/*****" target="_blank" rel="noopener" style="color: #58a6ff; text-decoration: none;">GitHub</a>
        </p>
    </footer>
</body>
</html>
