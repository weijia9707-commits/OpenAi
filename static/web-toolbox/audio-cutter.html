<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘å‰ªè¾‘ - åœ¨çº¿å¯è§†åŒ–éŸ³é¢‘è£å‰ªå·¥å…· | Web Toolbox</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="å…è´¹åœ¨çº¿éŸ³é¢‘å‰ªè¾‘å·¥å…·ï¼Œæ”¯æŒ MP3ã€WAVã€M4Aã€FLACã€AAC æ ¼å¼ã€‚å¯è§†åŒ–æ³¢å½¢æ˜¾ç¤ºï¼Œæ‹–åŠ¨é€‰æ‹©å‰ªè¾‘åŒºé—´ï¼Œå¿«æ·é”®æ“ä½œï¼Œæœ¬åœ°å¤„ç†ä¿æŠ¤éšç§ã€‚">
    <meta name="keywords" content="éŸ³é¢‘å‰ªè¾‘,éŸ³é¢‘è£å‰ª,MP3å‰ªè¾‘,åœ¨çº¿éŸ³é¢‘ç¼–è¾‘,éŸ³é¢‘åˆ‡å‰²,é“ƒå£°åˆ¶ä½œ,éŸ³ä¹å‰ªè¾‘,WAVå‰ªè¾‘,å…è´¹éŸ³é¢‘å·¥å…·">
    <meta name="author" content="heyuan110">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.heyuan110.com/web-toolbox/audio-cutter.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.heyuan110.com/web-toolbox/audio-cutter.html">
    <meta property="og:title" content="éŸ³é¢‘å‰ªè¾‘ - åœ¨çº¿å¯è§†åŒ–éŸ³é¢‘è£å‰ªå·¥å…·">
    <meta property="og:description" content="å…è´¹åœ¨çº¿éŸ³é¢‘å‰ªè¾‘ï¼Œå¯è§†åŒ–æ³¢å½¢ï¼Œæ”¯æŒå¤šç§æ ¼å¼ã€‚">
    <meta property="og:image" content="https://www.heyuan110.com/web-toolbox/screenshots/audio-cutter.png">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="Web Toolbox">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="éŸ³é¢‘å‰ªè¾‘ - åœ¨çº¿å¯è§†åŒ–éŸ³é¢‘è£å‰ªå·¥å…·">
    <meta name="twitter:description" content="å…è´¹åœ¨çº¿éŸ³é¢‘å‰ªè¾‘ï¼Œå¯è§†åŒ–æ³¢å½¢æ˜¾ç¤ºã€‚">
    <meta name="twitter:image" content="https://www.heyuan110.com/web-toolbox/screenshots/audio-cutter.png">

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "éŸ³é¢‘å‰ªè¾‘",
        "url": "https://www.heyuan110.com/web-toolbox/audio-cutter.html",
        "description": "åœ¨çº¿å¯è§†åŒ–éŸ³é¢‘å‰ªè¾‘å·¥å…·ï¼Œæ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CNY"},
        "author": {"@type": "Person", "name": "heyuan110"}
    }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e4e4e7;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* è¿”å›æŒ‰é’® */
        .back-home {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #a1a1aa;
            text-decoration: none;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 20px;
        }

        .back-home:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        /* æ ‡é¢˜ */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(120deg, #00d4ff, #7c3aed, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a1a1aa;
            font-size: 0.95rem;
        }

        /* ä¸»é¢æ¿ */
        .editor-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 50px 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #7c3aed;
            background: rgba(124, 58, 237, 0.1);
        }

        .upload-area.hidden {
            display: none;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #d4d4d8;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #71717a;
            font-size: 0.9rem;
        }

        .upload-btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.2s ease;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #8b5cf6, #818cf8);
            transform: translateY(-2px);
        }

        #fileInput {
            display: none;
        }

        /* ç¼–è¾‘åŒºåŸŸ */
        .edit-area {
            display: none;
        }

        .edit-area.active {
            display: block;
        }

        /* éŸ³é¢‘ä¿¡æ¯ */
        .audio-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        .audio-name {
            color: #e4e4e7;
            font-size: 1rem;
            font-weight: 500;
        }

        .audio-duration {
            color: #a1a1aa;
            font-size: 0.9rem;
        }

        .change-file-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #d4d4d8;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .change-file-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* æ³¢å½¢å®¹å™¨ */
        .waveform-container {
            position: relative;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        #waveform {
            width: 100%;
            height: 128px;
            position: relative;
        }

        /* å‰ªè¾‘æ‰çš„åŒºåŸŸé®ç½©ï¼ˆå·¦ä¾§ï¼‰ */
        .trim-overlay-left {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            pointer-events: none;
            z-index: 2;
            transition: width 0.1s ease;
        }

        /* å‰ªè¾‘æ‰çš„åŒºåŸŸé®ç½©ï¼ˆå³ä¾§ï¼‰ */
        .trim-overlay-right {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            pointer-events: none;
            z-index: 2;
            transition: width 0.1s ease;
        }

        /* åˆ é™¤çº¿æ•ˆæœ */
        .trim-overlay-left::after,
        .trim-overlay-right::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(
                90deg,
                #ef4444 0px,
                #ef4444 8px,
                transparent 8px,
                transparent 16px
            );
            opacity: 0.8;
        }

        /* å‰ªè¾‘è¾¹ç•Œçº¢çº¿ - å·¦è¾¹ç•Œ */
        .trim-overlay-left::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 3px;
            height: 100%;
            background: #ef4444;
            box-shadow: 0 0 8px #ef4444, 0 0 16px rgba(239, 68, 68, 0.5);
            z-index: 10;
        }

        /* å‰ªè¾‘è¾¹ç•Œçº¢çº¿ - å³è¾¹ç•Œ */
        .trim-overlay-right::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: #ef4444;
            box-shadow: 0 0 8px #ef4444, 0 0 16px rgba(239, 68, 68, 0.5);
            z-index: 10;
        }

        /* æ—¶é—´è½´ */
        .timeline {
            display: flex;
            justify-content: space-between;
            color: #71717a;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        /* å‰ªè¾‘åŒºé—´æ˜¾ç¤º */
        .region-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .region-time {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .region-label {
            color: #a1a1aa;
            font-size: 0.9rem;
        }

        .region-input {
            width: 100px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #e4e4e7;
            font-size: 0.95rem;
            text-align: center;
        }

        .region-input:focus {
            outline: none;
            border-color: #7c3aed;
        }

        .region-duration {
            padding: 8px 16px;
            background: rgba(124, 58, 237, 0.2);
            border-radius: 8px;
            color: #a78bfa;
            font-size: 0.9rem;
        }

        /* æ’­æ”¾æ§åˆ¶ */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: #e4e4e7;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(124, 58, 237, 0.3);
            transform: scale(1.1);
        }

        .control-btn.play-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            font-size: 1.5rem;
        }

        .control-btn.play-btn:hover {
            background: linear-gradient(135deg, #8b5cf6, #818cf8);
        }

        .current-time {
            color: #a1a1aa;
            font-size: 0.9rem;
            min-width: 100px;
            text-align: center;
            font-family: monospace;
        }

        /* æ“ä½œæŒ‰é’® */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 14px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cut-btn {
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            color: #fff;
        }

        .cut-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #8b5cf6, #818cf8);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
        }

        .cut-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .download-link {
            padding: 14px 35px;
            background: linear-gradient(135deg, #059669, #10b981);
            color: #fff;
            text-decoration: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            display: none;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .download-link.show {
            display: flex;
        }

        .download-link:hover {
            background: linear-gradient(135deg, #10b981, #34d399);
            transform: translateY(-2px);
        }

        /* å¯¼å‡ºè®¾ç½® */
        .export-settings {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .export-settings.show {
            display: block;
        }

        .export-settings h3 {
            color: #e4e4e7;
            font-size: 1rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .format-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .format-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #d4d4d8;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .format-btn:hover {
            background: rgba(124, 58, 237, 0.2);
            border-color: rgba(124, 58, 237, 0.5);
        }

        .format-btn.active {
            background: rgba(124, 58, 237, 0.3);
            border-color: #7c3aed;
            color: #fff;
        }

        .quality-row {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .quality-row.show {
            display: flex;
        }

        .quality-label {
            color: #a1a1aa;
            font-size: 0.9rem;
        }

        .quality-select {
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #e4e4e7;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .quality-select:focus {
            outline: none;
            border-color: #7c3aed;
        }

        .export-note {
            text-align: center;
            color: #71717a;
            font-size: 0.8rem;
            margin-top: 15px;
        }

        /* åŠ è½½æç¤º */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #e4e4e7;
            font-size: 1rem;
        }

        /* å¿«æ·é”®æç¤º */
        .shortcuts {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #71717a;
            font-size: 0.85rem;
        }

        .shortcut-key {
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-family: monospace;
            color: #a1a1aa;
        }

        /* ä¿¡æ¯åŒºåŸŸ */
        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .info-section h2 {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 15px;
        }

        .info-section p {
            color: #a1a1aa;
            font-size: 0.95rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .info-section ol {
            color: #a1a1aa;
            font-size: 0.9rem;
            padding-left: 20px;
        }

        .info-section li {
            margin-bottom: 10px;
        }

        .warning-box {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 10px;
            padding: 15px 20px;
            margin-top: 15px;
            color: #fbbf24;
            font-size: 0.9rem;
        }

        /* æ ¼å¼æ”¯æŒ */
        .format-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .format-tag {
            padding: 6px 14px;
            background: rgba(124, 58, 237, 0.15);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 20px;
            color: #a78bfa;
            font-size: 0.85rem;
        }

        /* å“åº”å¼ */
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
            }

            h1 {
                font-size: 1.6rem;
            }

            .editor-panel {
                padding: 20px;
            }

            .upload-area {
                padding: 30px 20px;
            }

            .audio-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .region-info {
                flex-direction: column;
            }

            .controls {
                gap: 10px;
            }

            .control-btn {
                width: 45px;
                height: 45px;
            }

            .control-btn.play-btn {
                width: 55px;
                height: 55px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .shortcuts {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">æ­£åœ¨å¤„ç†...</div>
    </div>

    <div class="container">
        <a href="index.html" class="back-home">â† è¿”å›å·¥å…·ç®±</a>

        <header>
            <h1>éŸ³é¢‘å‰ªè¾‘</h1>
            <p class="subtitle">åœ¨çº¿å¯è§†åŒ–éŸ³é¢‘è£å‰ªï¼Œæ”¯æŒå¤šç§æ ¼å¼</p>
        </header>

        <div class="editor-panel">
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸµ</div>
                <div class="upload-text">æ‹–æ‹½éŸ³é¢‘åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
                <div class="upload-hint">æ”¯æŒ MP3ã€WAVã€M4Aã€FLACã€AAC æ ¼å¼</div>
                <button class="upload-btn" id="uploadBtn">é€‰æ‹©éŸ³é¢‘</button>
                <input type="file" id="fileInput" accept="audio/*">
            </div>

            <!-- ç¼–è¾‘åŒºåŸŸ -->
            <div class="edit-area" id="editArea">
                <!-- éŸ³é¢‘ä¿¡æ¯ -->
                <div class="audio-info">
                    <div>
                        <div class="audio-name" id="audioName">audio.mp3</div>
                        <div class="audio-duration" id="audioDuration">æ—¶é•¿: 00:00</div>
                    </div>
                    <button class="change-file-btn" id="changeFileBtn">æ›´æ¢æ–‡ä»¶</button>
                </div>

                <!-- æ³¢å½¢ -->
                <div class="waveform-container">
                    <div id="waveform">
                        <div class="trim-overlay-left" id="trimLeft"></div>
                        <div class="trim-overlay-right" id="trimRight"></div>
                    </div>
                    <div class="timeline">
                        <span id="timeStart">00:00</span>
                        <span id="timeEnd">00:00</span>
                    </div>
                </div>

                <!-- å‰ªè¾‘åŒºé—´ -->
                <div class="region-info">
                    <div class="region-time">
                        <span class="region-label">èµ·ç‚¹</span>
                        <input type="text" class="region-input" id="startTime" value="00:00.000" readonly>
                    </div>
                    <div class="region-time">
                        <span class="region-label">ç»ˆç‚¹</span>
                        <input type="text" class="region-input" id="endTime" value="00:00.000" readonly>
                    </div>
                    <div class="region-duration" id="regionDuration">é€‰ä¸­æ—¶é•¿: 00:00</div>
                </div>

                <!-- æ’­æ”¾æ§åˆ¶ -->
                <div class="controls">
                    <span class="current-time" id="currentTime">00:00.000</span>
                    <button class="control-btn" id="skipBackBtn" title="åé€€5ç§’">âª</button>
                    <button class="control-btn play-btn" id="playBtn" title="æ’­æ”¾/æš‚åœ">â–¶</button>
                    <button class="control-btn" id="skipForwardBtn" title="å‰è¿›5ç§’">â©</button>
                    <button class="control-btn" id="previewRegionBtn" title="è¯•å¬å‰ªè¾‘ç‰‡æ®µ" style="background: rgba(34, 197, 94, 0.3); border: 2px solid #22c55e;">ğŸ§</button>
                </div>

                <!-- å¿«æ·é”®æç¤º -->
                <div class="shortcuts">
                    <div class="shortcut-item">
                        <span class="shortcut-key">[</span>
                        <span>è®¾ç½®èµ·ç‚¹</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">]</span>
                        <span>è®¾ç½®ç»ˆç‚¹</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">ç©ºæ ¼</span>
                        <span>æ’­æ”¾/æš‚åœ</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">ğŸ§</span>
                        <span>è¯•å¬å‰ªè¾‘ç‰‡æ®µ</span>
                    </div>
                </div>

                <!-- å¯¼å‡ºè®¾ç½® -->
                <div class="export-settings show" id="exportSettings">
                    <h3>é€‰æ‹©å¯¼å‡ºæ ¼å¼</h3>
                    <div class="format-options" id="formatOptions">
                        <button class="format-btn" data-format="mp3">MP3</button>
                        <button class="format-btn active" data-format="wav">WAV</button>
                        <button class="format-btn" data-format="ogg">OGG</button>
                        <button class="format-btn" data-format="m4a">M4A</button>
                        <button class="format-btn" data-format="flac">FLAC</button>
                        <button class="format-btn" data-format="aac">AAC</button>
                    </div>
                    <div class="quality-row" id="qualityRow">
                        <span class="quality-label">éŸ³è´¨ï¼š</span>
                        <select class="quality-select" id="qualitySelect">
                            <option value="320">320 kbps (é«˜è´¨é‡)</option>
                            <option value="256">256 kbps</option>
                            <option value="192" selected>192 kbps (æ¨è)</option>
                            <option value="128">128 kbps</option>
                            <option value="96">96 kbps (å°æ–‡ä»¶)</option>
                        </select>
                    </div>
                    <p class="export-note" id="exportNote">WAV æ ¼å¼ä¸ºæ— æŸéŸ³é¢‘ï¼Œæ–‡ä»¶è¾ƒå¤§ï¼Œæ— éœ€ç¼–ç å™¨</p>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="action-buttons" style="margin-top: 25px;">
                    <button class="action-btn cut-btn" id="cutBtn">âœ‚ å¼€å§‹å‰ªè¾‘</button>
                    <a class="download-link" id="downloadLink" href="#" download>â¬‡ ä¸‹è½½å‰ªè¾‘</a>
                </div>
            </div>
        </div>

        <!-- è¯´æ˜ -->
        <div class="info-section">
            <h2>æ”¯æŒçš„æ ¼å¼</h2>
            <div class="format-tags">
                <span class="format-tag">MP3</span>
                <span class="format-tag">WAV</span>
                <span class="format-tag">M4A</span>
                <span class="format-tag">FLAC</span>
                <span class="format-tag">AAC</span>
                <span class="format-tag">OGG</span>
            </div>
            <div class="warning-box">
                âš ï¸ ç§»åŠ¨è®¾å¤‡æµè§ˆå™¨ä¸Šå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ç”µè„‘æµè§ˆå™¨è¿›è¡Œç¼–è¾‘ã€‚
            </div>
        </div>

        <div class="info-section">
            <h2>ä½¿ç”¨è¯´æ˜</h2>
            <ol>
                <li><strong>ä¸Šä¼ éŸ³é¢‘</strong>ï¼šæ‹–æ‹½æ–‡ä»¶æˆ–ç‚¹å‡»é€‰æ‹©æŒ‰é’®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Ctrl+V / Command+V ç²˜è´´</li>
                <li><strong>é€‰æ‹©å‰ªè¾‘åŒºé—´</strong>ï¼šåœ¨æ³¢å½¢ä¸Šæ‹–åŠ¨è°ƒæ•´èµ·ç‚¹å’Œç»ˆç‚¹</li>
                <li><strong>å¿«æ·é”®æ“ä½œ</strong>ï¼š
                    <ul style="margin-top: 5px; padding-left: 20px;">
                        <li><code>[</code> è®¾ç½®å½“å‰æ’­æ”¾è¿›åº¦ä¸ºå‰ªè¾‘èµ·ç‚¹</li>
                        <li><code>]</code> è®¾ç½®å½“å‰æ’­æ”¾è¿›åº¦ä¸ºå‰ªè¾‘ç»ˆç‚¹</li>
                        <li><code>ç©ºæ ¼é”®</code> æ§åˆ¶æ’­æ”¾/æš‚åœ</li>
                    </ul>
                </li>
                <li><strong>é€‰æ‹©å¯¼å‡ºæ ¼å¼</strong>ï¼šç‚¹å‡»æ ¼å¼æŒ‰é’®é€‰æ‹© MP3/WAV/OGG/M4A/FLAC/AAC</li>
                <li><strong>å‰ªè¾‘å¯¼å‡º</strong>ï¼šç‚¹å‡»"å¼€å§‹å‰ªè¾‘"æŒ‰é’®ï¼Œå®Œæˆåç‚¹å‡»ä¸‹è½½</li>
            </ol>
        </div>
    </div>

    <!-- WaveSurfer.js -->
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/regions.min.js"></script>

    <script>
        // çŠ¶æ€
        let wavesurfer = null;
        let regionsPlugin = null;
        let currentRegion = null;
        let audioBuffer = null;
        let audioContext = null;
        let originalFile = null;
        let selectedFormat = 'wav';
        let ffmpeg = null;
        let ffmpegLoaded = false;

        // å…ƒç´ 
        const uploadArea = document.getElementById('uploadArea');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const editArea = document.getElementById('editArea');
        const audioName = document.getElementById('audioName');
        const audioDuration = document.getElementById('audioDuration');
        const changeFileBtn = document.getElementById('changeFileBtn');
        const startTime = document.getElementById('startTime');
        const endTime = document.getElementById('endTime');
        const regionDuration = document.getElementById('regionDuration');
        const currentTimeEl = document.getElementById('currentTime');
        const playBtn = document.getElementById('playBtn');
        const skipBackBtn = document.getElementById('skipBackBtn');
        const skipForwardBtn = document.getElementById('skipForwardBtn');
        const previewRegionBtn = document.getElementById('previewRegionBtn');
        const cutBtn = document.getElementById('cutBtn');
        const downloadLink = document.getElementById('downloadLink');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');
        const timeStart = document.getElementById('timeStart');
        const timeEnd = document.getElementById('timeEnd');
        const trimLeft = document.getElementById('trimLeft');
        const trimRight = document.getElementById('trimRight');
        const formatOptions = document.getElementById('formatOptions');
        const qualityRow = document.getElementById('qualityRow');
        const qualitySelect = document.getElementById('qualitySelect');
        const exportNote = document.getElementById('exportNote');

        // æ ¼å¼è¯´æ˜
        const formatNotes = {
            mp3: 'MP3 æ ¼å¼å…¼å®¹æ€§æœ€å¥½ï¼Œæ–‡ä»¶è¾ƒå°ï¼ˆéœ€åŠ è½½ç¼–ç å™¨ï¼‰',
            wav: 'WAV æ ¼å¼ä¸ºæ— æŸéŸ³é¢‘ï¼Œæ–‡ä»¶è¾ƒå¤§ï¼Œæ— éœ€ç¼–ç å™¨ï¼ˆæ¨èï¼‰',
            ogg: 'OGG æ ¼å¼å¼€æºå…è´¹ï¼Œè´¨é‡å¥½ï¼ˆéœ€åŠ è½½ç¼–ç å™¨ï¼‰',
            m4a: 'M4A æ ¼å¼é€‚åˆ Apple è®¾å¤‡ï¼ˆéœ€åŠ è½½ç¼–ç å™¨ï¼‰',
            flac: 'FLAC æ ¼å¼æ— æŸå‹ç¼©ï¼ŒéŸ³è´¨æœ€ä½³ï¼ˆéœ€åŠ è½½ç¼–ç å™¨ï¼‰',
            aac: 'AAC æ ¼å¼é«˜æ•ˆå‹ç¼©ï¼ŒéŸ³è´¨å¥½ï¼ˆéœ€åŠ è½½ç¼–ç å™¨ï¼‰'
        };

        // éœ€è¦æ¯”ç‰¹ç‡è®¾ç½®çš„æ ¼å¼
        const bitrateFormats = ['mp3', 'ogg', 'm4a', 'aac'];

        // è®°å½•ä¸Šä¸€æ¬¡åŒºåŸŸè¾¹ç•Œï¼Œç”¨äºåˆ¤æ–­æ‹–åŠ¨çš„æ˜¯å“ªä¸€ä¾§
        let lastRegionStart = 0;
        let lastRegionEnd = 0;

        // åˆå§‹åŒ– WaveSurfer
        function initWaveSurfer() {
            if (wavesurfer) {
                wavesurfer.destroy();
            }

            regionsPlugin = WaveSurfer.Regions.create();

            wavesurfer = WaveSurfer.create({
                container: '#waveform',
                waveColor: '#8b5cf6',
                progressColor: '#c4b5fd',
                cursorColor: '#22c55e',
                cursorWidth: 2,
                barWidth: 2,
                barGap: 1,
                barRadius: 2,
                height: 128,
                normalize: true,
                plugins: [regionsPlugin]
            });

            // åŠ è½½å®Œæˆ
            wavesurfer.on('ready', () => {
                const duration = wavesurfer.getDuration();
                audioDuration.textContent = `æ—¶é•¿: ${formatTime(duration)}`;
                timeEnd.textContent = formatTime(duration);

                // åˆ›å»ºé»˜è®¤é€‰åŒºï¼ˆå…¨é€‰ï¼‰
                createRegion(0, duration);

                // åˆå§‹åŒ–é®ç½©
                updateTrimOverlays();
            });

            // æ’­æ”¾è¿›åº¦æ›´æ–°ï¼ˆæ˜¾ç¤ºæ¯«ç§’ï¼‰
            wavesurfer.on('timeupdate', (time) => {
                currentTimeEl.textContent = formatTimeMs(time);
            });

            // æ’­æ”¾çŠ¶æ€
            wavesurfer.on('play', () => {
                playBtn.textContent = 'â¸';
            });

            wavesurfer.on('pause', () => {
                playBtn.textContent = 'â–¶';
            });

            // ç‚¹å‡»æ³¢å½¢è·³è½¬
            wavesurfer.on('click', (relativeX) => {
                wavesurfer.seekTo(relativeX);
            });
        }

        // åˆ›å»ºé€‰åŒº
        function createRegion(start, end) {
            // æ¸…é™¤æ—§é€‰åŒº
            regionsPlugin.clearRegions();

            currentRegion = regionsPlugin.addRegion({
                start: start,
                end: end,
                color: 'rgba(34, 197, 94, 0.25)',
                drag: true,
                resize: true
            });

            // è®°å½•åˆå§‹è¾¹ç•Œ
            lastRegionStart = start;
            lastRegionEnd = end;

            updateRegionInfo();
            updateTrimOverlays();

            // é€‰åŒºå˜åŒ–äº‹ä»¶ - æ‹–åŠ¨æ—¶è‡ªåŠ¨ä»è¯¥ä½ç½®æ’­æ”¾
            currentRegion.on('update', () => {
                const newStart = currentRegion.start;
                const newEnd = currentRegion.end;

                // åˆ¤æ–­æ˜¯æ‹–åŠ¨äº†èµ·ç‚¹è¿˜æ˜¯ç»ˆç‚¹
                if (Math.abs(newStart - lastRegionStart) > 0.01) {
                    // èµ·ç‚¹å˜åŒ–ï¼Œä»èµ·ç‚¹å¼€å§‹æ’­æ”¾ï¼ˆæŒç»­æ’­æ”¾ï¼Œä¸æš‚åœï¼‰
                    wavesurfer.setTime(newStart);
                    wavesurfer.play();
                } else if (Math.abs(newEnd - lastRegionEnd) > 0.01) {
                    // ç»ˆç‚¹å˜åŒ–ï¼Œä»ç»ˆç‚¹ä½ç½®å¼€å§‹æ’­æ”¾ï¼ˆæŒç»­æ’­æ”¾ï¼Œä¸æš‚åœï¼‰
                    wavesurfer.setTime(newEnd);
                    wavesurfer.play();
                }

                // æ›´æ–°è®°å½•
                lastRegionStart = newStart;
                lastRegionEnd = newEnd;

                updateRegionInfo();
                updateTrimOverlays();
            });
        }

        // æ›´æ–°è£å‰ªé®ç½©ä½ç½®
        function updateTrimOverlays() {
            if (!wavesurfer || !currentRegion) return;

            const duration = wavesurfer.getDuration();
            if (duration <= 0) return;

            const waveformEl = document.getElementById('waveform');
            const totalWidth = waveformEl.offsetWidth;

            // è®¡ç®—å·¦ä¾§é®ç½©å®½åº¦ï¼ˆèµ·ç‚¹ä¹‹å‰çš„éƒ¨åˆ†ï¼‰
            const leftWidth = (currentRegion.start / duration) * totalWidth;
            trimLeft.style.width = leftWidth + 'px';

            // è®¡ç®—å³ä¾§é®ç½©å®½åº¦ï¼ˆç»ˆç‚¹ä¹‹åçš„éƒ¨åˆ†ï¼‰
            const rightWidth = ((duration - currentRegion.end) / duration) * totalWidth;
            trimRight.style.width = rightWidth + 'px';
        }

        // æ›´æ–°é€‰åŒºä¿¡æ¯
        function updateRegionInfo() {
            if (!currentRegion) return;

            startTime.value = formatTimeMs(currentRegion.start);
            endTime.value = formatTimeMs(currentRegion.end);

            const duration = currentRegion.end - currentRegion.start;
            regionDuration.textContent = `é€‰ä¸­æ—¶é•¿: ${formatTime(duration)}`;
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function formatTimeMs(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            const ms = Math.floor((seconds % 1) * 1000);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`;
        }

        // åŠ è½½éŸ³é¢‘
        function loadAudio(file) {
            originalFile = file;
            showLoading('æ­£åœ¨åŠ è½½éŸ³é¢‘...');

            initWaveSurfer();

            audioName.textContent = file.name;
            uploadArea.classList.add('hidden');
            editArea.classList.add('active');
            downloadLink.classList.remove('show');

            wavesurfer.loadBlob(file);

            // åŒæ—¶åŠ è½½åˆ° AudioContext
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    audioBuffer = await audioContext.decodeAudioData(e.target.result);
                    hideLoading();
                } catch (err) {
                    console.error('éŸ³é¢‘è§£ç å¤±è´¥:', err);
                    hideLoading();
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // ä¸Šä¼ äº‹ä»¶
        uploadBtn.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('click', (e) => {
            if (e.target === uploadArea || e.target.classList.contains('upload-icon') ||
                e.target.classList.contains('upload-text') || e.target.classList.contains('upload-hint')) {
                fileInput.click();
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                loadAudio(e.target.files[0]);
            }
        });

        changeFileBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // æ‹–æ‹½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('audio/')) {
                loadAudio(file);
            }
        });

        // ç²˜è´´
        document.addEventListener('paste', (e) => {
            const items = e.clipboardData.items;
            for (let item of items) {
                if (item.type.startsWith('audio/')) {
                    const file = item.getAsFile();
                    if (file) {
                        loadAudio(file);
                    }
                    break;
                }
            }
        });

        // æ’­æ”¾æ§åˆ¶
        playBtn.addEventListener('click', () => {
            wavesurfer.playPause();
        });

        skipBackBtn.addEventListener('click', () => {
            wavesurfer.skip(-5);
        });

        skipForwardBtn.addEventListener('click', () => {
            wavesurfer.skip(5);
        });

        // è¯•å¬å‰ªè¾‘ç‰‡æ®µï¼ˆåªæ’­æ”¾é€‰ä¸­åŒºåŸŸï¼Œåˆ°ç»ˆç‚¹è‡ªåŠ¨åœæ­¢ï¼‰
        let previewEndHandler = null;
        previewRegionBtn.addEventListener('click', () => {
            if (!currentRegion || !wavesurfer) return;

            // ç§»é™¤ä¹‹å‰çš„ç›‘å¬å™¨
            if (previewEndHandler) {
                wavesurfer.un('timeupdate', previewEndHandler);
            }

            // ä»é€‰åŒºèµ·ç‚¹å¼€å§‹æ’­æ”¾
            wavesurfer.setTime(currentRegion.start);
            wavesurfer.play();

            // ç›‘å¬æ’­æ”¾è¿›åº¦ï¼Œåˆ°è¾¾ç»ˆç‚¹æ—¶è‡ªåŠ¨æš‚åœ
            previewEndHandler = (time) => {
                if (time >= currentRegion.end) {
                    // é‡è¦ï¼šå¿…é¡»å…ˆå–æ¶ˆç›‘å¬å†è°ƒç”¨ setTimeï¼Œå¦åˆ™ä¼šæ— é™é€’å½’
                    wavesurfer.un('timeupdate', previewEndHandler);
                    previewEndHandler = null;
                    wavesurfer.pause();
                    wavesurfer.setTime(currentRegion.end);
                }
            };
            wavesurfer.on('timeupdate', previewEndHandler);
        });

        // æ ¼å¼é€‰æ‹©
        formatOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('.format-btn');
            if (!btn) return;

            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            selectedFormat = btn.dataset.format;

            // æ›´æ–°è¯´æ˜æ–‡å­—
            exportNote.textContent = formatNotes[selectedFormat];

            // æ˜¾ç¤º/éšè—æ¯”ç‰¹ç‡è®¾ç½®
            if (bitrateFormats.includes(selectedFormat)) {
                qualityRow.classList.add('show');
            } else {
                qualityRow.classList.remove('show');
            }

            // éšè—ä¸‹è½½æŒ‰é’®ï¼ˆéœ€è¦é‡æ–°å‰ªè¾‘ï¼‰
            downloadLink.classList.remove('show');
        });

        // åˆå§‹åŒ– FFmpegï¼ˆä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼‰
        async function initFFmpeg() {
            if (ffmpegLoaded) return true;

            // æ£€æŸ¥æ˜¯å¦ä¸ºæœ¬åœ°æ–‡ä»¶åè®®
            if (window.location.protocol === 'file:') {
                alert('æœ¬åœ°é¢„è§ˆæ¨¡å¼ä¸æ”¯æŒ MP3/OGG/M4A/AAC/FLAC æ ¼å¼è½¬æ¢ã€‚\n\nè¯·é€‰æ‹© WAV æ ¼å¼å¯¼å‡ºï¼Œæˆ–å°†ç½‘é¡µéƒ¨ç½²åˆ°æœåŠ¡å™¨åä½¿ç”¨å®Œæ•´åŠŸèƒ½ã€‚');
                return false;
            }

            try {
                // å¸¦è¿›åº¦æ˜¾ç¤ºçš„èµ„æºä¸‹è½½
                async function fetchWithProgress(url, label) {
                    loadingText.textContent = `æ­£åœ¨ä¸‹è½½${label}...`;
                    console.log(`å¼€å§‹ä¸‹è½½: ${url}`);
                    const startTime = Date.now();

                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`ä¸‹è½½å¤±è´¥: ${url} (${response.status})`);

                    const contentLength = response.headers.get('content-length');
                    const total = contentLength ? parseInt(contentLength, 10) : 0;

                    if (!response.body || !total) {
                        // æ— æ³•è·å–è¿›åº¦ï¼Œç›´æ¥ä¸‹è½½
                        const blob = await response.blob();
                        const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                        console.log(`ä¸‹è½½å®Œæˆ: ${label} (${(blob.size / 1024 / 1024).toFixed(2)}MB, ${elapsed}s)`);
                        return blob;
                    }

                    // å¸¦è¿›åº¦çš„ä¸‹è½½
                    const reader = response.body.getReader();
                    const chunks = [];
                    let received = 0;

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        chunks.push(value);
                        received += value.length;
                        // é™åˆ¶ç™¾åˆ†æ¯”ä¸è¶…è¿‡100%ï¼ˆContent-Lengthå¯èƒ½ä¸å‡†ç¡®ï¼‰
                        const percent = Math.min(100, Math.round((received / total) * 100));
                        loadingText.textContent = `æ­£åœ¨ä¸‹è½½${label}... ${percent}%`;
                    }

                    const blob = new Blob(chunks);
                    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                    console.log(`ä¸‹è½½å®Œæˆ: ${label} (${(blob.size / 1024 / 1024).toFixed(2)}MB, ${elapsed}s)`);
                    return blob;
                }

                // è½¬æ¢ä¸º Blob URL
                function toBlobURL(blob, mimeType) {
                    return URL.createObjectURL(new Blob([blob], { type: mimeType }));
                }

                console.log('å¼€å§‹åŠ è½½ FFmpeg...');
                const loadStartTime = Date.now();

                // ä½¿ç”¨ jsdelivr CDNï¼ˆé€šå¸¸åœ¨ä¸­å›½è®¿é—®æ›´å¿«ï¼‰
                const baseURL = 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm';

                // 1. ä¸‹è½½æ ¸å¿ƒæ–‡ä»¶
                loadingText.textContent = 'æ­£åœ¨ä¸‹è½½ç¼–ç å™¨æ ¸å¿ƒ...';
                const coreBlob = await fetchWithProgress(`${baseURL}/ffmpeg-core.js`, 'æ ¸å¿ƒæ¨¡å—');
                const coreURL = toBlobURL(coreBlob, 'text/javascript');

                // 2. ä¸‹è½½ WASM æ–‡ä»¶ï¼ˆæœ€å¤§ï¼Œçº¦ 32MBï¼‰
                const wasmBlob = await fetchWithProgress(`${baseURL}/ffmpeg-core.wasm`, 'WASMå¼•æ“');
                const wasmURL = toBlobURL(wasmBlob, 'application/wasm');

                // 3. ä¸‹è½½ Worker æ–‡ä»¶
                const workerBlob = await fetchWithProgress('https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.10/dist/esm/worker.js', 'Worker');
                const workerURL = toBlobURL(workerBlob, 'text/javascript');

                // 4. åŠ¨æ€åŠ è½½ FFmpeg æ¨¡å—ï¼ˆä½¿ç”¨ esm.shï¼Œä¸“ä¸ºæµè§ˆå™¨ ESM è®¾è®¡ï¼‰
                loadingText.textContent = 'æ­£åœ¨åˆå§‹åŒ–ç¼–ç å™¨æ¨¡å—...';
                console.log('åŠ è½½ FFmpeg æ¨¡å—...');
                const { FFmpeg } = await import('https://esm.sh/@ffmpeg/ffmpeg@0.12.10');

                ffmpeg = new FFmpeg();

                // åŠ è½½è¿›åº¦å›è°ƒ
                ffmpeg.on('progress', ({ progress }) => {
                    const percent = Math.round(progress * 100);
                    loadingText.textContent = `æ­£åœ¨è½¬æ¢... ${percent}%`;
                });

                // 5. åˆå§‹åŒ– FFmpeg
                loadingText.textContent = 'æ­£åœ¨åˆå§‹åŒ–ç¼–ç å™¨...';
                console.log('åˆå§‹åŒ– FFmpeg...');
                await ffmpeg.load({
                    coreURL: coreURL,
                    wasmURL: wasmURL,
                    classWorkerURL: workerURL
                });

                const totalTime = ((Date.now() - loadStartTime) / 1000).toFixed(1);
                console.log(`FFmpeg åŠ è½½å®Œæˆï¼Œæ€»è€—æ—¶: ${totalTime}s`);

                ffmpegLoaded = true;
                return true;
            } catch (err) {
                console.error('FFmpeg åŠ è½½å¤±è´¥:', err);
                // æ˜¾ç¤ºæ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                alert('ç¼–ç å™¨åŠ è½½å¤±è´¥: ' + err.message + '\n\nå»ºè®®ï¼š\n1. è¯·ä½¿ç”¨ç°ä»£æµè§ˆå™¨ï¼ˆChrome/Edge/Firefoxï¼‰\n2. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸\n3. é€‰æ‹© WAV æ ¼å¼å¯ç›´æ¥å¯¼å‡ºï¼ˆæ— éœ€ç¼–ç å™¨ï¼‰');
                return false;
            }
        }

        // å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (!wavesurfer || !editArea.classList.contains('active')) return;

            if (e.code === 'Space') {
                e.preventDefault();
                wavesurfer.playPause();
            } else if (e.key === '[') {
                e.preventDefault();
                const time = wavesurfer.getCurrentTime();
                if (currentRegion && time < currentRegion.end) {
                    currentRegion.setOptions({ start: time });
                    lastRegionStart = time;
                    updateRegionInfo();
                    updateTrimOverlays();
                }
            } else if (e.key === ']') {
                e.preventDefault();
                const time = wavesurfer.getCurrentTime();
                if (currentRegion && time > currentRegion.start) {
                    currentRegion.setOptions({ end: time });
                    lastRegionEnd = time;
                    updateRegionInfo();
                    updateTrimOverlays();
                }
            }
        });

        // å‰ªè¾‘
        cutBtn.addEventListener('click', async () => {
            if (!audioBuffer || !currentRegion) return;

            showLoading('æ­£åœ¨å‰ªè¾‘éŸ³é¢‘...');

            try {
                const startSample = Math.floor(currentRegion.start * audioBuffer.sampleRate);
                const endSample = Math.floor(currentRegion.end * audioBuffer.sampleRate);
                const length = endSample - startSample;

                // åˆ›å»ºæ–°çš„ AudioBuffer
                const newBuffer = audioContext.createBuffer(
                    audioBuffer.numberOfChannels,
                    length,
                    audioBuffer.sampleRate
                );

                // å¤åˆ¶æ•°æ®
                for (let channel = 0; channel < audioBuffer.numberOfChannels; channel++) {
                    const sourceData = audioBuffer.getChannelData(channel);
                    const targetData = newBuffer.getChannelData(channel);
                    for (let i = 0; i < length; i++) {
                        targetData[i] = sourceData[startSample + i];
                    }
                }

                // è½¬æ¢ä¸º WAV
                const wavBlob = audioBufferToWav(newBuffer);
                const baseName = originalFile.name.replace(/\.[^.]+$/, '');

                // å¦‚æœé€‰æ‹©çš„æ˜¯ WAV æ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨
                if (selectedFormat === 'wav') {
                    const url = URL.createObjectURL(wavBlob);
                    downloadLink.href = url;
                    downloadLink.download = `${baseName}_cut.wav`;
                    downloadLink.classList.add('show');
                    hideLoading();
                    return;
                }

                // å…¶ä»–æ ¼å¼éœ€è¦ä½¿ç”¨ FFmpeg è½¬æ¢
                showLoading('æ­£åœ¨åŠ è½½ç¼–ç å™¨...');

                const loaded = await initFFmpeg();
                if (!loaded) {
                    throw new Error('ç¼–ç å™¨åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }

                showLoading('æ­£åœ¨è½¬æ¢æ ¼å¼...');

                // å†™å…¥ WAV æ–‡ä»¶
                const wavData = new Uint8Array(await wavBlob.arrayBuffer());
                await ffmpeg.writeFile('input.wav', wavData);

                // æ„å»º FFmpeg å‘½ä»¤å‚æ•°
                const bitrate = qualitySelect.value;
                let outputFile = `output.${selectedFormat}`;
                let ffmpegArgs = ['-i', 'input.wav'];

                switch (selectedFormat) {
                    case 'mp3':
                        // ä½¿ç”¨ libmp3lame ç¼–ç å™¨
                        ffmpegArgs.push('-c:a', 'libmp3lame', '-q:a', '2');
                        break;
                    case 'ogg':
                        // ä½¿ç”¨ libvorbis ç¼–ç å™¨
                        ffmpegArgs.push('-c:a', 'libvorbis', '-q:a', '4');
                        break;
                    case 'm4a':
                        // AAC ç¼–ç 
                        ffmpegArgs.push('-c:a', 'aac', '-b:a', `${bitrate}k`);
                        outputFile = 'output.m4a';
                        break;
                    case 'aac':
                        // AAC ç¼–ç 
                        ffmpegArgs.push('-c:a', 'aac', '-b:a', `${bitrate}k`);
                        break;
                    case 'flac':
                        // FLAC æ— æŸç¼–ç 
                        ffmpegArgs.push('-c:a', 'flac');
                        break;
                }

                ffmpegArgs.push(outputFile);

                // æ‰§è¡Œè½¬æ¢
                await ffmpeg.exec(ffmpegArgs);

                // è¯»å–è¾“å‡ºæ–‡ä»¶
                const outputData = await ffmpeg.readFile(outputFile);

                // ç¡®å®š MIME ç±»å‹
                const mimeTypes = {
                    mp3: 'audio/mpeg',
                    ogg: 'audio/ogg',
                    m4a: 'audio/mp4',
                    aac: 'audio/aac',
                    flac: 'audio/flac'
                };

                const outputBlob = new Blob([outputData.buffer], { type: mimeTypes[selectedFormat] });
                const url = URL.createObjectURL(outputBlob);

                downloadLink.href = url;
                downloadLink.download = `${baseName}_cut.${selectedFormat}`;
                downloadLink.classList.add('show');

                // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
                await ffmpeg.deleteFile('input.wav');
                await ffmpeg.deleteFile(outputFile);

                hideLoading();
            } catch (err) {
                console.error('å‰ªè¾‘å¤±è´¥:', err);
                hideLoading();
                alert('å‰ªè¾‘å¤±è´¥: ' + err.message);
            }
        });

        // AudioBuffer è½¬ WAV
        function audioBufferToWav(buffer) {
            const numChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const format = 1; // PCM
            const bitDepth = 16;

            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;

            const dataLength = buffer.length * blockAlign;
            const bufferLength = 44 + dataLength;

            const arrayBuffer = new ArrayBuffer(bufferLength);
            const view = new DataView(arrayBuffer);

            // WAV Header
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataLength, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, format, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * blockAlign, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitDepth, true);
            writeString(view, 36, 'data');
            view.setUint32(40, dataLength, true);

            // éŸ³é¢‘æ•°æ®
            let offset = 44;
            for (let i = 0; i < buffer.length; i++) {
                for (let channel = 0; channel < numChannels; channel++) {
                    const sample = buffer.getChannelData(channel)[i];
                    const intSample = Math.max(-1, Math.min(1, sample)) * 0x7FFF;
                    view.setInt16(offset, intSample, true);
                    offset += 2;
                }
            }

            return new Blob([arrayBuffer], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // åŠ è½½æç¤º
        function showLoading(text) {
            loadingText.textContent = text;
            loadingOverlay.classList.add('active');
        }

        function hideLoading() {
            loadingOverlay.classList.remove('active');
        }

        // çª—å£å¤§å°å˜åŒ–æ—¶æ›´æ–°é®ç½©
        window.addEventListener('resize', () => {
            updateTrimOverlays();
        });
    </script>
</body>
</html>
