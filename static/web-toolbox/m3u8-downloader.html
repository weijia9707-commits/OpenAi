<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U8 è§†é¢‘ä¸‹è½½å™¨ - åœ¨çº¿æ‰¹é‡ä¸‹è½½M3U8æµåª’ä½“è§†é¢‘ | Web Toolbox</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="å…è´¹åœ¨çº¿M3U8è§†é¢‘ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒæ‰¹é‡ä¸‹è½½M3U8/HLSæµåª’ä½“è§†é¢‘å¹¶ä¿å­˜ä¸ºMP4æ–‡ä»¶ã€‚å®æ—¶é¢„è§ˆã€è¿›åº¦æ˜¾ç¤ºã€æš‚åœç»§ç»­ï¼Œçº¯å‰ç«¯è¿è¡Œæ— éœ€å®‰è£…ã€‚">
    <meta name="keywords" content="M3U8ä¸‹è½½å™¨,M3U8è½¬MP4,HLSä¸‹è½½,æµåª’ä½“ä¸‹è½½,è§†é¢‘ä¸‹è½½å·¥å…·,åœ¨çº¿è§†é¢‘ä¸‹è½½,æ‰¹é‡ä¸‹è½½,å…è´¹å·¥å…·">
    <meta name="author" content="heyuan110">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.heyuan110.com/web-toolbox/m3u8-downloader.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.heyuan110.com/web-toolbox/m3u8-downloader.html">
    <meta property="og:title" content="M3U8 è§†é¢‘ä¸‹è½½å™¨ - åœ¨çº¿æ‰¹é‡ä¸‹è½½æµåª’ä½“è§†é¢‘">
    <meta property="og:description" content="å…è´¹åœ¨çº¿M3U8è§†é¢‘ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒæ‰¹é‡ä¸‹è½½å¹¶ä¿å­˜ä¸ºMP4ã€‚å®æ—¶é¢„è§ˆã€è¿›åº¦æ˜¾ç¤ºï¼Œçº¯å‰ç«¯æ— éœ€å®‰è£…ã€‚">
    <meta property="og:image" content="https://www.heyuan110.com/web-toolbox/screenshots/m3u8-downloader.png">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="Web Toolbox">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="M3U8 è§†é¢‘ä¸‹è½½å™¨ - åœ¨çº¿æ‰¹é‡ä¸‹è½½æµåª’ä½“è§†é¢‘">
    <meta name="twitter:description" content="å…è´¹åœ¨çº¿M3U8è§†é¢‘ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒæ‰¹é‡ä¸‹è½½å¹¶ä¿å­˜ä¸ºMP4ã€‚">
    <meta name="twitter:image" content="https://www.heyuan110.com/web-toolbox/screenshots/m3u8-downloader.png">

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "M3U8 è§†é¢‘ä¸‹è½½å™¨",
        "url": "https://www.heyuan110.com/web-toolbox/m3u8-downloader.html",
        "description": "åœ¨çº¿æ‰¹é‡ä¸‹è½½M3U8/HLSæµåª’ä½“è§†é¢‘å¹¶ä¿å­˜ä¸ºMP4æ–‡ä»¶",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CNY"},
        "author": {"@type": "Person", "name": "heyuan110"}
    }
    </script>

    <!-- FAQ JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "ä»€ä¹ˆæ˜¯ M3U8 æ ¼å¼ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "M3U8 æ˜¯ HLS (HTTP Live Streaming) æµåª’ä½“åè®®çš„ç´¢å¼•æ–‡ä»¶æ ¼å¼ï¼Œå®ƒåŒ…å«è§†é¢‘åˆ†ç‰‡ï¼ˆTSæ–‡ä»¶ï¼‰çš„åˆ—è¡¨ã€‚HLS æ˜¯è‹¹æœå…¬å¸å¼€å‘çš„è‡ªé€‚åº”æµåª’ä½“ä¼ è¾“åè®®ï¼Œè¢«å¹¿æ³›ç”¨äºåœ¨çº¿è§†é¢‘æ’­æ”¾ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "ä¸ºä»€ä¹ˆæœ‰äº› M3U8 æ— æ³•ä¸‹è½½ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "å¯èƒ½æ˜¯å› ä¸ºè§†é¢‘ä½¿ç”¨äº† DRM åŠ å¯†ä¿æŠ¤ï¼Œæˆ–è€…éœ€è¦ç‰¹å®šçš„è®¤è¯ä¿¡æ¯ï¼ˆå¦‚ Cookieã€Tokenï¼‰æ‰èƒ½è®¿é—®ã€‚æœ¬å·¥å…·ä»…æ”¯æŒä¸‹è½½å…¬å¼€çš„ã€æœªåŠ å¯†çš„ M3U8 è§†é¢‘æµã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "ä¸‹è½½çš„è§†é¢‘æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ä¸‹è½½åçš„è§†é¢‘ä¸º TSï¼ˆTransport Streamï¼‰æ ¼å¼ï¼Œè¿™æ˜¯ç”± M3U8 åˆ†ç‰‡åˆå¹¶è€Œæˆçš„è§†é¢‘æ–‡ä»¶ã€‚TS æ ¼å¼å¯ä»¥ç›´æ¥ä½¿ç”¨ VLCã€PotPlayer ç­‰æ’­æ”¾å™¨æ’­æ”¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ FFmpeg è½¬æ¢ä¸º MP4 æ ¼å¼ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "ä¸‹è½½é€Ÿåº¦å–å†³äºä»€ä¹ˆï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ä¸‹è½½é€Ÿåº¦ä¸»è¦å–å†³äºä¸¤ä¸ªå› ç´ ï¼šåŸå§‹è§†é¢‘æœåŠ¡å™¨çš„å¸¦å®½å’Œå“åº”é€Ÿåº¦ï¼Œä»¥åŠä½ æœ¬åœ°çš„ç½‘ç»œè¿æ¥é€Ÿåº¦ã€‚æœ¬å·¥å…·æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½ä»¥æé«˜æ•ˆç‡ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "è§†é¢‘æ•°æ®ä¼šç»è¿‡æœåŠ¡å™¨å—ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ä¸ä¼šã€‚æœ¬å·¥å…·å®Œå…¨åœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼Œè§†é¢‘æ•°æ®ç›´æ¥ä»åŸå§‹æœåŠ¡å™¨ä¸‹è½½åˆ°ä½ çš„æµè§ˆå™¨ï¼Œä¸ä¼šç»è¿‡ä»»ä½•ä¸­é—´æœåŠ¡å™¨ï¼Œä¿è¯äº†æ•°æ®å®‰å…¨å’Œéšç§ã€‚"
                }
            }
        ]
    }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e4e4e4;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d9ff;
            font-size: 2.5rem;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-section h2 {
            margin-bottom: 16px;
            color: #00d9ff;
            font-size: 1.2rem;
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .input-group input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 14px 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 14px;
            resize: vertical;
            font-family: 'Monaco', 'Consolas', monospace;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
        }

        textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 217, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #cc0022 100%);
            color: #fff;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ed573 0%, #1e9c50 100%);
            color: #fff;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa502 0%, #cc8400 100%);
            color: #000;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .task-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-section h2 {
            margin-bottom: 16px;
            color: #00d9ff;
            font-size: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-count {
            background: rgba(0, 217, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .task-list::-webkit-scrollbar {
            width: 6px;
        }

        .task-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: rgba(0, 217, 255, 0.3);
            border-radius: 3px;
        }

        .task-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            display: flex;
            gap: 16px;
        }

        .task-item:hover {
            border-color: rgba(0, 217, 255, 0.3);
        }

        .task-preview {
            flex-shrink: 0;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .task-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .task-preview .preview-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
            text-align: center;
            padding: 8px;
        }

        .task-preview .preview-placeholder svg {
            width: 32px;
            height: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }

        .task-preview .loading-placeholder .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-top-color: #00d9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 8px;
        }

        .task-preview .play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: rgba(0, 217, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .task-preview:hover .play-btn {
            opacity: 1;
        }

        .task-preview .play-btn svg {
            width: 16px;
            height: 16px;
            fill: #000;
            margin-left: 2px;
        }

        .task-preview.loading .play-btn {
            display: none;
        }

        .task-preview.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            margin: -12px 0 0 -12px;
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-top-color: #00d9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .task-preview.playing .play-btn {
            display: none;
        }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 12px;
        }

        .task-name {
            font-weight: 600;
            color: #fff;
            word-break: break-all;
            flex: 1;
        }

        .task-url {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            word-break: break-all;
            margin-top: 4px;
        }

        .task-status {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-pending {
            background: rgba(255, 255, 255, 0.1);
            color: #999;
        }

        .status-downloading {
            background: rgba(0, 217, 255, 0.2);
            color: #00d9ff;
        }

        .status-paused {
            background: rgba(255, 165, 2, 0.2);
            color: #ffa502;
        }

        .status-completed {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .status-error {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .progress-container {
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d9ff 0%, #00ff88 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .task-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .task-actions .btn {
            padding: 8px 14px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.4);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .tips {
            background: rgba(255, 165, 2, 0.1);
            border: 1px solid rgba(255, 165, 2, 0.3);
            border-radius: 10px;
            padding: 16px;
            margin-top: 24px;
            font-size: 13px;
            line-height: 1.6;
        }

        .tips h3 {
            color: #ffa502;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .tips ul {
            margin-left: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .tips li {
            margin-bottom: 4px;
        }

        .global-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .downloading .task-status {
            animation: pulse 1.5s infinite;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .input-group {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .task-item {
                flex-direction: column;
            }

            .task-preview {
                width: 100%;
                height: 180px;
            }

            .task-header {
                flex-direction: column;
            }

            .global-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link" style="display: inline-block; margin-bottom: 16px; color: #888; text-decoration: none; font-size: 14px; transition: color 0.2s;">â† è¿”å›å·¥å…·ç®±</a>
        <h1>ğŸ¬ M3U8æ‰¹é‡ä¸‹è½½å™¨</h1>

        <!-- åŠŸèƒ½ç‰¹ç‚¹åŒºå— -->
        <section class="features-section" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">â–¶ï¸</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;">åœ¨çº¿æ’­æ”¾</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;">æ”¯æŒç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ’­æ”¾ M3U8/HLS è§†é¢‘æµï¼Œæ— éœ€é¢å¤–æ’­æ”¾å™¨</p>
            </div>
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">ğŸ’¾</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;">è§†é¢‘ä¸‹è½½</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;">è§£æ M3U8 æ–‡ä»¶ï¼Œè‡ªåŠ¨ä¸‹è½½æ‰€æœ‰åˆ†ç‰‡å¹¶åˆå¹¶ä¸ºå®Œæ•´è§†é¢‘æ–‡ä»¶</p>
            </div>
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">ğŸšï¸</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;">å¤šæ¸…æ™°åº¦</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;">è‡ªåŠ¨è¯†åˆ«å¤šæ¸…æ™°åº¦æµï¼Œæ”¯æŒé€‰æ‹©ä¸åŒè´¨é‡ç‰ˆæœ¬ä¸‹è½½</p>
            </div>
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">ğŸ“Š</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;">è¿›åº¦æ˜¾ç¤º</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;">å®æ—¶æ˜¾ç¤ºä¸‹è½½è¿›åº¦ã€å·²ä¸‹è½½åˆ†ç‰‡æ•°å’Œå‰©ä½™æ—¶é—´</p>
            </div>
        </section>

        <div class="input-section">
            <h2>ğŸ“¥ æ·»åŠ ä¸‹è½½ä»»åŠ¡</h2>

            <!-- å•æ¡URLè¾“å…¥ -->
            <div class="input-group">
                <input type="text" id="singleUrl" placeholder="è¾“å…¥å•ä¸ªM3U8é“¾æ¥...">
                <input type="text" id="fileName" placeholder="æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰" style="max-width: 200px;">
                <button class="btn btn-primary" onclick="addSingleTask()">
                    <span>â•</span> æ·»åŠ 
                </button>
            </div>

            <!-- æ‰¹é‡URLè¾“å…¥ -->
            <textarea id="batchUrls" placeholder="æ‰¹é‡å¯¼å…¥M3U8é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰&#10;æ”¯æŒæ ¼å¼ï¼š&#10;https://example.com/video.m3u8&#10;è‡ªå®šä¹‰åç§°|https://example.com/video.m3u8"></textarea>

            <div class="button-group">
                <button class="btn btn-primary" onclick="addBatchTasks()">
                    <span>ğŸ“‹</span> æ‰¹é‡æ·»åŠ 
                </button>
                <button class="btn btn-secondary" onclick="clearInput()">
                    <span>ğŸ—‘ï¸</span> æ¸…ç©ºè¾“å…¥
                </button>
                <button class="btn btn-secondary" onclick="loadFromFile()">
                    <span>ğŸ“‚</span> ä»æ–‡ä»¶å¯¼å…¥
                </button>
                <input type="file" id="fileInput" accept=".txt" style="display: none;" onchange="handleFileImport(event)">
            </div>
        </div>

        <div class="task-section">
            <h2>
                <span>ğŸ“‹ ä¸‹è½½ä»»åŠ¡åˆ—è¡¨</span>
                <span class="task-count" id="taskCount">0 ä¸ªä»»åŠ¡</span>
            </h2>

            <div class="global-actions" style="margin-bottom: 16px;">
                <button class="btn btn-success" onclick="startAll()">
                    <span>â–¶ï¸</span> å…¨éƒ¨å¼€å§‹
                </button>
                <button class="btn btn-warning" onclick="pauseAll()">
                    <span>â¸ï¸</span> å…¨éƒ¨æš‚åœ
                </button>
                <button class="btn btn-danger" onclick="clearCompleted()">
                    <span>ğŸ—‘ï¸</span> æ¸…é™¤å·²å®Œæˆ
                </button>
                <button class="btn btn-danger" onclick="clearAll()">
                    <span>âŒ</span> æ¸…ç©ºå…¨éƒ¨
                </button>
                <button class="btn btn-primary" onclick="downloadAllCompleted()">
                    <span>ğŸ’¾</span> æ‰¹é‡ä¿å­˜å·²å®Œæˆ
                </button>
            </div>

            <div class="task-list" id="taskList">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <p>æš‚æ— ä¸‹è½½ä»»åŠ¡</p>
                    <p style="font-size: 12px; margin-top: 8px;">æ·»åŠ M3U8é“¾æ¥å¼€å§‹ä¸‹è½½</p>
                </div>
            </div>
        </div>

        <div class="tips">
            <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li>æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡æ·»åŠ M3U8é“¾æ¥</li>
                <li>æ‰¹é‡å¯¼å…¥æ ¼å¼ï¼šæ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼Œæˆ–ä½¿ç”¨ "åç§°|é“¾æ¥" æ ¼å¼è‡ªå®šä¹‰æ–‡ä»¶å</li>
                <li>ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼ŒæŸäº›è·¨åŸŸèµ„æºå¯èƒ½æ— æ³•ä¸‹è½½</li>
                <li>ä¸‹è½½çš„æ–‡ä»¶ä¸ºTSæ ¼å¼ï¼Œå¯ä½¿ç”¨FFmpegè½¬æ¢ä¸ºMP4ï¼š<code>ffmpeg -i video.ts -c copy video.mp4</code></li>
                <li>å»ºè®®ä½¿ç”¨Chromeæµè§ˆå™¨ä»¥è·å¾—æœ€ä½³ä½“éªŒ</li>
            </ul>
        </div>
    </div>

    <script>
        // ä»»åŠ¡çŠ¶æ€æšä¸¾
        const TaskStatus = {
            PENDING: 'pending',
            DOWNLOADING: 'downloading',
            PAUSED: 'paused',
            COMPLETED: 'completed',
            ERROR: 'error'
        };

        // ä»»åŠ¡åˆ—è¡¨
        let tasks = [];
        let taskIdCounter = 0;

        // å¹¶å‘ä¸‹è½½æ§åˆ¶
        const MAX_CONCURRENT_DOWNLOADS = 3;
        let activeDownloads = 0;

        // æ·»åŠ å•ä¸ªä»»åŠ¡
        function addSingleTask() {
            const urlInput = document.getElementById('singleUrl');
            const nameInput = document.getElementById('fileName');
            const url = urlInput.value.trim();
            const name = nameInput.value.trim();

            if (!url) {
                alert('è¯·è¾“å…¥M3U8é“¾æ¥');
                return;
            }

            if (!isValidUrl(url)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„URL');
                return;
            }

            createTask(url, name || extractFileName(url));
            urlInput.value = '';
            nameInput.value = '';
        }

        // æ‰¹é‡æ·»åŠ ä»»åŠ¡
        function addBatchTasks() {
            const textarea = document.getElementById('batchUrls');
            const lines = textarea.value.trim().split('\n').filter(line => line.trim());

            if (lines.length === 0) {
                alert('è¯·è¾“å…¥M3U8é“¾æ¥');
                return;
            }

            let addedCount = 0;
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                let url, name;
                if (line.includes('|')) {
                    const parts = line.split('|');
                    name = parts[0].trim();
                    url = parts[1].trim();
                } else {
                    url = line;
                    name = extractFileName(url);
                }

                if (isValidUrl(url)) {
                    createTask(url, name);
                    addedCount++;
                }
            });

            if (addedCount > 0) {
                textarea.value = '';
                alert(`æˆåŠŸæ·»åŠ  ${addedCount} ä¸ªä»»åŠ¡`);
            } else {
                alert('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„URL');
            }
        }

        // åˆ›å»ºä»»åŠ¡
        function createTask(url, name) {
            const task = {
                id: ++taskIdCounter,
                url: url,
                name: name || `video_${taskIdCounter}`,
                status: TaskStatus.PENDING,
                progress: 0,
                downloaded: 0,
                total: 0,
                segments: [],
                downloadedSegments: [],
                controller: null,
                error: null
            };
            tasks.push(task);
            renderTasks();
            updateTaskCount();
        }

        // éªŒè¯URL
        function isValidUrl(url) {
            try {
                new URL(url);
                return url.includes('.m3u8') || url.includes('m3u8');
            } catch {
                return false;
            }
        }

        // ä»URLæå–æ–‡ä»¶å
        function extractFileName(url) {
            try {
                const urlObj = new URL(url);
                const pathname = urlObj.pathname;
                const fileName = pathname.split('/').pop().replace('.m3u8', '');
                return fileName || `video_${Date.now()}`;
            } catch {
                return `video_${Date.now()}`;
            }
        }

        // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
        function renderTasks() {
            const taskList = document.getElementById('taskList');

            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <p>æš‚æ— ä¸‹è½½ä»»åŠ¡</p>
                        <p style="font-size: 12px; margin-top: 8px;">æ·»åŠ M3U8é“¾æ¥å¼€å§‹ä¸‹è½½</p>
                    </div>
                `;
                return;
            }

            taskList.innerHTML = tasks.map(task => `
                <div class="task-item ${task.status === TaskStatus.DOWNLOADING ? 'downloading' : ''}" id="task-${task.id}">
                    <div class="task-preview" id="preview-${task.id}" onclick="togglePreview(${task.id})">
                        <div class="preview-placeholder loading-placeholder">
                            <div class="loading-spinner"></div>
                            <span>åŠ è½½é¢„è§ˆ...</span>
                        </div>
                    </div>
                    <div class="task-content">
                        <div class="task-header">
                            <div>
                                <div class="task-name">${escapeHtml(task.name)}</div>
                                <div class="task-url">${escapeHtml(task.url)}</div>
                            </div>
                            <span class="task-status status-${task.status}">${getStatusText(task.status)}</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${task.progress}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>${task.progress.toFixed(1)}%</span>
                                <span>${task.downloaded}/${task.total} ç‰‡æ®µ</span>
                            </div>
                        </div>
                        ${task.error ? `<div style="color: #ff4757; font-size: 12px; margin-bottom: 8px;">é”™è¯¯: ${escapeHtml(task.error)}</div>` : ''}
                        <div class="task-actions">
                            ${getTaskActions(task)}
                        </div>
                    </div>
                </div>
            `).join('');

            // è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœªåŠ è½½çš„é¢„è§ˆ
            autoStartPreviews();
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                [TaskStatus.PENDING]: 'ç­‰å¾…ä¸­',
                [TaskStatus.DOWNLOADING]: 'ä¸‹è½½ä¸­',
                [TaskStatus.PAUSED]: 'å·²æš‚åœ',
                [TaskStatus.COMPLETED]: 'å·²å®Œæˆ',
                [TaskStatus.ERROR]: 'å‡ºé”™'
            };
            return statusMap[status] || status;
        }

        // è·å–ä»»åŠ¡æ“ä½œæŒ‰é’®
        function getTaskActions(task) {
            switch (task.status) {
                case TaskStatus.PENDING:
                    return `
                        <button class="btn btn-success" onclick="startTask(${task.id})">â–¶ï¸ å¼€å§‹</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                    `;
                case TaskStatus.DOWNLOADING:
                    return `
                        <button class="btn btn-warning" onclick="pauseTask(${task.id})">â¸ï¸ æš‚åœ</button>
                        <button class="btn btn-danger" onclick="stopTask(${task.id})">â¹ï¸ åœæ­¢</button>
                    `;
                case TaskStatus.PAUSED:
                    return `
                        <button class="btn btn-success" onclick="resumeTask(${task.id})">â–¶ï¸ ç»§ç»­</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                    `;
                case TaskStatus.COMPLETED:
                    return `
                        <button class="btn btn-primary" onclick="downloadFile(${task.id})">ğŸ’¾ ä¿å­˜æ–‡ä»¶</button>
                        <button class="btn btn-secondary" onclick="restartTask(${task.id})">ğŸ”„ é‡æ–°ä¸‹è½½</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                    `;
                case TaskStatus.ERROR:
                    return `
                        <button class="btn btn-success" onclick="restartTask(${task.id})">ğŸ”„ é‡è¯•</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                    `;
                default:
                    return '';
            }
        }

        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ›´æ–°ä»»åŠ¡è®¡æ•°
        function updateTaskCount() {
            const countEl = document.getElementById('taskCount');
            const downloading = tasks.filter(t => t.status === TaskStatus.DOWNLOADING).length;
            const completed = tasks.filter(t => t.status === TaskStatus.COMPLETED).length;
            countEl.textContent = `${tasks.length} ä¸ªä»»åŠ¡ (${downloading} ä¸‹è½½ä¸­, ${completed} å·²å®Œæˆ)`;
        }

        // å¼€å§‹ä¸‹è½½ä»»åŠ¡
        async function startTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (activeDownloads >= MAX_CONCURRENT_DOWNLOADS) {
                alert(`æœ€å¤šåŒæ—¶ä¸‹è½½ ${MAX_CONCURRENT_DOWNLOADS} ä¸ªä»»åŠ¡ï¼Œè¯·ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆ`);
                return;
            }

            task.status = TaskStatus.DOWNLOADING;
            task.error = null;
            task.controller = new AbortController();
            activeDownloads++;
            renderTasks();
            updateTaskCount();

            try {
                // è§£æM3U8
                const segments = await parseM3U8(task.url, task.controller.signal);
                task.segments = segments;
                task.total = segments.length;
                task.downloadedSegments = new Array(segments.length).fill(null);
                renderTasks();

                // ä¸‹è½½æ‰€æœ‰ç‰‡æ®µ
                await downloadSegments(task);

                if (task.status === TaskStatus.DOWNLOADING) {
                    task.status = TaskStatus.COMPLETED;
                    task.progress = 100;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    // ç”¨æˆ·å–æ¶ˆ
                } else {
                    task.status = TaskStatus.ERROR;
                    task.error = error.message;
                }
            } finally {
                activeDownloads--;
                renderTasks();
                updateTaskCount();
                processQueue();
            }
        }

        // è§£æM3U8æ–‡ä»¶
        async function parseM3U8(url, signal) {
            const response = await fetch(url, { signal });
            if (!response.ok) {
                throw new Error(`æ— æ³•è·å–M3U8æ–‡ä»¶: ${response.status}`);
            }

            const text = await response.text();
            const baseUrl = url.substring(0, url.lastIndexOf('/') + 1);
            const lines = text.split('\n');
            const segments = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();

                // æ£€æŸ¥æ˜¯å¦æ˜¯åµŒå¥—çš„m3u8ï¼ˆä¸»æ’­æ”¾åˆ—è¡¨ï¼‰
                if (line.endsWith('.m3u8')) {
                    const nestedUrl = line.startsWith('http') ? line : baseUrl + line;
                    return await parseM3U8(nestedUrl, signal);
                }

                // æ£€æŸ¥TSç‰‡æ®µ
                if (line && !line.startsWith('#')) {
                    const segmentUrl = line.startsWith('http') ? line : baseUrl + line;
                    segments.push(segmentUrl);
                }
            }

            if (segments.length === 0) {
                throw new Error('M3U8æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è§†é¢‘ç‰‡æ®µ');
            }

            return segments;
        }

        // ä¸‹è½½æ‰€æœ‰ç‰‡æ®µ
        async function downloadSegments(task) {
            const concurrency = 5; // æ¯ä¸ªä»»åŠ¡çš„å¹¶å‘ç‰‡æ®µæ•°
            let currentIndex = task.downloaded;

            const downloadNext = async () => {
                while (currentIndex < task.segments.length && task.status === TaskStatus.DOWNLOADING) {
                    const index = currentIndex++;
                    try {
                        const response = await fetch(task.segments[index], {
                            signal: task.controller.signal
                        });
                        if (!response.ok) {
                            throw new Error(`ç‰‡æ®µ ${index} ä¸‹è½½å¤±è´¥`);
                        }
                        const buffer = await response.arrayBuffer();
                        task.downloadedSegments[index] = buffer;
                        task.downloaded++;
                        task.progress = (task.downloaded / task.total) * 100;
                        updateTaskProgress(task);
                    } catch (error) {
                        if (error.name !== 'AbortError') {
                            console.error(`ç‰‡æ®µ ${index} ä¸‹è½½å¤±è´¥:`, error);
                            // ç»§ç»­ä¸‹è½½å…¶ä»–ç‰‡æ®µ
                        }
                        throw error;
                    }
                }
            };

            const workers = [];
            for (let i = 0; i < concurrency; i++) {
                workers.push(downloadNext());
            }

            await Promise.all(workers);
        }

        // æ›´æ–°ä»»åŠ¡è¿›åº¦ï¼ˆä¸é‡æ–°æ¸²æŸ“æ•´ä¸ªåˆ—è¡¨ï¼‰
        function updateTaskProgress(task) {
            const taskEl = document.getElementById(`task-${task.id}`);
            if (!taskEl) return;

            const progressFill = taskEl.querySelector('.progress-fill');
            const progressText = taskEl.querySelectorAll('.progress-text span');

            if (progressFill) {
                progressFill.style.width = `${task.progress}%`;
            }
            if (progressText[0]) {
                progressText[0].textContent = `${task.progress.toFixed(1)}%`;
            }
            if (progressText[1]) {
                progressText[1].textContent = `${task.downloaded}/${task.total} ç‰‡æ®µ`;
            }
        }

        // æš‚åœä»»åŠ¡
        function pauseTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.status !== TaskStatus.DOWNLOADING) return;

            task.status = TaskStatus.PAUSED;
            if (task.controller) {
                task.controller.abort();
            }
            activeDownloads--;
            renderTasks();
            updateTaskCount();
            processQueue();
        }

        // ç»§ç»­ä»»åŠ¡
        async function resumeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.status !== TaskStatus.PAUSED) return;

            if (activeDownloads >= MAX_CONCURRENT_DOWNLOADS) {
                alert(`æœ€å¤šåŒæ—¶ä¸‹è½½ ${MAX_CONCURRENT_DOWNLOADS} ä¸ªä»»åŠ¡ï¼Œè¯·ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆ`);
                return;
            }

            task.status = TaskStatus.DOWNLOADING;
            task.controller = new AbortController();
            activeDownloads++;
            renderTasks();
            updateTaskCount();

            try {
                await downloadSegments(task);

                if (task.status === TaskStatus.DOWNLOADING) {
                    task.status = TaskStatus.COMPLETED;
                    task.progress = 100;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    // ç”¨æˆ·å–æ¶ˆ
                } else {
                    task.status = TaskStatus.ERROR;
                    task.error = error.message;
                }
            } finally {
                activeDownloads--;
                renderTasks();
                updateTaskCount();
                processQueue();
            }
        }

        // åœæ­¢ä»»åŠ¡
        function stopTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (task.controller) {
                task.controller.abort();
            }
            task.status = TaskStatus.PENDING;
            task.progress = 0;
            task.downloaded = 0;
            task.total = 0;
            task.segments = [];
            task.downloadedSegments = [];
            activeDownloads--;
            renderTasks();
            updateTaskCount();
            processQueue();
        }

        // é‡æ–°å¼€å§‹ä»»åŠ¡
        function restartTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            task.status = TaskStatus.PENDING;
            task.progress = 0;
            task.downloaded = 0;
            task.total = 0;
            task.segments = [];
            task.downloadedSegments = [];
            task.error = null;
            renderTasks();
            startTask(taskId);
        }

        // åˆ é™¤ä»»åŠ¡
        function removeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (task.controller) {
                task.controller.abort();
            }
            if (task.status === TaskStatus.DOWNLOADING) {
                activeDownloads--;
            }
            cleanupPreview(taskId); // æ¸…ç†é¢„è§ˆæ’­æ”¾å™¨
            tasks = tasks.filter(t => t.id !== taskId);
            renderTasks();
            updateTaskCount();
            processQueue();
        }

        // ä¸‹è½½åˆå¹¶åçš„æ–‡ä»¶
        function downloadFile(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.status !== TaskStatus.COMPLETED) return;

            // åˆå¹¶æ‰€æœ‰ç‰‡æ®µ
            const validSegments = task.downloadedSegments.filter(s => s !== null);
            const blob = new Blob(validSegments, { type: 'video/mp2t' });

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${task.name}.ts`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ‰¹é‡ä¸‹è½½æ‰€æœ‰å·²å®Œæˆçš„æ–‡ä»¶
        async function downloadAllCompleted() {
            const completedTasks = tasks.filter(t => t.status === TaskStatus.COMPLETED);

            if (completedTasks.length === 0) {
                alert('æ²¡æœ‰å·²å®Œæˆçš„ä¸‹è½½ä»»åŠ¡');
                return;
            }

            const confirmed = confirm(`ç¡®å®šè¦ä¿å­˜ ${completedTasks.length} ä¸ªå·²å®Œæˆçš„è§†é¢‘æ–‡ä»¶å—ï¼Ÿ`);
            if (!confirmed) return;

            // é€ä¸ªä¸‹è½½ï¼Œé—´éš”500msé¿å…æµè§ˆå™¨æ‹¦æˆª
            for (let i = 0; i < completedTasks.length; i++) {
                const task = completedTasks[i];

                // åˆå¹¶æ‰€æœ‰ç‰‡æ®µ
                const validSegments = task.downloadedSegments.filter(s => s !== null);
                if (validSegments.length === 0) continue;

                const blob = new Blob(validSegments, { type: 'video/mp2t' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${task.name}.ts`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                // å»¶è¿Ÿé‡Šæ”¾URLï¼Œç¡®ä¿ä¸‹è½½å¼€å§‹
                setTimeout(() => URL.revokeObjectURL(url), 1000);

                // é—´éš”ä¸‹è½½ï¼Œé¿å…è¢«æµè§ˆå™¨æ‹¦æˆª
                if (i < completedTasks.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }

            alert(`å·²å¼€å§‹ä¿å­˜ ${completedTasks.length} ä¸ªæ–‡ä»¶ï¼Œè¯·æ£€æŸ¥ä¸‹è½½æ–‡ä»¶å¤¹`);
        }

        // å¤„ç†ç­‰å¾…é˜Ÿåˆ—
        function processQueue() {
            if (activeDownloads >= MAX_CONCURRENT_DOWNLOADS) return;

            const pendingTask = tasks.find(t => t.status === TaskStatus.PENDING);
            if (pendingTask) {
                // ä¸è‡ªåŠ¨å¼€å§‹ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨æ§åˆ¶
            }
        }

        // å…¨éƒ¨å¼€å§‹
        function startAll() {
            const pendingTasks = tasks.filter(t => t.status === TaskStatus.PENDING || t.status === TaskStatus.PAUSED);
            pendingTasks.slice(0, MAX_CONCURRENT_DOWNLOADS - activeDownloads).forEach(task => {
                if (task.status === TaskStatus.PAUSED) {
                    resumeTask(task.id);
                } else {
                    startTask(task.id);
                }
            });
        }

        // å…¨éƒ¨æš‚åœ
        function pauseAll() {
            const downloadingTasks = tasks.filter(t => t.status === TaskStatus.DOWNLOADING);
            downloadingTasks.forEach(task => pauseTask(task.id));
        }

        // æ¸…é™¤å·²å®Œæˆ
        function clearCompleted() {
            // æ¸…ç†å·²å®Œæˆä»»åŠ¡çš„é¢„è§ˆæ’­æ”¾å™¨
            tasks.filter(t => t.status === TaskStatus.COMPLETED).forEach(t => {
                cleanupPreview(t.id);
            });
            tasks = tasks.filter(t => t.status !== TaskStatus.COMPLETED);
            renderTasks();
            updateTaskCount();
        }

        // æ¸…ç©ºå…¨éƒ¨
        function clearAll() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡å—ï¼Ÿ')) return;

            tasks.forEach(task => {
                if (task.controller) {
                    task.controller.abort();
                }
            });
            cleanupAllPreviews(); // æ¸…ç†æ‰€æœ‰é¢„è§ˆæ’­æ”¾å™¨
            tasks = [];
            activeDownloads = 0;
            renderTasks();
            updateTaskCount();
        }

        // æ¸…ç©ºè¾“å…¥
        function clearInput() {
            document.getElementById('singleUrl').value = '';
            document.getElementById('fileName').value = '';
            document.getElementById('batchUrls').value = '';
        }

        // ä»æ–‡ä»¶å¯¼å…¥
        function loadFromFile() {
            document.getElementById('fileInput').click();
        }

        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('batchUrls').value = e.target.result;
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // é”®ç›˜å¿«æ·é”®
        document.getElementById('singleUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addSingleTask();
            }
        });

        // é¢„è§ˆç›¸å…³
        const previewPlayers = {}; // å­˜å‚¨HLSå®ä¾‹

        // è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœªåŠ è½½çš„é¢„è§ˆ
        function autoStartPreviews() {
            tasks.forEach(task => {
                const previewEl = document.getElementById(`preview-${task.id}`);
                if (!previewEl) return;

                // æ£€æŸ¥DOMä¸­æ˜¯å¦æœ‰è§†é¢‘å…ƒç´ 
                const hasVideo = previewEl.querySelector('video');

                // å¦‚æœpreviewPlayersä¸­æœ‰å®ä¾‹ä½†DOMä¸­æ²¡æœ‰è§†é¢‘ï¼Œè¯´æ˜DOMè¢«é‡å»ºäº†ï¼Œéœ€è¦æ¸…ç†æ—§å®ä¾‹
                if (previewPlayers[task.id] && !hasVideo) {
                    cleanupPreview(task.id);
                }

                // å¦‚æœæ²¡æœ‰é¢„è§ˆæ’­æ”¾å™¨ï¼Œåˆ™å¯åŠ¨é¢„è§ˆ
                if (!previewPlayers[task.id]) {
                    startPreview(task.id);
                }
            });
        }

        // å¯åŠ¨é¢„è§ˆï¼ˆè‡ªåŠ¨è°ƒç”¨ï¼‰
        function startPreview(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const previewEl = document.getElementById(`preview-${taskId}`);
            if (!previewEl) return;

            // å¦‚æœå·²ç»æœ‰è§†é¢‘å…ƒç´ ï¼Œè·³è¿‡
            if (previewEl.querySelector('video')) return;

            // åˆ›å»ºè§†é¢‘å…ƒç´ 
            previewEl.innerHTML = `
                <video muted playsinline loop></video>
            `;

            const video = previewEl.querySelector('video');

            // ä½¿ç”¨HLS.jsåŠ è½½è§†é¢‘
            if (Hls.isSupported()) {
                const hls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    maxBufferLength: 10,
                    maxMaxBufferLength: 20
                });

                hls.loadSource(task.url);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    previewEl.classList.add('playing');
                    video.play().catch(() => {
                        // è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢
                        previewEl.classList.remove('playing');
                    });
                });

                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        previewEl.innerHTML = `
                            <div class="preview-placeholder">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="15" y1="9" x2="9" y2="15"></line>
                                    <line x1="9" y1="9" x2="15" y2="15"></line>
                                </svg>
                                <span>é¢„è§ˆå¤±è´¥</span>
                            </div>
                        `;
                        hls.destroy();
                        delete previewPlayers[taskId];
                    }
                });

                previewPlayers[taskId] = hls;
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // SafariåŸç”Ÿæ”¯æŒ
                video.src = task.url;
                video.addEventListener('loadedmetadata', () => {
                    previewEl.classList.add('playing');
                    video.play();
                });
                video.addEventListener('error', () => {
                    previewEl.innerHTML = `
                        <div class="preview-placeholder">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            <span>é¢„è§ˆå¤±è´¥</span>
                        </div>
                    `;
                });
                previewPlayers[taskId] = { destroy: () => {} }; // å ä½
            } else {
                previewEl.innerHTML = `
                    <div class="preview-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        <span>ä¸æ”¯æŒé¢„è§ˆ</span>
                    </div>
                `;
            }
        }

        // åˆ‡æ¢é¢„è§ˆï¼ˆç‚¹å‡»æ—¶è°ƒç”¨ï¼‰
        function togglePreview(taskId) {
            const previewEl = document.getElementById(`preview-${taskId}`);
            if (!previewEl) return;

            const video = previewEl.querySelector('video');
            if (video) {
                if (video.paused) {
                    video.play();
                    previewEl.classList.add('playing');
                } else {
                    video.pause();
                    previewEl.classList.remove('playing');
                }
            }
        }

        // æ¸…ç†é¢„è§ˆæ’­æ”¾å™¨
        function cleanupPreview(taskId) {
            if (previewPlayers[taskId]) {
                previewPlayers[taskId].destroy();
                delete previewPlayers[taskId];
            }
        }

        // æ¸…ç†æ‰€æœ‰é¢„è§ˆ
        function cleanupAllPreviews() {
            Object.keys(previewPlayers).forEach(id => {
                previewPlayers[id].destroy();
                delete previewPlayers[id];
            });
        }

        // åˆå§‹åŒ–
        renderTasks();
        updateTaskCount();
    </script>

    <!-- FAQ é—®ç­”åŒºå— -->
    <section class="faq-section" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">
        <h2 style="color: #00d9ff; font-size: 20px; margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid rgba(0,217,255,0.3);">â“ å¸¸è§é—®é¢˜</h2>
        <div style="display: flex; flex-direction: column; gap: 16px;">
            <details style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 600; color: #e4e4e4; display: flex; align-items: center; gap: 12px; user-select: none;">
                    <span style="color: #00d9ff;">Q:</span> ä»€ä¹ˆæ˜¯ M3U8 æ ¼å¼ï¼Ÿ
                </summary>
                <div style="padding: 0 20px 16px 20px; color: rgba(255,255,255,0.7); line-height: 1.7;">
                    <p>M3U8 æ˜¯ HLS (HTTP Live Streaming) æµåª’ä½“åè®®çš„ç´¢å¼•æ–‡ä»¶æ ¼å¼ï¼Œå®ƒåŒ…å«è§†é¢‘åˆ†ç‰‡ï¼ˆTSæ–‡ä»¶ï¼‰çš„åˆ—è¡¨ã€‚HLS æ˜¯è‹¹æœå…¬å¸å¼€å‘çš„è‡ªé€‚åº”æµåª’ä½“ä¼ è¾“åè®®ï¼Œè¢«å¹¿æ³›ç”¨äºåœ¨çº¿è§†é¢‘æ’­æ”¾ï¼Œæ”¯æŒæ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨åˆ‡æ¢æ¸…æ™°åº¦ã€‚</p>
                </div>
            </details>
            <details style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 600; color: #e4e4e4; display: flex; align-items: center; gap: 12px; user-select: none;">
                    <span style="color: #00d9ff;">Q:</span> ä¸ºä»€ä¹ˆæœ‰äº› M3U8 æ— æ³•ä¸‹è½½ï¼Ÿ
                </summary>
                <div style="padding: 0 20px 16px 20px; color: rgba(255,255,255,0.7); line-height: 1.7;">
                    <p>å¯èƒ½æ˜¯å› ä¸ºè§†é¢‘ä½¿ç”¨äº† DRM åŠ å¯†ä¿æŠ¤ï¼Œæˆ–è€…éœ€è¦ç‰¹å®šçš„è®¤è¯ä¿¡æ¯ï¼ˆå¦‚ Cookieã€Tokenï¼‰æ‰èƒ½è®¿é—®ã€‚æœ¬å·¥å…·ä»…æ”¯æŒä¸‹è½½å…¬å¼€çš„ã€æœªåŠ å¯†çš„ M3U8 è§†é¢‘æµã€‚å¦å¤–ï¼Œéƒ¨åˆ†ç½‘ç«™è®¾ç½®äº†è·¨åŸŸé™åˆ¶ï¼ˆCORSï¼‰ï¼Œä¹Ÿä¼šå¯¼è‡´æ— æ³•åœ¨æµè§ˆå™¨ä¸­ç›´æ¥ä¸‹è½½ã€‚</p>
                </div>
            </details>
            <details style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 600; color: #e4e4e4; display: flex; align-items: center; gap: 12px; user-select: none;">
                    <span style="color: #00d9ff;">Q:</span> ä¸‹è½½çš„è§†é¢‘æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Ÿ
                </summary>
                <div style="padding: 0 20px 16px 20px; color: rgba(255,255,255,0.7); line-height: 1.7;">
                    <p>ä¸‹è½½åçš„è§†é¢‘ä¸º TSï¼ˆTransport Streamï¼‰æ ¼å¼ï¼Œè¿™æ˜¯ç”± M3U8 åˆ†ç‰‡åˆå¹¶è€Œæˆçš„è§†é¢‘æ–‡ä»¶ã€‚TS æ ¼å¼å¯ä»¥ç›´æ¥ä½¿ç”¨ VLCã€PotPlayer ç­‰æ’­æ”¾å™¨æ’­æ”¾ã€‚å¦‚éœ€è½¬æ¢ä¸º MP4 æ ¼å¼ï¼Œå¯ä½¿ç”¨ FFmpeg å‘½ä»¤ï¼š<code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-family: monospace;">ffmpeg -i video.ts -c copy video.mp4</code></p>
                </div>
            </details>
            <details style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 600; color: #e4e4e4; display: flex; align-items: center; gap: 12px; user-select: none;">
                    <span style="color: #00d9ff;">Q:</span> ä¸‹è½½é€Ÿåº¦å–å†³äºä»€ä¹ˆï¼Ÿ
                </summary>
                <div style="padding: 0 20px 16px 20px; color: rgba(255,255,255,0.7); line-height: 1.7;">
                    <p>ä¸‹è½½é€Ÿåº¦ä¸»è¦å–å†³äºä¸¤ä¸ªå› ç´ ï¼šåŸå§‹è§†é¢‘æœåŠ¡å™¨çš„å¸¦å®½å’Œå“åº”é€Ÿåº¦ï¼Œä»¥åŠä½ æœ¬åœ°çš„ç½‘ç»œè¿æ¥é€Ÿåº¦ã€‚æœ¬å·¥å…·æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½ï¼ˆé»˜è®¤5ä¸ªå¹¶å‘ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜ä¸‹è½½æ•ˆç‡ã€‚å¦‚æœåŸå§‹æœåŠ¡å™¨æœ‰é€Ÿåº¦é™åˆ¶ï¼Œåˆ™ä¸‹è½½é€Ÿåº¦ä¼šå—åˆ°é™åˆ¶ã€‚</p>
                </div>
            </details>
            <details style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 600; color: #e4e4e4; display: flex; align-items: center; gap: 12px; user-select: none;">
                    <span style="color: #00d9ff;">Q:</span> è§†é¢‘æ•°æ®ä¼šç»è¿‡æœåŠ¡å™¨å—ï¼Ÿ
                </summary>
                <div style="padding: 0 20px 16px 20px; color: rgba(255,255,255,0.7); line-height: 1.7;">
                    <p>ä¸ä¼šã€‚æœ¬å·¥å…·å®Œå…¨åœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼Œè§†é¢‘æ•°æ®ç›´æ¥ä»åŸå§‹æœåŠ¡å™¨ä¸‹è½½åˆ°ä½ çš„æµè§ˆå™¨ï¼Œä¸ä¼šç»è¿‡ä»»ä½•ä¸­é—´æœåŠ¡å™¨ã€‚æ‰€æœ‰å¤„ç†ï¼ˆè§£æã€ä¸‹è½½ã€åˆå¹¶ï¼‰éƒ½åœ¨æœ¬åœ°å®Œæˆï¼Œä¿è¯äº†æ•°æ®å®‰å…¨å’Œéšç§ã€‚</p>
                </div>
            </details>
        </div>
    </section>

    <!-- ç›¸å…³å·¥å…·æ¨è -->
    <section class="related-tools" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">
        <h3 style="color: #e4e4e4; font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">ğŸ”— ç›¸å…³å·¥å…·æ¨è</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            <a href="social-video-downloader.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“±</div>
                <div style="color: #e4e4e4; font-weight: 500;">X/TikTok è§†é¢‘ä¸‹è½½</div>
                <div style="color: #888; font-size: 12px; margin-top: 4px;">ä¸‹è½½ç¤¾äº¤åª’ä½“è§†é¢‘</div>
            </a>
            <a href="audio-cutter.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸµ</div>
                <div style="color: #e4e4e4; font-weight: 500;">éŸ³é¢‘å‰ªè¾‘</div>
                <div style="color: #888; font-size: 12px; margin-top: 4px;">åœ¨çº¿å‰ªåˆ‡éŸ³é¢‘æ–‡ä»¶</div>
            </a>
            <a href="image-converter.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ–¼ï¸</div>
                <div style="color: #e4e4e4; font-weight: 500;">å›¾ç‰‡æ ¼å¼è½¬æ¢</div>
                <div style="color: #888; font-size: 12px; margin-top: 4px;">WebP/PNG/JPG äº’è½¬</div>
            </a>
            <a href="image-compressor.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“¦</div>
                <div style="color: #e4e4e4; font-weight: 500;">å›¾ç‰‡å‹ç¼©</div>
                <div style="color: #888; font-size: 12px; margin-top: 4px;">æ‰¹é‡å‹ç¼©å›¾ç‰‡ä½“ç§¯</div>
            </a>
        </div>
    </section>

    <footer style="text-align: center; padding: 30px 20px; border-top: 1px solid rgba(255,255,255,0.1); color: #888; font-size: 14px;">
        <p>çº¯å‰ç«¯å¤„ç†ï¼Œè§†é¢‘ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
        <p style="margin-top: 12px;">
            <a href="index.html" style="color: #00d9ff; text-decoration: none;">â† è¿”å› Web Toolbox é¦–é¡µ</a>
            <span style="margin: 0 12px;">|</span>
            <a href="https://github.com/heyuan110" target="_blank" rel="noopener" style="color: #00d9ff; text-decoration: none;">GitHub</a>
        </p>
    </footer>
</body>
</html>
