<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U8 Video Downloader - Batch Download HLS Streaming Videos Online | Web Toolbox</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Free online M3U8 video downloader. Batch download M3U8/HLS streaming videos and save as TS files. Real-time preview, progress display, pause/resume. Pure frontend, no installation required.">
    <meta name="keywords" content="M3U8 downloader,M3U8 to MP4,HLS download,streaming download,video downloader,online video download,batch download,free tool">
    <meta name="author" content="heyuan110">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.heyuan110.com/web-toolbox/m3u8-downloader.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.heyuan110.com/web-toolbox/m3u8-downloader.html">
    <meta property="og:title" content="M3U8 Video Downloader - Batch Download Streaming Videos Online">
    <meta property="og:description" content="Free online M3U8 video downloader. Batch download and save as TS files. Real-time preview, progress display. Pure frontend, no installation.">
    <meta property="og:image" content="https://www.heyuan110.com/web-toolbox/screenshots/m3u8-downloader.png">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Web Toolbox">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="M3U8 Video Downloader - Batch Download Streaming Videos Online">
    <meta name="twitter:description" content="Free online M3U8 video downloader. Batch download and save as TS files.">
    <meta name="twitter:image" content="https://www.heyuan110.com/web-toolbox/screenshots/m3u8-downloader.png">

    <!-- JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "M3U8 Video Downloader",
        "url": "https://www.heyuan110.com/web-toolbox/m3u8-downloader.html",
        "description": "Batch download M3U8/HLS streaming videos online and save as TS files",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
        "author": {"@type": "Person", "name": "heyuan110"}
    }
    </script>

    <!-- FAQ JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "What is M3U8 format?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "M3U8 is the index file format for HLS (HTTP Live Streaming) protocol. It contains a list of video segments (TS files). HLS is an adaptive streaming protocol developed by Apple, widely used for online video playback."
                }
            },
            {
                "@type": "Question",
                "name": "Why can't some M3U8 videos be downloaded?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "This may be because the video uses DRM encryption protection, or requires specific authentication information (such as Cookie, Token) to access. This tool only supports downloading public, unencrypted M3U8 video streams."
                }
            },
            {
                "@type": "Question",
                "name": "What format are the downloaded videos?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Downloaded videos are in TS (Transport Stream) format, merged from M3U8 segments. TS format can be played directly with VLC, PotPlayer, etc. You can also convert to MP4 using FFmpeg."
                }
            },
            {
                "@type": "Question",
                "name": "What determines the download speed?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Download speed mainly depends on two factors: the bandwidth and response speed of the original video server, and your local network connection speed. This tool supports multi-threaded concurrent downloading to improve efficiency."
                }
            },
            {
                "@type": "Question",
                "name": "Does the video data pass through a server?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "No. This tool runs entirely in the browser. Video data is downloaded directly from the original server to your browser without passing through any intermediate server, ensuring data security and privacy."
                }
            }
        ]
    }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e4e4e4;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            position: relative;
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            text-align: center;
            color: #00d9ff;
            font-size: 2.5rem;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        /* è¯­è¨€åˆ‡æ¢å™¨æ ·å¼ */
        .lang-switcher { position: absolute; top: 0; right: 0; }
        .lang-dropdown { position: relative; display: inline-block; }
        .lang-current { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; color: #e0e0e0; transition: all 0.3s ease; }
        .lang-current:hover { background: rgba(255,255,255,0.15); }
        .lang-menu { position: absolute; top: 100%; right: 0; margin-top: 4px; background: #1e1e2e; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 4px; min-width: 140px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s ease; z-index: 1000; }
        .lang-dropdown.active .lang-menu { opacity: 1; visibility: visible; transform: translateY(0); }
        .lang-btn { display: block; width: 100%; padding: 10px 16px; background: none; border: none; color: #e0e0e0; font-size: 14px; text-align: left; cursor: pointer; border-radius: 6px; transition: background 0.2s ease; }
        .lang-btn:hover { background: rgba(255,255,255,0.1); }

        .input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-section h2 {
            margin-bottom: 16px;
            color: #00d9ff;
            font-size: 1.2rem;
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .input-group input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 14px 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 14px;
            resize: vertical;
            font-family: 'Monaco', 'Consolas', monospace;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
        }

        textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 217, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #cc0022 100%);
            color: #fff;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ed573 0%, #1e9c50 100%);
            color: #fff;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa502 0%, #cc8400 100%);
            color: #000;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .task-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-section h2 {
            margin-bottom: 16px;
            color: #00d9ff;
            font-size: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-count {
            background: rgba(0, 217, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .task-list::-webkit-scrollbar {
            width: 6px;
        }

        .task-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: rgba(0, 217, 255, 0.3);
            border-radius: 3px;
        }

        .task-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            display: flex;
            gap: 16px;
        }

        .task-item:hover {
            border-color: rgba(0, 217, 255, 0.3);
        }

        .task-preview {
            flex-shrink: 0;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .task-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .task-preview .preview-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
            text-align: center;
            padding: 8px;
        }

        .task-preview .preview-placeholder svg {
            width: 32px;
            height: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }

        .task-preview .loading-placeholder .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-top-color: #00d9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 8px;
        }

        .task-preview .play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: rgba(0, 217, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .task-preview:hover .play-btn {
            opacity: 1;
        }

        .task-preview .play-btn svg {
            width: 16px;
            height: 16px;
            fill: #000;
            margin-left: 2px;
        }

        .task-preview.loading .play-btn {
            display: none;
        }

        .task-preview.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            margin: -12px 0 0 -12px;
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-top-color: #00d9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .task-preview.playing .play-btn {
            display: none;
        }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 12px;
        }

        .task-name {
            font-weight: 600;
            color: #fff;
            word-break: break-all;
            flex: 1;
        }

        .task-url {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            word-break: break-all;
            margin-top: 4px;
        }

        .task-status {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-pending {
            background: rgba(255, 255, 255, 0.1);
            color: #999;
        }

        .status-downloading {
            background: rgba(0, 217, 255, 0.2);
            color: #00d9ff;
        }

        .status-paused {
            background: rgba(255, 165, 2, 0.2);
            color: #ffa502;
        }

        .status-completed {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .status-error {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }

        .progress-container {
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d9ff 0%, #00ff88 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .task-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .task-actions .btn {
            padding: 8px 14px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.4);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .tips {
            background: rgba(255, 165, 2, 0.1);
            border: 1px solid rgba(255, 165, 2, 0.3);
            border-radius: 10px;
            padding: 16px;
            margin-top: 24px;
            font-size: 13px;
            line-height: 1.6;
        }

        .tips h3 {
            color: #ffa502;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .tips ul {
            margin-left: 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .tips li {
            margin-bottom: 4px;
        }

        .global-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .downloading .task-status {
            animation: pulse 1.5s infinite;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .input-group {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .task-item {
                flex-direction: column;
            }

            .task-preview {
                width: 100%;
                height: 180px;
            }

            .task-header {
                flex-direction: column;
            }

            .global-actions {
                flex-direction: column;
            }

            .lang-switcher {
                position: static;
                text-align: right;
                margin-bottom: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link" style="display: inline-block; margin-bottom: 16px; color: #888; text-decoration: none; font-size: 14px; transition: color 0.2s;" data-i18n="backToToolbox">â† Back to Toolbox</a>

        <div class="header">
            <div class="lang-switcher">
                <div class="lang-dropdown" id="langDropdown">
                    <div class="lang-current" id="langCurrent">ğŸŒ English</div>
                    <div class="lang-menu">
                        <button class="lang-btn" data-lang="en">ğŸ‡ºğŸ‡¸ English</button>
                        <button class="lang-btn" data-lang="zh-CN">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
                        <button class="lang-btn" data-lang="fr">ğŸ‡«ğŸ‡· FranÃ§ais</button>
                        <button class="lang-btn" data-lang="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                    </div>
                </div>
            </div>
            <h1 data-i18n="pageTitle">ğŸ¬ M3U8 Batch Downloader</h1>
        </div>

        <!-- åŠŸèƒ½ç‰¹ç‚¹åŒºå— -->
        <section class="features-section" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">â–¶ï¸</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;" data-i18n="featurePlayTitle">Online Playback</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;" data-i18n="featurePlayDesc">Play M3U8/HLS video streams directly in browser, no extra player needed</p>
            </div>
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">ğŸ’¾</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;" data-i18n="featureDownloadTitle">Video Download</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;" data-i18n="featureDownloadDesc">Parse M3U8 files, auto download all segments and merge into complete video</p>
            </div>
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">ğŸšï¸</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;" data-i18n="featureQualityTitle">Multi Quality</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;" data-i18n="featureQualityDesc">Auto detect multi-quality streams, choose different quality versions to download</p>
            </div>
            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">ğŸ“Š</div>
                <h3 style="color: #00d9ff; font-size: 16px; margin-bottom: 8px;" data-i18n="featureProgressTitle">Progress Display</h3>
                <p style="color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.5;" data-i18n="featureProgressDesc">Real-time download progress, downloaded segments count and remaining time</p>
            </div>
        </section>

        <div class="input-section">
            <h2 data-i18n="addTaskTitle">ğŸ“¥ Add Download Task</h2>

            <!-- å•æ¡URLè¾“å…¥ -->
            <div class="input-group">
                <input type="text" id="singleUrl" data-i18n-placeholder="singleUrlPlaceholder" placeholder="Enter single M3U8 link...">
                <input type="text" id="fileName" data-i18n-placeholder="fileNamePlaceholder" placeholder="Filename (optional)" style="max-width: 200px;">
                <button class="btn btn-primary" onclick="addSingleTask()">
                    <span>â•</span> <span data-i18n="btnAdd">Add</span>
                </button>
            </div>

            <!-- æ‰¹é‡URLè¾“å…¥ -->
            <textarea id="batchUrls" data-i18n-placeholder="batchUrlsPlaceholder" placeholder="Batch import M3U8 links (one per line)&#10;Supported formats:&#10;https://example.com/video.m3u8&#10;Custom Name|https://example.com/video.m3u8"></textarea>

            <div class="button-group">
                <button class="btn btn-primary" onclick="addBatchTasks()">
                    <span>ğŸ“‹</span> <span data-i18n="btnBatchAdd">Batch Add</span>
                </button>
                <button class="btn btn-secondary" onclick="clearInput()">
                    <span>ğŸ—‘ï¸</span> <span data-i18n="btnClearInput">Clear Input</span>
                </button>
                <button class="btn btn-secondary" onclick="loadFromFile()">
                    <span>ğŸ“‚</span> <span data-i18n="btnImportFile">Import from File</span>
                </button>
                <input type="file" id="fileInput" accept=".txt" style="display: none;" onchange="handleFileImport(event)">
            </div>
        </div>

        <div class="task-section">
            <h2>
                <span data-i18n="taskListTitle">ğŸ“‹ Download Task List</span>
                <span class="task-count" id="taskCount" data-i18n="taskCount">0 tasks</span>
            </h2>

            <div class="global-actions" style="margin-bottom: 16px;">
                <button class="btn btn-success" onclick="startAll()">
                    <span>â–¶ï¸</span> <span data-i18n="btnStartAll">Start All</span>
                </button>
                <button class="btn btn-warning" onclick="pauseAll()">
                    <span>â¸ï¸</span> <span data-i18n="btnPauseAll">Pause All</span>
                </button>
                <button class="btn btn-danger" onclick="clearCompleted()">
                    <span>ğŸ—‘ï¸</span> <span data-i18n="btnClearCompleted">Clear Completed</span>
                </button>
                <button class="btn btn-danger" onclick="clearAll()">
                    <span>âŒ</span> <span data-i18n="btnClearAll">Clear All</span>
                </button>
                <button class="btn btn-primary" onclick="downloadAllCompleted()">
                    <span>ğŸ’¾</span> <span data-i18n="btnSaveAllCompleted">Save All Completed</span>
                </button>
            </div>

            <div class="task-list" id="taskList">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <p data-i18n="emptyStateTitle">No download tasks</p>
                    <p style="font-size: 12px; margin-top: 8px;" data-i18n="emptyStateDesc">Add M3U8 links to start downloading</p>
                </div>
            </div>
        </div>

        <div class="tips">
            <h3 data-i18n="tipsTitle">ğŸ’¡ Usage Tips</h3>
            <ul>
                <li data-i18n="tip1">Support single or batch adding M3U8 links</li>
                <li data-i18n="tip2">Batch import format: one link per line, or use "name|link" format for custom filenames</li>
                <li data-i18n="tip3">Due to browser security restrictions, some cross-origin resources may not be downloadable</li>
                <li data-i18n="tip4">Downloaded files are in TS format, convert to MP4 with FFmpeg: <code>ffmpeg -i video.ts -c copy video.mp4</code></li>
                <li data-i18n="tip5">Chrome browser recommended for best experience</li>
            </ul>
        </div>
    </div>

    <script>
        // ==================== å›½é™…åŒ–ç³»ç»Ÿ ====================
        const i18n = {
            'en': {
                pageTitle: 'ğŸ¬ M3U8 Batch Downloader',
                backToToolbox: 'â† Back to Toolbox',
                featurePlayTitle: 'Online Playback',
                featurePlayDesc: 'Play M3U8/HLS video streams directly in browser, no extra player needed',
                featureDownloadTitle: 'Video Download',
                featureDownloadDesc: 'Parse M3U8 files, auto download all segments and merge into complete video',
                featureQualityTitle: 'Multi Quality',
                featureQualityDesc: 'Auto detect multi-quality streams, choose different quality versions to download',
                featureProgressTitle: 'Progress Display',
                featureProgressDesc: 'Real-time download progress, downloaded segments count and remaining time',
                addTaskTitle: 'ğŸ“¥ Add Download Task',
                singleUrlPlaceholder: 'Enter single M3U8 link...',
                fileNamePlaceholder: 'Filename (optional)',
                btnAdd: 'Add',
                batchUrlsPlaceholder: 'Batch import M3U8 links (one per line)\nSupported formats:\nhttps://example.com/video.m3u8\nCustom Name|https://example.com/video.m3u8',
                btnBatchAdd: 'Batch Add',
                btnClearInput: 'Clear Input',
                btnImportFile: 'Import from File',
                taskListTitle: 'ğŸ“‹ Download Task List',
                taskCount: '0 tasks',
                btnStartAll: 'Start All',
                btnPauseAll: 'Pause All',
                btnClearCompleted: 'Clear Completed',
                btnClearAll: 'Clear All',
                btnSaveAllCompleted: 'Save All Completed',
                emptyStateTitle: 'No download tasks',
                emptyStateDesc: 'Add M3U8 links to start downloading',
                tipsTitle: 'ğŸ’¡ Usage Tips',
                tip1: 'Support single or batch adding M3U8 links',
                tip2: 'Batch import format: one link per line, or use "name|link" format for custom filenames',
                tip3: 'Due to browser security restrictions, some cross-origin resources may not be downloadable',
                tip4: 'Downloaded files are in TS format, convert to MP4 with FFmpeg: <code>ffmpeg -i video.ts -c copy video.mp4</code>',
                tip5: 'Chrome browser recommended for best experience',
                statusPending: 'Pending',
                statusDownloading: 'Downloading',
                statusPaused: 'Paused',
                statusCompleted: 'Completed',
                statusError: 'Error',
                btnStart: 'Start',
                btnPause: 'Pause',
                btnStop: 'Stop',
                btnResume: 'Resume',
                btnRestart: 'Restart',
                btnRetry: 'Retry',
                btnSaveFile: 'Save File',
                btnDelete: 'Delete',
                loadingPreview: 'Loading preview...',
                previewFailed: 'Preview failed',
                previewNotSupported: 'Preview not supported',
                segments: 'segments',
                alertEnterUrl: 'Please enter M3U8 link',
                alertValidUrl: 'Please enter a valid URL',
                alertAddedTasks: 'Successfully added {count} tasks',
                alertNoValidUrl: 'No valid URLs found',
                alertMaxConcurrent: 'Maximum {count} concurrent downloads, please wait for others to complete',
                alertNoCompleted: 'No completed download tasks',
                alertConfirmSave: 'Are you sure you want to save {count} completed video files?',
                alertStartedSaving: 'Started saving {count} files, please check download folder',
                alertConfirmClearAll: 'Are you sure you want to clear all tasks?',
                errorFetchM3u8: 'Cannot fetch M3U8 file',
                errorNoSegments: 'No valid video segments found in M3U8 file',
                errorSegmentFailed: 'Segment {index} download failed',
                taskCountFormat: '{total} tasks ({downloading} downloading, {completed} completed)',
                faqTitle: 'â“ FAQ',
                faq1Question: 'What is M3U8 format?',
                faq1Answer: 'M3U8 is the index file format for HLS (HTTP Live Streaming) protocol. It contains a list of video segments (TS files). HLS is an adaptive streaming protocol developed by Apple, widely used for online video playback, supporting automatic quality switching based on network conditions.',
                faq2Question: 'Why can\'t some M3U8 videos be downloaded?',
                faq2Answer: 'This may be because the video uses DRM encryption protection, or requires specific authentication information (such as Cookie, Token) to access. This tool only supports downloading public, unencrypted M3U8 video streams. Additionally, some websites have CORS restrictions that prevent direct browser downloads.',
                faq3Question: 'What format are the downloaded videos?',
                faq3Answer: 'Downloaded videos are in TS (Transport Stream) format, merged from M3U8 segments. TS format can be played directly with VLC, PotPlayer, etc. To convert to MP4 format, use the FFmpeg command: <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-family: monospace;">ffmpeg -i video.ts -c copy video.mp4</code>',
                faq4Question: 'What determines the download speed?',
                faq4Answer: 'Download speed mainly depends on two factors: the bandwidth and response speed of the original video server, and your local network connection speed. This tool supports multi-threaded concurrent downloading (5 concurrent by default) to improve efficiency. If the original server has speed limits, download speed will be limited.',
                faq5Question: 'Does the video data pass through a server?',
                faq5Answer: 'No. This tool runs entirely in the browser. Video data is downloaded directly from the original server to your browser without passing through any intermediate server. All processing (parsing, downloading, merging) is done locally, ensuring data security and privacy.',
                relatedToolsTitle: 'ğŸ”— Related Tools',
                relatedTool1Title: 'X/TikTok Video Download',
                relatedTool1Desc: 'Download social media videos',
                relatedTool2Title: 'Audio Cutter',
                relatedTool2Desc: 'Cut audio files online',
                relatedTool3Title: 'Image Format Converter',
                relatedTool3Desc: 'Convert WebP/PNG/JPG',
                relatedTool4Title: 'Image Compressor',
                relatedTool4Desc: 'Batch compress images',
                footerText: 'Pure frontend processing, videos are not uploaded to server',
                footerBackHome: 'â† Back to Web Toolbox Home'
            },
            'zh-CN': {
                pageTitle: 'ğŸ¬ M3U8æ‰¹é‡ä¸‹è½½å™¨',
                backToToolbox: 'â† è¿”å›å·¥å…·ç®±',
                featurePlayTitle: 'åœ¨çº¿æ’­æ”¾',
                featurePlayDesc: 'æ”¯æŒç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ’­æ”¾ M3U8/HLS è§†é¢‘æµï¼Œæ— éœ€é¢å¤–æ’­æ”¾å™¨',
                featureDownloadTitle: 'è§†é¢‘ä¸‹è½½',
                featureDownloadDesc: 'è§£æ M3U8 æ–‡ä»¶ï¼Œè‡ªåŠ¨ä¸‹è½½æ‰€æœ‰åˆ†ç‰‡å¹¶åˆå¹¶ä¸ºå®Œæ•´è§†é¢‘æ–‡ä»¶',
                featureQualityTitle: 'å¤šæ¸…æ™°åº¦',
                featureQualityDesc: 'è‡ªåŠ¨è¯†åˆ«å¤šæ¸…æ™°åº¦æµï¼Œæ”¯æŒé€‰æ‹©ä¸åŒè´¨é‡ç‰ˆæœ¬ä¸‹è½½',
                featureProgressTitle: 'è¿›åº¦æ˜¾ç¤º',
                featureProgressDesc: 'å®æ—¶æ˜¾ç¤ºä¸‹è½½è¿›åº¦ã€å·²ä¸‹è½½åˆ†ç‰‡æ•°å’Œå‰©ä½™æ—¶é—´',
                addTaskTitle: 'ğŸ“¥ æ·»åŠ ä¸‹è½½ä»»åŠ¡',
                singleUrlPlaceholder: 'è¾“å…¥å•ä¸ªM3U8é“¾æ¥...',
                fileNamePlaceholder: 'æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰',
                btnAdd: 'æ·»åŠ ',
                batchUrlsPlaceholder: 'æ‰¹é‡å¯¼å…¥M3U8é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰\næ”¯æŒæ ¼å¼ï¼š\nhttps://example.com/video.m3u8\nè‡ªå®šä¹‰åç§°|https://example.com/video.m3u8',
                btnBatchAdd: 'æ‰¹é‡æ·»åŠ ',
                btnClearInput: 'æ¸…ç©ºè¾“å…¥',
                btnImportFile: 'ä»æ–‡ä»¶å¯¼å…¥',
                taskListTitle: 'ğŸ“‹ ä¸‹è½½ä»»åŠ¡åˆ—è¡¨',
                taskCount: '0 ä¸ªä»»åŠ¡',
                btnStartAll: 'å…¨éƒ¨å¼€å§‹',
                btnPauseAll: 'å…¨éƒ¨æš‚åœ',
                btnClearCompleted: 'æ¸…é™¤å·²å®Œæˆ',
                btnClearAll: 'æ¸…ç©ºå…¨éƒ¨',
                btnSaveAllCompleted: 'æ‰¹é‡ä¿å­˜å·²å®Œæˆ',
                emptyStateTitle: 'æš‚æ— ä¸‹è½½ä»»åŠ¡',
                emptyStateDesc: 'æ·»åŠ M3U8é“¾æ¥å¼€å§‹ä¸‹è½½',
                tipsTitle: 'ğŸ’¡ ä½¿ç”¨è¯´æ˜',
                tip1: 'æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡æ·»åŠ M3U8é“¾æ¥',
                tip2: 'æ‰¹é‡å¯¼å…¥æ ¼å¼ï¼šæ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼Œæˆ–ä½¿ç”¨ "åç§°|é“¾æ¥" æ ¼å¼è‡ªå®šä¹‰æ–‡ä»¶å',
                tip3: 'ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼ŒæŸäº›è·¨åŸŸèµ„æºå¯èƒ½æ— æ³•ä¸‹è½½',
                tip4: 'ä¸‹è½½çš„æ–‡ä»¶ä¸ºTSæ ¼å¼ï¼Œå¯ä½¿ç”¨FFmpegè½¬æ¢ä¸ºMP4ï¼š<code>ffmpeg -i video.ts -c copy video.mp4</code>',
                tip5: 'å»ºè®®ä½¿ç”¨Chromeæµè§ˆå™¨ä»¥è·å¾—æœ€ä½³ä½“éªŒ',
                statusPending: 'ç­‰å¾…ä¸­',
                statusDownloading: 'ä¸‹è½½ä¸­',
                statusPaused: 'å·²æš‚åœ',
                statusCompleted: 'å·²å®Œæˆ',
                statusError: 'å‡ºé”™',
                btnStart: 'å¼€å§‹',
                btnPause: 'æš‚åœ',
                btnStop: 'åœæ­¢',
                btnResume: 'ç»§ç»­',
                btnRestart: 'é‡æ–°ä¸‹è½½',
                btnRetry: 'é‡è¯•',
                btnSaveFile: 'ä¿å­˜æ–‡ä»¶',
                btnDelete: 'åˆ é™¤',
                loadingPreview: 'åŠ è½½é¢„è§ˆ...',
                previewFailed: 'é¢„è§ˆå¤±è´¥',
                previewNotSupported: 'ä¸æ”¯æŒé¢„è§ˆ',
                segments: 'ç‰‡æ®µ',
                alertEnterUrl: 'è¯·è¾“å…¥M3U8é“¾æ¥',
                alertValidUrl: 'è¯·è¾“å…¥æœ‰æ•ˆçš„URL',
                alertAddedTasks: 'æˆåŠŸæ·»åŠ  {count} ä¸ªä»»åŠ¡',
                alertNoValidUrl: 'æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„URL',
                alertMaxConcurrent: 'æœ€å¤šåŒæ—¶ä¸‹è½½ {count} ä¸ªä»»åŠ¡ï¼Œè¯·ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆ',
                alertNoCompleted: 'æ²¡æœ‰å·²å®Œæˆçš„ä¸‹è½½ä»»åŠ¡',
                alertConfirmSave: 'ç¡®å®šè¦ä¿å­˜ {count} ä¸ªå·²å®Œæˆçš„è§†é¢‘æ–‡ä»¶å—ï¼Ÿ',
                alertStartedSaving: 'å·²å¼€å§‹ä¿å­˜ {count} ä¸ªæ–‡ä»¶ï¼Œè¯·æ£€æŸ¥ä¸‹è½½æ–‡ä»¶å¤¹',
                alertConfirmClearAll: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡å—ï¼Ÿ',
                errorFetchM3u8: 'æ— æ³•è·å–M3U8æ–‡ä»¶',
                errorNoSegments: 'M3U8æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è§†é¢‘ç‰‡æ®µ',
                errorSegmentFailed: 'ç‰‡æ®µ {index} ä¸‹è½½å¤±è´¥',
                taskCountFormat: '{total} ä¸ªä»»åŠ¡ ({downloading} ä¸‹è½½ä¸­, {completed} å·²å®Œæˆ)',
                faqTitle: 'â“ å¸¸è§é—®é¢˜',
                faq1Question: 'ä»€ä¹ˆæ˜¯ M3U8 æ ¼å¼ï¼Ÿ',
                faq1Answer: 'M3U8 æ˜¯ HLS (HTTP Live Streaming) æµåª’ä½“åè®®çš„ç´¢å¼•æ–‡ä»¶æ ¼å¼ï¼Œå®ƒåŒ…å«è§†é¢‘åˆ†ç‰‡ï¼ˆTSæ–‡ä»¶ï¼‰çš„åˆ—è¡¨ã€‚HLS æ˜¯è‹¹æœå…¬å¸å¼€å‘çš„è‡ªé€‚åº”æµåª’ä½“ä¼ è¾“åè®®ï¼Œè¢«å¹¿æ³›ç”¨äºåœ¨çº¿è§†é¢‘æ’­æ”¾ï¼Œæ”¯æŒæ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨åˆ‡æ¢æ¸…æ™°åº¦ã€‚',
                faq2Question: 'ä¸ºä»€ä¹ˆæœ‰äº› M3U8 æ— æ³•ä¸‹è½½ï¼Ÿ',
                faq2Answer: 'å¯èƒ½æ˜¯å› ä¸ºè§†é¢‘ä½¿ç”¨äº† DRM åŠ å¯†ä¿æŠ¤ï¼Œæˆ–è€…éœ€è¦ç‰¹å®šçš„è®¤è¯ä¿¡æ¯ï¼ˆå¦‚ Cookieã€Tokenï¼‰æ‰èƒ½è®¿é—®ã€‚æœ¬å·¥å…·ä»…æ”¯æŒä¸‹è½½å…¬å¼€çš„ã€æœªåŠ å¯†çš„ M3U8 è§†é¢‘æµã€‚å¦å¤–ï¼Œéƒ¨åˆ†ç½‘ç«™è®¾ç½®äº†è·¨åŸŸé™åˆ¶ï¼ˆCORSï¼‰ï¼Œä¹Ÿä¼šå¯¼è‡´æ— æ³•åœ¨æµè§ˆå™¨ä¸­ç›´æ¥ä¸‹è½½ã€‚',
                faq3Question: 'ä¸‹è½½çš„è§†é¢‘æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Ÿ',
                faq3Answer: 'ä¸‹è½½åçš„è§†é¢‘ä¸º TSï¼ˆTransport Streamï¼‰æ ¼å¼ï¼Œè¿™æ˜¯ç”± M3U8 åˆ†ç‰‡åˆå¹¶è€Œæˆçš„è§†é¢‘æ–‡ä»¶ã€‚TS æ ¼å¼å¯ä»¥ç›´æ¥ä½¿ç”¨ VLCã€PotPlayer ç­‰æ’­æ”¾å™¨æ’­æ”¾ã€‚å¦‚éœ€è½¬æ¢ä¸º MP4 æ ¼å¼ï¼Œå¯ä½¿ç”¨ FFmpeg å‘½ä»¤ï¼š<code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-family: monospace;">ffmpeg -i video.ts -c copy video.mp4</code>',
                faq4Question: 'ä¸‹è½½é€Ÿåº¦å–å†³äºä»€ä¹ˆï¼Ÿ',
                faq4Answer: 'ä¸‹è½½é€Ÿåº¦ä¸»è¦å–å†³äºä¸¤ä¸ªå› ç´ ï¼šåŸå§‹è§†é¢‘æœåŠ¡å™¨çš„å¸¦å®½å’Œå“åº”é€Ÿåº¦ï¼Œä»¥åŠä½ æœ¬åœ°çš„ç½‘ç»œè¿æ¥é€Ÿåº¦ã€‚æœ¬å·¥å…·æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½ï¼ˆé»˜è®¤5ä¸ªå¹¶å‘ï¼‰ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜ä¸‹è½½æ•ˆç‡ã€‚å¦‚æœåŸå§‹æœåŠ¡å™¨æœ‰é€Ÿåº¦é™åˆ¶ï¼Œåˆ™ä¸‹è½½é€Ÿåº¦ä¼šå—åˆ°é™åˆ¶ã€‚',
                faq5Question: 'è§†é¢‘æ•°æ®ä¼šç»è¿‡æœåŠ¡å™¨å—ï¼Ÿ',
                faq5Answer: 'ä¸ä¼šã€‚æœ¬å·¥å…·å®Œå…¨åœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼Œè§†é¢‘æ•°æ®ç›´æ¥ä»åŸå§‹æœåŠ¡å™¨ä¸‹è½½åˆ°ä½ çš„æµè§ˆå™¨ï¼Œä¸ä¼šç»è¿‡ä»»ä½•ä¸­é—´æœåŠ¡å™¨ã€‚æ‰€æœ‰å¤„ç†ï¼ˆè§£æã€ä¸‹è½½ã€åˆå¹¶ï¼‰éƒ½åœ¨æœ¬åœ°å®Œæˆï¼Œä¿è¯äº†æ•°æ®å®‰å…¨å’Œéšç§ã€‚',
                relatedToolsTitle: 'ğŸ”— ç›¸å…³å·¥å…·æ¨è',
                relatedTool1Title: 'X/TikTok è§†é¢‘ä¸‹è½½',
                relatedTool1Desc: 'ä¸‹è½½ç¤¾äº¤åª’ä½“è§†é¢‘',
                relatedTool2Title: 'éŸ³é¢‘å‰ªè¾‘',
                relatedTool2Desc: 'åœ¨çº¿å‰ªåˆ‡éŸ³é¢‘æ–‡ä»¶',
                relatedTool3Title: 'å›¾ç‰‡æ ¼å¼è½¬æ¢',
                relatedTool3Desc: 'WebP/PNG/JPG äº’è½¬',
                relatedTool4Title: 'å›¾ç‰‡å‹ç¼©',
                relatedTool4Desc: 'æ‰¹é‡å‹ç¼©å›¾ç‰‡ä½“ç§¯',
                footerText: 'çº¯å‰ç«¯å¤„ç†ï¼Œè§†é¢‘ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨',
                footerBackHome: 'â† è¿”å› Web Toolbox é¦–é¡µ'
            },
            'fr': {
                pageTitle: 'ğŸ¬ TÃ©lÃ©chargeur M3U8 par lots',
                backToToolbox: 'â† Retour Ã  la boÃ®te Ã  outils',
                featurePlayTitle: 'Lecture en ligne',
                featurePlayDesc: 'Lisez les flux vidÃ©o M3U8/HLS directement dans le navigateur, sans lecteur supplÃ©mentaire',
                featureDownloadTitle: 'TÃ©lÃ©chargement vidÃ©o',
                featureDownloadDesc: 'Analysez les fichiers M3U8, tÃ©lÃ©chargez automatiquement tous les segments et fusionnez-les',
                featureQualityTitle: 'Multi-qualitÃ©',
                featureQualityDesc: 'DÃ©tection automatique des flux multi-qualitÃ©, choisissez diffÃ©rentes versions',
                featureProgressTitle: 'Affichage de progression',
                featureProgressDesc: 'Progression en temps rÃ©el, nombre de segments tÃ©lÃ©chargÃ©s et temps restant',
                addTaskTitle: 'ğŸ“¥ Ajouter une tÃ¢che de tÃ©lÃ©chargement',
                singleUrlPlaceholder: 'Entrez un lien M3U8...',
                fileNamePlaceholder: 'Nom du fichier (optionnel)',
                btnAdd: 'Ajouter',
                batchUrlsPlaceholder: 'Importation par lots de liens M3U8 (un par ligne)\nFormats supportÃ©s:\nhttps://example.com/video.m3u8\nNom personnalisÃ©|https://example.com/video.m3u8',
                btnBatchAdd: 'Ajout par lots',
                btnClearInput: 'Effacer',
                btnImportFile: 'Importer un fichier',
                taskListTitle: 'ğŸ“‹ Liste des tÃ¢ches',
                taskCount: '0 tÃ¢ches',
                btnStartAll: 'Tout dÃ©marrer',
                btnPauseAll: 'Tout mettre en pause',
                btnClearCompleted: 'Effacer terminÃ©s',
                btnClearAll: 'Tout effacer',
                btnSaveAllCompleted: 'Enregistrer tous les terminÃ©s',
                emptyStateTitle: 'Aucune tÃ¢che de tÃ©lÃ©chargement',
                emptyStateDesc: 'Ajoutez des liens M3U8 pour commencer',
                tipsTitle: 'ğŸ’¡ Conseils d\'utilisation',
                tip1: 'Supporte l\'ajout simple ou par lots de liens M3U8',
                tip2: 'Format d\'import par lots: un lien par ligne, ou utilisez le format "nom|lien"',
                tip3: 'En raison des restrictions de sÃ©curitÃ© du navigateur, certaines ressources cross-origin peuvent ne pas Ãªtre tÃ©lÃ©chargeables',
                tip4: 'Les fichiers tÃ©lÃ©chargÃ©s sont au format TS, convertissez en MP4 avec FFmpeg: <code>ffmpeg -i video.ts -c copy video.mp4</code>',
                tip5: 'Chrome recommandÃ© pour une meilleure expÃ©rience',
                statusPending: 'En attente',
                statusDownloading: 'TÃ©lÃ©chargement',
                statusPaused: 'En pause',
                statusCompleted: 'TerminÃ©',
                statusError: 'Erreur',
                btnStart: 'DÃ©marrer',
                btnPause: 'Pause',
                btnStop: 'ArrÃªter',
                btnResume: 'Reprendre',
                btnRestart: 'RedÃ©marrer',
                btnRetry: 'RÃ©essayer',
                btnSaveFile: 'Enregistrer',
                btnDelete: 'Supprimer',
                loadingPreview: 'Chargement...',
                previewFailed: 'Ã‰chec aperÃ§u',
                previewNotSupported: 'AperÃ§u non supportÃ©',
                segments: 'segments',
                alertEnterUrl: 'Veuillez entrer un lien M3U8',
                alertValidUrl: 'Veuillez entrer une URL valide',
                alertAddedTasks: '{count} tÃ¢ches ajoutÃ©es avec succÃ¨s',
                alertNoValidUrl: 'Aucune URL valide trouvÃ©e',
                alertMaxConcurrent: 'Maximum {count} tÃ©lÃ©chargements simultanÃ©s, veuillez attendre',
                alertNoCompleted: 'Aucune tÃ¢che terminÃ©e',
                alertConfirmSave: 'Voulez-vous enregistrer {count} fichiers vidÃ©o terminÃ©s?',
                alertStartedSaving: 'Enregistrement de {count} fichiers commencÃ©',
                alertConfirmClearAll: 'Voulez-vous vraiment tout effacer?',
                errorFetchM3u8: 'Impossible de rÃ©cupÃ©rer le fichier M3U8',
                errorNoSegments: 'Aucun segment vidÃ©o valide trouvÃ© dans le fichier M3U8',
                errorSegmentFailed: 'Ã‰chec du tÃ©lÃ©chargement du segment {index}',
                taskCountFormat: '{total} tÃ¢ches ({downloading} en cours, {completed} terminÃ©es)',
                faqTitle: 'â“ FAQ',
                faq1Question: 'Qu\'est-ce que le format M3U8?',
                faq1Answer: 'M3U8 est le format de fichier d\'index pour le protocole HLS (HTTP Live Streaming). Il contient une liste de segments vidÃ©o (fichiers TS). HLS est un protocole de streaming adaptatif dÃ©veloppÃ© par Apple, largement utilisÃ© pour la lecture vidÃ©o en ligne.',
                faq2Question: 'Pourquoi certaines vidÃ©os M3U8 ne peuvent pas Ãªtre tÃ©lÃ©chargÃ©es?',
                faq2Answer: 'Cela peut Ãªtre dÃ» Ã  une protection DRM, ou Ã  des informations d\'authentification requises (Cookie, Token). Cet outil ne supporte que les flux M3U8 publics et non cryptÃ©s. De plus, certains sites ont des restrictions CORS.',
                faq3Question: 'Quel est le format des vidÃ©os tÃ©lÃ©chargÃ©es?',
                faq3Answer: 'Les vidÃ©os sont au format TS (Transport Stream), fusionnÃ©es Ã  partir des segments M3U8. Le format TS peut Ãªtre lu directement avec VLC, PotPlayer, etc. Pour convertir en MP4: <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-family: monospace;">ffmpeg -i video.ts -c copy video.mp4</code>',
                faq4Question: 'Qu\'est-ce qui dÃ©termine la vitesse de tÃ©lÃ©chargement?',
                faq4Answer: 'La vitesse dÃ©pend de deux facteurs: la bande passante du serveur vidÃ©o d\'origine et votre connexion rÃ©seau locale. Cet outil supporte le tÃ©lÃ©chargement multithread (5 simultanÃ©s par dÃ©faut) pour amÃ©liorer l\'efficacitÃ©.',
                faq5Question: 'Les donnÃ©es vidÃ©o passent-elles par un serveur?',
                faq5Answer: 'Non. Cet outil fonctionne entiÃ¨rement dans le navigateur. Les donnÃ©es vidÃ©o sont tÃ©lÃ©chargÃ©es directement depuis le serveur d\'origine vers votre navigateur, garantissant la sÃ©curitÃ© et la confidentialitÃ©.',
                relatedToolsTitle: 'ğŸ”— Outils connexes',
                relatedTool1Title: 'TÃ©lÃ©chargement X/TikTok',
                relatedTool1Desc: 'TÃ©lÃ©charger des vidÃ©os sociales',
                relatedTool2Title: 'Coupeur audio',
                relatedTool2Desc: 'Couper des fichiers audio en ligne',
                relatedTool3Title: 'Convertisseur d\'images',
                relatedTool3Desc: 'Convertir WebP/PNG/JPG',
                relatedTool4Title: 'Compresseur d\'images',
                relatedTool4Desc: 'Compresser des images par lots',
                footerText: 'Traitement cÃ´tÃ© client, les vidÃ©os ne sont pas tÃ©lÃ©chargÃ©es sur le serveur',
                footerBackHome: 'â† Retour Ã  l\'accueil Web Toolbox'
            },
            'es': {
                pageTitle: 'ğŸ¬ Descargador M3U8 por lotes',
                backToToolbox: 'â† Volver a la caja de herramientas',
                featurePlayTitle: 'ReproducciÃ³n en lÃ­nea',
                featurePlayDesc: 'Reproduce streams de video M3U8/HLS directamente en el navegador, sin reproductor adicional',
                featureDownloadTitle: 'Descarga de video',
                featureDownloadDesc: 'Analiza archivos M3U8, descarga automÃ¡ticamente todos los segmentos y los fusiona',
                featureQualityTitle: 'Multi calidad',
                featureQualityDesc: 'Detecta automÃ¡ticamente streams de mÃºltiple calidad, elige diferentes versiones',
                featureProgressTitle: 'VisualizaciÃ³n de progreso',
                featureProgressDesc: 'Progreso en tiempo real, segmentos descargados y tiempo restante',
                addTaskTitle: 'ğŸ“¥ Agregar tarea de descarga',
                singleUrlPlaceholder: 'Ingresa un enlace M3U8...',
                fileNamePlaceholder: 'Nombre del archivo (opcional)',
                btnAdd: 'Agregar',
                batchUrlsPlaceholder: 'Importar enlaces M3U8 por lotes (uno por lÃ­nea)\nFormatos soportados:\nhttps://example.com/video.m3u8\nNombre personalizado|https://example.com/video.m3u8',
                btnBatchAdd: 'Agregar por lotes',
                btnClearInput: 'Limpiar',
                btnImportFile: 'Importar archivo',
                taskListTitle: 'ğŸ“‹ Lista de tareas',
                taskCount: '0 tareas',
                btnStartAll: 'Iniciar todo',
                btnPauseAll: 'Pausar todo',
                btnClearCompleted: 'Limpiar completados',
                btnClearAll: 'Limpiar todo',
                btnSaveAllCompleted: 'Guardar todos los completados',
                emptyStateTitle: 'Sin tareas de descarga',
                emptyStateDesc: 'Agrega enlaces M3U8 para comenzar',
                tipsTitle: 'ğŸ’¡ Consejos de uso',
                tip1: 'Soporta agregar enlaces M3U8 individualmente o por lotes',
                tip2: 'Formato de importaciÃ³n por lotes: un enlace por lÃ­nea, o usa el formato "nombre|enlace"',
                tip3: 'Debido a restricciones de seguridad del navegador, algunos recursos cross-origin pueden no descargarse',
                tip4: 'Los archivos descargados estÃ¡n en formato TS, convierte a MP4 con FFmpeg: <code>ffmpeg -i video.ts -c copy video.mp4</code>',
                tip5: 'Se recomienda Chrome para mejor experiencia',
                statusPending: 'Pendiente',
                statusDownloading: 'Descargando',
                statusPaused: 'Pausado',
                statusCompleted: 'Completado',
                statusError: 'Error',
                btnStart: 'Iniciar',
                btnPause: 'Pausar',
                btnStop: 'Detener',
                btnResume: 'Continuar',
                btnRestart: 'Reiniciar',
                btnRetry: 'Reintentar',
                btnSaveFile: 'Guardar',
                btnDelete: 'Eliminar',
                loadingPreview: 'Cargando...',
                previewFailed: 'Vista previa fallida',
                previewNotSupported: 'Vista previa no soportada',
                segments: 'segmentos',
                alertEnterUrl: 'Por favor ingresa un enlace M3U8',
                alertValidUrl: 'Por favor ingresa una URL vÃ¡lida',
                alertAddedTasks: '{count} tareas agregadas exitosamente',
                alertNoValidUrl: 'No se encontraron URLs vÃ¡lidas',
                alertMaxConcurrent: 'MÃ¡ximo {count} descargas simultÃ¡neas, por favor espera',
                alertNoCompleted: 'No hay tareas completadas',
                alertConfirmSave: 'Â¿Deseas guardar {count} archivos de video completados?',
                alertStartedSaving: 'Guardando {count} archivos',
                alertConfirmClearAll: 'Â¿Deseas limpiar todas las tareas?',
                errorFetchM3u8: 'No se puede obtener el archivo M3U8',
                errorNoSegments: 'No se encontraron segmentos de video vÃ¡lidos en el archivo M3U8',
                errorSegmentFailed: 'FallÃ³ la descarga del segmento {index}',
                taskCountFormat: '{total} tareas ({downloading} descargando, {completed} completadas)',
                faqTitle: 'â“ Preguntas frecuentes',
                faq1Question: 'Â¿QuÃ© es el formato M3U8?',
                faq1Answer: 'M3U8 es el formato de archivo de Ã­ndice para el protocolo HLS (HTTP Live Streaming). Contiene una lista de segmentos de video (archivos TS). HLS es un protocolo de streaming adaptativo desarrollado por Apple, ampliamente usado para reproducciÃ³n de video en lÃ­nea.',
                faq2Question: 'Â¿Por quÃ© algunos videos M3U8 no se pueden descargar?',
                faq2Answer: 'Puede ser porque el video usa protecciÃ³n DRM, o requiere informaciÃ³n de autenticaciÃ³n especÃ­fica (Cookie, Token). Esta herramienta solo soporta streams M3U8 pÃºblicos y no encriptados. AdemÃ¡s, algunos sitios tienen restricciones CORS.',
                faq3Question: 'Â¿En quÃ© formato estÃ¡n los videos descargados?',
                faq3Answer: 'Los videos estÃ¡n en formato TS (Transport Stream), fusionados de los segmentos M3U8. El formato TS puede reproducirse directamente con VLC, PotPlayer, etc. Para convertir a MP4: <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-family: monospace;">ffmpeg -i video.ts -c copy video.mp4</code>',
                faq4Question: 'Â¿QuÃ© determina la velocidad de descarga?',
                faq4Answer: 'La velocidad depende de dos factores: el ancho de banda del servidor de video original y tu conexiÃ³n de red local. Esta herramienta soporta descargas multi-hilo (5 simultÃ¡neas por defecto) para mejorar la eficiencia.',
                faq5Question: 'Â¿Los datos de video pasan por un servidor?',
                faq5Answer: 'No. Esta herramienta funciona completamente en el navegador. Los datos de video se descargan directamente del servidor original a tu navegador, garantizando la seguridad y privacidad de los datos.',
                relatedToolsTitle: 'ğŸ”— Herramientas relacionadas',
                relatedTool1Title: 'Descarga X/TikTok',
                relatedTool1Desc: 'Descargar videos de redes sociales',
                relatedTool2Title: 'Cortador de audio',
                relatedTool2Desc: 'Cortar archivos de audio en lÃ­nea',
                relatedTool3Title: 'Convertidor de imÃ¡genes',
                relatedTool3Desc: 'Convertir WebP/PNG/JPG',
                relatedTool4Title: 'Compresor de imÃ¡genes',
                relatedTool4Desc: 'Comprimir imÃ¡genes por lotes',
                footerText: 'Procesamiento del lado del cliente, los videos no se suben al servidor',
                footerBackHome: 'â† Volver a la pÃ¡gina principal de Web Toolbox'
            }
        };

        let currentLang = localStorage.getItem('preferredLanguage') || 'en';

        // è·å–ç¿»è¯‘æ–‡æœ¬
        function t(key, params = {}) {
            let text = i18n[currentLang]?.[key] || i18n['en'][key] || key;
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            return text;
        }

        // æ›´æ–°é¡µé¢ä¸Šæ‰€æœ‰å¸¦æœ‰ data-i18n å±æ€§çš„å…ƒç´ 
        function updatePageLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const text = t(key);
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    // è¾“å…¥æ¡†ä¸ç›´æ¥è®¾ç½®å†…å®¹
                } else {
                    el.innerHTML = text;
                }
            });

            // æ›´æ–° placeholder
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });

            // æ›´æ–°è¯­è¨€åˆ‡æ¢å™¨å½“å‰æ˜¾ç¤º
            const langNames = { 'en': 'ğŸ‡ºğŸ‡¸ English', 'zh-CN': 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡', 'fr': 'ğŸ‡«ğŸ‡· FranÃ§ais', 'es': 'ğŸ‡ªğŸ‡¸ EspaÃ±ol' };
            document.getElementById('langCurrent').textContent = langNames[currentLang] || 'ğŸŒ English';

            // é‡æ–°æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨å’ŒFAQç­‰åŠ¨æ€å†…å®¹
            renderTasks();
            updateTaskCount();
            renderFAQ();
            renderRelatedTools();
            renderFooter();
        }

        // åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢å™¨
        function initLanguageSwitcher() {
            const dropdown = document.getElementById('langDropdown');
            const current = document.getElementById('langCurrent');

            current.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdown.classList.toggle('active');
            });

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const lang = btn.getAttribute('data-lang');
                    currentLang = lang;
                    localStorage.setItem('preferredLanguage', lang);
                    dropdown.classList.remove('active');
                    updatePageLanguage();
                });
            });

            document.addEventListener('click', () => {
                dropdown.classList.remove('active');
            });
        }

        // æ¸²æŸ“FAQ
        function renderFAQ() {
            const faqSection = document.getElementById('faqSection');
            if (!faqSection) return;

            faqSection.innerHTML = `
                <h2 style="color: #00d9ff; font-size: 20px; margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid rgba(0,217,255,0.3);">${t('faqTitle')}</h2>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    ${[1,2,3,4,5].map(i => `
                        <details style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden;">
                            <summary style="padding: 16px 20px; cursor: pointer; font-weight: 600; color: #e4e4e4; display: flex; align-items: center; gap: 12px; user-select: none;">
                                <span style="color: #00d9ff;">Q:</span> ${t('faq' + i + 'Question')}
                            </summary>
                            <div style="padding: 0 20px 16px 20px; color: rgba(255,255,255,0.7); line-height: 1.7;">
                                <p>${t('faq' + i + 'Answer')}</p>
                            </div>
                        </details>
                    `).join('')}
                </div>
            `;
        }

        // æ¸²æŸ“ç›¸å…³å·¥å…·
        function renderRelatedTools() {
            const section = document.getElementById('relatedToolsSection');
            if (!section) return;

            section.innerHTML = `
                <h3 style="color: #e4e4e4; font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">${t('relatedToolsTitle')}</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <a href="social-video-downloader.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“±</div>
                        <div style="color: #e4e4e4; font-weight: 500;">${t('relatedTool1Title')}</div>
                        <div style="color: #888; font-size: 12px; margin-top: 4px;">${t('relatedTool1Desc')}</div>
                    </a>
                    <a href="audio-cutter.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸµ</div>
                        <div style="color: #e4e4e4; font-weight: 500;">${t('relatedTool2Title')}</div>
                        <div style="color: #888; font-size: 12px; margin-top: 4px;">${t('relatedTool2Desc')}</div>
                    </a>
                    <a href="image-converter.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸ–¼ï¸</div>
                        <div style="color: #e4e4e4; font-weight: 500;">${t('relatedTool3Title')}</div>
                        <div style="color: #888; font-size: 12px; margin-top: 4px;">${t('relatedTool3Desc')}</div>
                    </a>
                    <a href="image-compressor.html" style="display: block; padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“¦</div>
                        <div style="color: #e4e4e4; font-weight: 500;">${t('relatedTool4Title')}</div>
                        <div style="color: #888; font-size: 12px; margin-top: 4px;">${t('relatedTool4Desc')}</div>
                    </a>
                </div>
            `;
        }

        // æ¸²æŸ“é¡µè„š
        function renderFooter() {
            const footer = document.getElementById('pageFooter');
            if (!footer) return;

            footer.innerHTML = `
                <p>${t('footerText')}</p>
                <p style="margin-top: 12px;">
                    <a href="index.html" style="color: #00d9ff; text-decoration: none;">${t('footerBackHome')}</a>
                    <span style="margin: 0 12px;">|</span>
                    <a href="https://github.com/heyuan110" target="_blank" rel="noopener" style="color: #00d9ff; text-decoration: none;">GitHub</a>
                </p>
            `;
        }

        // ==================== ä¸‹è½½å™¨ä¸»é€»è¾‘ ====================

        // ä»»åŠ¡çŠ¶æ€æšä¸¾
        const TaskStatus = {
            PENDING: 'pending',
            DOWNLOADING: 'downloading',
            PAUSED: 'paused',
            COMPLETED: 'completed',
            ERROR: 'error'
        };

        // ä»»åŠ¡åˆ—è¡¨
        let tasks = [];
        let taskIdCounter = 0;

        // å¹¶å‘ä¸‹è½½æ§åˆ¶
        const MAX_CONCURRENT_DOWNLOADS = 3;
        let activeDownloads = 0;

        // æ·»åŠ å•ä¸ªä»»åŠ¡
        function addSingleTask() {
            const urlInput = document.getElementById('singleUrl');
            const nameInput = document.getElementById('fileName');
            const url = urlInput.value.trim();
            const name = nameInput.value.trim();

            if (!url) {
                alert(t('alertEnterUrl'));
                return;
            }

            if (!isValidUrl(url)) {
                alert(t('alertValidUrl'));
                return;
            }

            createTask(url, name || extractFileName(url));
            urlInput.value = '';
            nameInput.value = '';
        }

        // æ‰¹é‡æ·»åŠ ä»»åŠ¡
        function addBatchTasks() {
            const textarea = document.getElementById('batchUrls');
            const lines = textarea.value.trim().split('\n').filter(line => line.trim());

            if (lines.length === 0) {
                alert(t('alertEnterUrl'));
                return;
            }

            let addedCount = 0;
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                let url, name;
                if (line.includes('|')) {
                    const parts = line.split('|');
                    name = parts[0].trim();
                    url = parts[1].trim();
                } else {
                    url = line;
                    name = extractFileName(url);
                }

                if (isValidUrl(url)) {
                    createTask(url, name);
                    addedCount++;
                }
            });

            if (addedCount > 0) {
                textarea.value = '';
                alert(t('alertAddedTasks', { count: addedCount }));
            } else {
                alert(t('alertNoValidUrl'));
            }
        }

        // åˆ›å»ºä»»åŠ¡
        function createTask(url, name) {
            const task = {
                id: ++taskIdCounter,
                url: url,
                name: name || `video_${taskIdCounter}`,
                status: TaskStatus.PENDING,
                progress: 0,
                downloaded: 0,
                total: 0,
                segments: [],
                downloadedSegments: [],
                controller: null,
                error: null
            };
            tasks.push(task);
            renderTasks();
            updateTaskCount();
        }

        // éªŒè¯URL
        function isValidUrl(url) {
            try {
                new URL(url);
                return url.includes('.m3u8') || url.includes('m3u8');
            } catch {
                return false;
            }
        }

        // ä»URLæå–æ–‡ä»¶å
        function extractFileName(url) {
            try {
                const urlObj = new URL(url);
                const pathname = urlObj.pathname;
                const fileName = pathname.split('/').pop().replace('.m3u8', '');
                return fileName || `video_${Date.now()}`;
            } catch {
                return `video_${Date.now()}`;
            }
        }

        // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
        function renderTasks() {
            const taskList = document.getElementById('taskList');

            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <p>${t('emptyStateTitle')}</p>
                        <p style="font-size: 12px; margin-top: 8px;">${t('emptyStateDesc')}</p>
                    </div>
                `;
                return;
            }

            taskList.innerHTML = tasks.map(task => `
                <div class="task-item ${task.status === TaskStatus.DOWNLOADING ? 'downloading' : ''}" id="task-${task.id}">
                    <div class="task-preview" id="preview-${task.id}" onclick="togglePreview(${task.id})">
                        <div class="preview-placeholder loading-placeholder">
                            <div class="loading-spinner"></div>
                            <span>${t('loadingPreview')}</span>
                        </div>
                    </div>
                    <div class="task-content">
                        <div class="task-header">
                            <div>
                                <div class="task-name">${escapeHtml(task.name)}</div>
                                <div class="task-url">${escapeHtml(task.url)}</div>
                            </div>
                            <span class="task-status status-${task.status}">${getStatusText(task.status)}</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${task.progress}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>${task.progress.toFixed(1)}%</span>
                                <span>${task.downloaded}/${task.total} ${t('segments')}</span>
                            </div>
                        </div>
                        ${task.error ? `<div style="color: #ff4757; font-size: 12px; margin-bottom: 8px;">Error: ${escapeHtml(task.error)}</div>` : ''}
                        <div class="task-actions">
                            ${getTaskActions(task)}
                        </div>
                    </div>
                </div>
            `).join('');

            // è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœªåŠ è½½çš„é¢„è§ˆ
            autoStartPreviews();
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                [TaskStatus.PENDING]: t('statusPending'),
                [TaskStatus.DOWNLOADING]: t('statusDownloading'),
                [TaskStatus.PAUSED]: t('statusPaused'),
                [TaskStatus.COMPLETED]: t('statusCompleted'),
                [TaskStatus.ERROR]: t('statusError')
            };
            return statusMap[status] || status;
        }

        // è·å–ä»»åŠ¡æ“ä½œæŒ‰é’®
        function getTaskActions(task) {
            switch (task.status) {
                case TaskStatus.PENDING:
                    return `
                        <button class="btn btn-success" onclick="startTask(${task.id})">â–¶ï¸ ${t('btnStart')}</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ ${t('btnDelete')}</button>
                    `;
                case TaskStatus.DOWNLOADING:
                    return `
                        <button class="btn btn-warning" onclick="pauseTask(${task.id})">â¸ï¸ ${t('btnPause')}</button>
                        <button class="btn btn-danger" onclick="stopTask(${task.id})">â¹ï¸ ${t('btnStop')}</button>
                    `;
                case TaskStatus.PAUSED:
                    return `
                        <button class="btn btn-success" onclick="resumeTask(${task.id})">â–¶ï¸ ${t('btnResume')}</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ ${t('btnDelete')}</button>
                    `;
                case TaskStatus.COMPLETED:
                    return `
                        <button class="btn btn-primary" onclick="downloadFile(${task.id})">ğŸ’¾ ${t('btnSaveFile')}</button>
                        <button class="btn btn-secondary" onclick="restartTask(${task.id})">ğŸ”„ ${t('btnRestart')}</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ ${t('btnDelete')}</button>
                    `;
                case TaskStatus.ERROR:
                    return `
                        <button class="btn btn-success" onclick="restartTask(${task.id})">ğŸ”„ ${t('btnRetry')}</button>
                        <button class="btn btn-danger" onclick="removeTask(${task.id})">ğŸ—‘ï¸ ${t('btnDelete')}</button>
                    `;
                default:
                    return '';
            }
        }

        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ›´æ–°ä»»åŠ¡è®¡æ•°
        function updateTaskCount() {
            const countEl = document.getElementById('taskCount');
            const downloading = tasks.filter(t => t.status === TaskStatus.DOWNLOADING).length;
            const completed = tasks.filter(t => t.status === TaskStatus.COMPLETED).length;
            countEl.textContent = t('taskCountFormat', { total: tasks.length, downloading, completed });
        }

        // å¼€å§‹ä¸‹è½½ä»»åŠ¡
        async function startTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (activeDownloads >= MAX_CONCURRENT_DOWNLOADS) {
                alert(t('alertMaxConcurrent', { count: MAX_CONCURRENT_DOWNLOADS }));
                return;
            }

            task.status = TaskStatus.DOWNLOADING;
            task.error = null;
            task.controller = new AbortController();
            activeDownloads++;
            renderTasks();
            updateTaskCount();

            try {
                // è§£æM3U8
                const segments = await parseM3U8(task.url, task.controller.signal);
                task.segments = segments;
                task.total = segments.length;
                task.downloadedSegments = new Array(segments.length).fill(null);
                renderTasks();

                // ä¸‹è½½æ‰€æœ‰ç‰‡æ®µ
                await downloadSegments(task);

                if (task.status === TaskStatus.DOWNLOADING) {
                    task.status = TaskStatus.COMPLETED;
                    task.progress = 100;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    // ç”¨æˆ·å–æ¶ˆ
                } else {
                    task.status = TaskStatus.ERROR;
                    task.error = error.message;
                }
            } finally {
                activeDownloads--;
                renderTasks();
                updateTaskCount();
                processQueue();
            }
        }

        // è§£æM3U8æ–‡ä»¶
        async function parseM3U8(url, signal) {
            const response = await fetch(url, { signal });
            if (!response.ok) {
                throw new Error(`${t('errorFetchM3u8')}: ${response.status}`);
            }

            const text = await response.text();
            const baseUrl = url.substring(0, url.lastIndexOf('/') + 1);
            const lines = text.split('\n');
            const segments = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();

                // æ£€æŸ¥æ˜¯å¦æ˜¯åµŒå¥—çš„m3u8ï¼ˆä¸»æ’­æ”¾åˆ—è¡¨ï¼‰
                if (line.endsWith('.m3u8')) {
                    const nestedUrl = line.startsWith('http') ? line : baseUrl + line;
                    return await parseM3U8(nestedUrl, signal);
                }

                // æ£€æŸ¥TSç‰‡æ®µ
                if (line && !line.startsWith('#')) {
                    const segmentUrl = line.startsWith('http') ? line : baseUrl + line;
                    segments.push(segmentUrl);
                }
            }

            if (segments.length === 0) {
                throw new Error(t('errorNoSegments'));
            }

            return segments;
        }

        // ä¸‹è½½æ‰€æœ‰ç‰‡æ®µ
        async function downloadSegments(task) {
            const concurrency = 5; // æ¯ä¸ªä»»åŠ¡çš„å¹¶å‘ç‰‡æ®µæ•°
            let currentIndex = task.downloaded;

            const downloadNext = async () => {
                while (currentIndex < task.segments.length && task.status === TaskStatus.DOWNLOADING) {
                    const index = currentIndex++;
                    try {
                        const response = await fetch(task.segments[index], {
                            signal: task.controller.signal
                        });
                        if (!response.ok) {
                            throw new Error(t('errorSegmentFailed', { index }));
                        }
                        const buffer = await response.arrayBuffer();
                        task.downloadedSegments[index] = buffer;
                        task.downloaded++;
                        task.progress = (task.downloaded / task.total) * 100;
                        updateTaskProgress(task);
                    } catch (error) {
                        if (error.name !== 'AbortError') {
                            console.error(`Segment ${index} download failed:`, error);
                            // ç»§ç»­ä¸‹è½½å…¶ä»–ç‰‡æ®µ
                        }
                        throw error;
                    }
                }
            };

            const workers = [];
            for (let i = 0; i < concurrency; i++) {
                workers.push(downloadNext());
            }

            await Promise.all(workers);
        }

        // æ›´æ–°ä»»åŠ¡è¿›åº¦ï¼ˆä¸é‡æ–°æ¸²æŸ“æ•´ä¸ªåˆ—è¡¨ï¼‰
        function updateTaskProgress(task) {
            const taskEl = document.getElementById(`task-${task.id}`);
            if (!taskEl) return;

            const progressFill = taskEl.querySelector('.progress-fill');
            const progressText = taskEl.querySelectorAll('.progress-text span');

            if (progressFill) {
                progressFill.style.width = `${task.progress}%`;
            }
            if (progressText[0]) {
                progressText[0].textContent = `${task.progress.toFixed(1)}%`;
            }
            if (progressText[1]) {
                progressText[1].textContent = `${task.downloaded}/${task.total} ${t('segments')}`;
            }
        }

        // æš‚åœä»»åŠ¡
        function pauseTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.status !== TaskStatus.DOWNLOADING) return;

            task.status = TaskStatus.PAUSED;
            if (task.controller) {
                task.controller.abort();
            }
            activeDownloads--;
            renderTasks();
            updateTaskCount();
            processQueue();
        }

        // ç»§ç»­ä»»åŠ¡
        async function resumeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.status !== TaskStatus.PAUSED) return;

            if (activeDownloads >= MAX_CONCURRENT_DOWNLOADS) {
                alert(t('alertMaxConcurrent', { count: MAX_CONCURRENT_DOWNLOADS }));
                return;
            }

            task.status = TaskStatus.DOWNLOADING;
            task.controller = new AbortController();
            activeDownloads++;
            renderTasks();
            updateTaskCount();

            try {
                await downloadSegments(task);

                if (task.status === TaskStatus.DOWNLOADING) {
                    task.status = TaskStatus.COMPLETED;
                    task.progress = 100;
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    // ç”¨æˆ·å–æ¶ˆ
                } else {
                    task.status = TaskStatus.ERROR;
                    task.error = error.message;
                }
            } finally {
                activeDownloads--;
                renderTasks();
                updateTaskCount();
                processQueue();
            }
        }

        // åœæ­¢ä»»åŠ¡
        function stopTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (task.controller) {
                task.controller.abort();
            }
            task.status = TaskStatus.PENDING;
            task.progress = 0;
            task.downloaded = 0;
            task.total = 0;
            task.segments = [];
            task.downloadedSegments = [];
            activeDownloads--;
            renderTasks();
            updateTaskCount();
            processQueue();
        }

        // é‡æ–°å¼€å§‹ä»»åŠ¡
        function restartTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            task.status = TaskStatus.PENDING;
            task.progress = 0;
            task.downloaded = 0;
            task.total = 0;
            task.segments = [];
            task.downloadedSegments = [];
            task.error = null;
            renderTasks();
            startTask(taskId);
        }

        // åˆ é™¤ä»»åŠ¡
        function removeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (task.controller) {
                task.controller.abort();
            }
            if (task.status === TaskStatus.DOWNLOADING) {
                activeDownloads--;
            }
            cleanupPreview(taskId); // æ¸…ç†é¢„è§ˆæ’­æ”¾å™¨
            tasks = tasks.filter(t => t.id !== taskId);
            renderTasks();
            updateTaskCount();
            processQueue();
        }

        // ä¸‹è½½åˆå¹¶åçš„æ–‡ä»¶
        function downloadFile(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.status !== TaskStatus.COMPLETED) return;

            // åˆå¹¶æ‰€æœ‰ç‰‡æ®µ
            const validSegments = task.downloadedSegments.filter(s => s !== null);
            const blob = new Blob(validSegments, { type: 'video/mp2t' });

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${task.name}.ts`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ‰¹é‡ä¸‹è½½æ‰€æœ‰å·²å®Œæˆçš„æ–‡ä»¶
        async function downloadAllCompleted() {
            const completedTasks = tasks.filter(t => t.status === TaskStatus.COMPLETED);

            if (completedTasks.length === 0) {
                alert(t('alertNoCompleted'));
                return;
            }

            const confirmed = confirm(t('alertConfirmSave', { count: completedTasks.length }));
            if (!confirmed) return;

            // é€ä¸ªä¸‹è½½ï¼Œé—´éš”500msé¿å…æµè§ˆå™¨æ‹¦æˆª
            for (let i = 0; i < completedTasks.length; i++) {
                const task = completedTasks[i];

                // åˆå¹¶æ‰€æœ‰ç‰‡æ®µ
                const validSegments = task.downloadedSegments.filter(s => s !== null);
                if (validSegments.length === 0) continue;

                const blob = new Blob(validSegments, { type: 'video/mp2t' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${task.name}.ts`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                // å»¶è¿Ÿé‡Šæ”¾URLï¼Œç¡®ä¿ä¸‹è½½å¼€å§‹
                setTimeout(() => URL.revokeObjectURL(url), 1000);

                // é—´éš”ä¸‹è½½ï¼Œé¿å…è¢«æµè§ˆå™¨æ‹¦æˆª
                if (i < completedTasks.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }

            alert(t('alertStartedSaving', { count: completedTasks.length }));
        }

        // å¤„ç†ç­‰å¾…é˜Ÿåˆ—
        function processQueue() {
            if (activeDownloads >= MAX_CONCURRENT_DOWNLOADS) return;

            const pendingTask = tasks.find(t => t.status === TaskStatus.PENDING);
            if (pendingTask) {
                // ä¸è‡ªåŠ¨å¼€å§‹ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨æ§åˆ¶
            }
        }

        // å…¨éƒ¨å¼€å§‹
        function startAll() {
            const pendingTasks = tasks.filter(t => t.status === TaskStatus.PENDING || t.status === TaskStatus.PAUSED);
            pendingTasks.slice(0, MAX_CONCURRENT_DOWNLOADS - activeDownloads).forEach(task => {
                if (task.status === TaskStatus.PAUSED) {
                    resumeTask(task.id);
                } else {
                    startTask(task.id);
                }
            });
        }

        // å…¨éƒ¨æš‚åœ
        function pauseAll() {
            const downloadingTasks = tasks.filter(t => t.status === TaskStatus.DOWNLOADING);
            downloadingTasks.forEach(task => pauseTask(task.id));
        }

        // æ¸…é™¤å·²å®Œæˆ
        function clearCompleted() {
            // æ¸…ç†å·²å®Œæˆä»»åŠ¡çš„é¢„è§ˆæ’­æ”¾å™¨
            tasks.filter(t => t.status === TaskStatus.COMPLETED).forEach(t => {
                cleanupPreview(t.id);
            });
            tasks = tasks.filter(t => t.status !== TaskStatus.COMPLETED);
            renderTasks();
            updateTaskCount();
        }

        // æ¸…ç©ºå…¨éƒ¨
        function clearAll() {
            if (!confirm(t('alertConfirmClearAll'))) return;

            tasks.forEach(task => {
                if (task.controller) {
                    task.controller.abort();
                }
            });
            cleanupAllPreviews(); // æ¸…ç†æ‰€æœ‰é¢„è§ˆæ’­æ”¾å™¨
            tasks = [];
            activeDownloads = 0;
            renderTasks();
            updateTaskCount();
        }

        // æ¸…ç©ºè¾“å…¥
        function clearInput() {
            document.getElementById('singleUrl').value = '';
            document.getElementById('fileName').value = '';
            document.getElementById('batchUrls').value = '';
        }

        // ä»æ–‡ä»¶å¯¼å…¥
        function loadFromFile() {
            document.getElementById('fileInput').click();
        }

        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('batchUrls').value = e.target.result;
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // é”®ç›˜å¿«æ·é”®
        document.getElementById('singleUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addSingleTask();
            }
        });

        // é¢„è§ˆç›¸å…³
        const previewPlayers = {}; // å­˜å‚¨HLSå®ä¾‹

        // è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœªåŠ è½½çš„é¢„è§ˆ
        function autoStartPreviews() {
            tasks.forEach(task => {
                const previewEl = document.getElementById(`preview-${task.id}`);
                if (!previewEl) return;

                // æ£€æŸ¥DOMä¸­æ˜¯å¦æœ‰è§†é¢‘å…ƒç´ 
                const hasVideo = previewEl.querySelector('video');

                // å¦‚æœpreviewPlayersä¸­æœ‰å®ä¾‹ä½†DOMä¸­æ²¡æœ‰è§†é¢‘ï¼Œè¯´æ˜DOMè¢«é‡å»ºäº†ï¼Œéœ€è¦æ¸…ç†æ—§å®ä¾‹
                if (previewPlayers[task.id] && !hasVideo) {
                    cleanupPreview(task.id);
                }

                // å¦‚æœæ²¡æœ‰é¢„è§ˆæ’­æ”¾å™¨ï¼Œåˆ™å¯åŠ¨é¢„è§ˆ
                if (!previewPlayers[task.id]) {
                    startPreview(task.id);
                }
            });
        }

        // å¯åŠ¨é¢„è§ˆï¼ˆè‡ªåŠ¨è°ƒç”¨ï¼‰
        function startPreview(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const previewEl = document.getElementById(`preview-${taskId}`);
            if (!previewEl) return;

            // å¦‚æœå·²ç»æœ‰è§†é¢‘å…ƒç´ ï¼Œè·³è¿‡
            if (previewEl.querySelector('video')) return;

            // åˆ›å»ºè§†é¢‘å…ƒç´ 
            previewEl.innerHTML = `
                <video muted playsinline loop></video>
            `;

            const video = previewEl.querySelector('video');

            // ä½¿ç”¨HLS.jsåŠ è½½è§†é¢‘
            if (Hls.isSupported()) {
                const hls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    maxBufferLength: 10,
                    maxMaxBufferLength: 20
                });

                hls.loadSource(task.url);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    previewEl.classList.add('playing');
                    video.play().catch(() => {
                        // è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢
                        previewEl.classList.remove('playing');
                    });
                });

                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        previewEl.innerHTML = `
                            <div class="preview-placeholder">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="15" y1="9" x2="9" y2="15"></line>
                                    <line x1="9" y1="9" x2="15" y2="15"></line>
                                </svg>
                                <span>${t('previewFailed')}</span>
                            </div>
                        `;
                        hls.destroy();
                        delete previewPlayers[taskId];
                    }
                });

                previewPlayers[taskId] = hls;
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // SafariåŸç”Ÿæ”¯æŒ
                video.src = task.url;
                video.addEventListener('loadedmetadata', () => {
                    previewEl.classList.add('playing');
                    video.play();
                });
                video.addEventListener('error', () => {
                    previewEl.innerHTML = `
                        <div class="preview-placeholder">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            <span>${t('previewFailed')}</span>
                        </div>
                    `;
                });
                previewPlayers[taskId] = { destroy: () => {} }; // å ä½
            } else {
                previewEl.innerHTML = `
                    <div class="preview-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                        </svg>
                        <span>${t('previewNotSupported')}</span>
                    </div>
                `;
            }
        }

        // åˆ‡æ¢é¢„è§ˆï¼ˆç‚¹å‡»æ—¶è°ƒç”¨ï¼‰
        function togglePreview(taskId) {
            const previewEl = document.getElementById(`preview-${taskId}`);
            if (!previewEl) return;

            const video = previewEl.querySelector('video');
            if (video) {
                if (video.paused) {
                    video.play();
                    previewEl.classList.add('playing');
                } else {
                    video.pause();
                    previewEl.classList.remove('playing');
                }
            }
        }

        // æ¸…ç†é¢„è§ˆæ’­æ”¾å™¨
        function cleanupPreview(taskId) {
            if (previewPlayers[taskId]) {
                previewPlayers[taskId].destroy();
                delete previewPlayers[taskId];
            }
        }

        // æ¸…ç†æ‰€æœ‰é¢„è§ˆ
        function cleanupAllPreviews() {
            Object.keys(previewPlayers).forEach(id => {
                previewPlayers[id].destroy();
                delete previewPlayers[id];
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initLanguageSwitcher();
            updatePageLanguage();
        });
    </script>

    <!-- FAQ é—®ç­”åŒºå— -->
    <section id="faqSection" class="faq-section" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">
        <!-- ç”± JavaScript åŠ¨æ€æ¸²æŸ“ -->
    </section>

    <!-- ç›¸å…³å·¥å…·æ¨è -->
    <section id="relatedToolsSection" class="related-tools" style="max-width: 1200px; margin: 40px auto; padding: 0 20px;">
        <!-- ç”± JavaScript åŠ¨æ€æ¸²æŸ“ -->
    </section>

    <footer id="pageFooter" style="text-align: center; padding: 30px 20px; border-top: 1px solid rgba(255,255,255,0.1); color: #888; font-size: 14px;">
        <!-- ç”± JavaScript åŠ¨æ€æ¸²æŸ“ -->
    </footer>
</body>
</html>
