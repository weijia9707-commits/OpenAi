<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- SEO META -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯ä»¶ç…§è£å‰ª & é€æ˜æ–‡å­—æ°´å° - æœ¬åœ°ç¦»çº¿å¤„ç†å·¥å…· | Web Toolbox</title>
    <meta name="description" content="å…è´¹åœ¨çº¿è¯ä»¶ç…§è£å‰ªå·¥å…·ï¼Œæ”¯æŒ1å¯¸ã€2å¯¸ã€æŠ¤ç…§ç…§ç­‰è§„æ ¼ï¼Œå¯æ·»åŠ é€æ˜æ–‡å­—æ°´å°ã€‚å®Œå…¨æœ¬åœ°ç¦»çº¿å¤„ç†ï¼Œé€‚åˆèº«ä»½è¯ã€é©¾ç…§ã€æŠ¤ç…§ç­‰æ•æ„Ÿè¯ä»¶ï¼Œæ— ä»»ä½•ç½‘ç»œè¯·æ±‚ï¼Œä¿æŠ¤éšç§å®‰å…¨ã€‚">
    <meta name="keywords" content="è¯ä»¶ç…§è£å‰ª,è¯ä»¶ç…§åˆ¶ä½œ,ç…§ç‰‡æ°´å°,é€æ˜æ°´å°,1å¯¸ç…§ç‰‡,2å¯¸ç…§ç‰‡,æŠ¤ç…§ç…§ç‰‡,å›¾ç‰‡å‹ç¼©,ç¦»çº¿å·¥å…·,éšç§å®‰å…¨">
    <meta name="author" content="Web Toolbox">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.heyuan110.com/web-toolbox/id-photo-tool.html">
    <meta property="og:title" content="è¯ä»¶ç…§è£å‰ª & é€æ˜æ–‡å­—æ°´å° - æœ¬åœ°ç¦»çº¿å¤„ç†å·¥å…·">
    <meta property="og:description" content="å…è´¹åœ¨çº¿è¯ä»¶ç…§è£å‰ªå·¥å…·ï¼Œå®Œå…¨æœ¬åœ°ç¦»çº¿å¤„ç†ï¼Œä¿æŠ¤éšç§å®‰å…¨ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.heyuan110.com/web-toolbox/id-photo-tool.html">
    <meta property="og:locale" content="zh_CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="è¯ä»¶ç…§è£å‰ª & é€æ˜æ–‡å­—æ°´å° - æœ¬åœ°ç¦»çº¿å¤„ç†å·¥å…·">
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "è¯ä»¶ç…§è£å‰ª & é€æ˜æ–‡å­—æ°´å°å·¥å…·",
        "description": "æœ¬åœ°ç¦»çº¿å¤„ç†è¯ä»¶ç…§ï¼šè£å‰ªã€æ”¹åƒç´ å°ºå¯¸ã€å‹ç¼©ä½“ç§¯ï¼Œå¹¶å®‰å…¨æ·»åŠ é€æ˜æ–‡å­—æ°´å°",
        "url": "https://www.heyuan110.com/web-toolbox/id-photo-tool.html",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Any",
        "permissions": "browser",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CNY"}
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "æ”¯æŒå“ªäº›è¯ä»¶ç…§å°ºå¯¸ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "æ”¯æŒä¸€å¯¸(25x35mm)ã€äºŒå¯¸(35x49mm)ã€å°ä¸€å¯¸(22x32mm)ã€æŠ¤ç…§(33x48mm)ç­‰å¸¸ç”¨è¯ä»¶ç…§å°ºå¯¸ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä»»æ„å°ºå¯¸ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "èƒŒæ™¯è‰²æœ‰å“ªäº›é€‰æ‹©ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "æ”¯æŒçº¢è‰²ã€è“è‰²ã€ç™½è‰²ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„è¯ä»¶ç…§èƒŒæ™¯è‰²ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡é¢œè‰²é€‰æ‹©å™¨è‡ªå®šä¹‰ä»»æ„èƒŒæ™¯è‰²ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "ç…§ç‰‡ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨å—ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ä¸ä¼šï¼Œæ‰€æœ‰å¤„ç†åœ¨æœ¬åœ°æµè§ˆå™¨å®Œæˆï¼Œç…§ç‰‡ä¸ä¼šç¦»å¼€æ‚¨çš„è®¾å¤‡ã€‚è¿™æ˜¯ä¸€æ¬¾å®Œå…¨ç¦»çº¿è¿è¡Œçš„å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†èº«ä»½è¯ã€æŠ¤ç…§ç­‰æ•æ„Ÿè¯ä»¶ç…§ç‰‡ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "å¯ä»¥ç”¨æ‰‹æœºæ‹æ‘„çš„ç…§ç‰‡å—ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "å¯ä»¥ï¼Œå»ºè®®åœ¨å…‰çº¿å……è¶³çš„ç¯å¢ƒä¸‹æ‹æ‘„æ­£é¢ç…§ï¼Œä¿æŒèƒŒæ™¯ç®€æ´ã€‚å·¥å…·ä¼šè‡ªåŠ¨å¸®æ‚¨è£å‰ªåˆ°åˆé€‚çš„è¯ä»¶ç…§æ¯”ä¾‹ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "å¯¼å‡ºçš„ç…§ç‰‡åˆ†è¾¨ç‡æ˜¯å¤šå°‘ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "æ ¹æ®é€‰æ‹©çš„è§„æ ¼å¯¼å‡ºæ ‡å‡†æ‰“å°åˆ†è¾¨ç‡(300dpi)ã€‚ä¾‹å¦‚ä¸€å¯¸ç…§ç‰‡ä¸º295x413åƒç´ ï¼ŒäºŒå¯¸ç…§ç‰‡ä¸º413x531åƒç´ ï¼Œæ»¡è¶³å„ç±»è¯ä»¶ç…§æ‰“å°éœ€æ±‚ã€‚"
                }
            }
        ]
    }
    </script>

    <!-- TOOL_META -->
    <script>
    const TOOL_META = {
        slug: 'id-photo-tool',
        name: 'è¯ä»¶ç…§è£å‰ª & é€æ˜æ°´å°',
        description: 'æœ¬åœ°ç¦»çº¿å¤„ç†è¯ä»¶ç…§ï¼šè£å‰ªã€æ”¹å°ºå¯¸ã€å‹ç¼©ã€æ·»åŠ é€æ˜æ–‡å­—æ°´å°ï¼Œé€‚åˆæ•æ„Ÿè¯ä»¶å¤„ç†',
        keywords: ['è¯ä»¶ç…§', 'è£å‰ª', 'æ°´å°', 'å‹ç¼©', 'ç¦»çº¿', 'éšç§']
    };
    </script>

    <style>
    /* UI */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
        --primary: #4f46e5;
        --primary-hover: #4338ca;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --bg: #0f172a;
        --bg-card: #1e293b;
        --bg-input: #334155;
        --text: #f1f5f9;
        --text-muted: #94a3b8;
        --border: #475569;
        --radius: 8px;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        min-height: 100vh;
        color: var(--text);
        line-height: 1.5;
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

    /* Header */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: rgba(255,255,255,0.05);
        border-radius: var(--radius);
        margin-bottom: 20px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .header h1 {
        font-size: 1.4rem;
        background: linear-gradient(135deg, #60a5fa, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .back-link {
        color: var(--text-muted);
        text-decoration: none;
        padding: 8px 16px;
        border-radius: var(--radius);
        transition: all 0.2s;
    }
    .back-link:hover { background: rgba(255,255,255,0.1); color: var(--text); }

    /* Privacy Banner */
    .privacy-banner {
        background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(16,185,129,0.05));
        border: 1px solid rgba(16,185,129,0.3);
        border-radius: var(--radius);
        padding: 15px 20px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .privacy-banner .icon { font-size: 2rem; }
    .privacy-banner .text h3 { color: var(--success); margin-bottom: 5px; }
    .privacy-banner .text p { color: var(--text-muted); font-size: 0.9rem; }

    /* Main Layout */
    .main-layout {
        display: grid;
        grid-template-columns: 320px 1fr 320px;
        gap: 20px;
    }
    @media (max-width: 1200px) {
        .main-layout { grid-template-columns: 1fr; }
    }

    /* Cards */
    .card {
        background: var(--bg-card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        overflow: hidden;
    }
    .card-header {
        padding: 12px 16px;
        background: rgba(0,0,0,0.2);
        border-bottom: 1px solid var(--border);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .card-body { padding: 16px; }

    /* Tabs */
    .tabs {
        display: flex;
        border-bottom: 1px solid var(--border);
        background: rgba(0,0,0,0.2);
    }
    .tab {
        padding: 12px 16px;
        border: none;
        background: none;
        color: var(--text-muted);
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s;
        border-bottom: 2px solid transparent;
    }
    .tab:hover { color: var(--text); }
    .tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
        background: rgba(79,70,229,0.1);
    }
    .tab-content { display: none; padding: 16px; }
    .tab-content.active { display: block; }

    /* Forms */
    .form-group { margin-bottom: 16px; }
    .form-group:last-child { margin-bottom: 0; }
    .form-label {
        display: block;
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 6px;
    }
    .form-input, .form-select {
        width: 100%;
        padding: 10px 12px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text);
        font-size: 0.9rem;
    }
    .form-input:focus, .form-select:focus {
        outline: none;
        border-color: var(--primary);
    }
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    .form-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }
    .form-checkbox input { width: 16px; height: 16px; cursor: pointer; }

    /* Range Slider */
    .range-group { display: flex; align-items: center; gap: 10px; }
    .range-group input[type="range"] { flex: 1; }
    .range-value {
        min-width: 45px;
        text-align: right;
        font-size: 0.85rem;
        color: var(--primary);
    }

    /* Buttons */
    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: var(--radius);
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    .btn-primary {
        background: var(--primary);
        color: white;
    }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-success { background: var(--success); color: white; }
    .btn-success:hover { background: #059669; }
    .btn-outline {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
    }
    .btn-outline:hover { background: rgba(255,255,255,0.1); }
    .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-block { width: 100%; }
    .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }

    /* Preset Buttons */
    .preset-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    .preset-btn {
        padding: 8px 12px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text-muted);
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
        text-align: left;
    }
    .preset-btn:hover {
        border-color: var(--primary);
        color: var(--text);
    }
    .preset-btn.active {
        background: rgba(79,70,229,0.2);
        border-color: var(--primary);
        color: var(--primary);
    }
    .preset-btn small { display: block; font-size: 0.7rem; opacity: 0.7; }

    /* Watermark Position Grid */
    .position-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
        background: var(--bg-input);
        padding: 8px;
        border-radius: var(--radius);
    }
    .position-btn {
        aspect-ratio: 1;
        border: 1px solid var(--border);
        background: var(--bg-card);
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        color: var(--text-muted);
    }
    .position-btn:hover { border-color: var(--primary); }
    .position-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }

    /* Color Picker */
    .color-picker-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .color-picker-group input[type="color"] {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        background: none;
    }
    .color-picker-group input[type="text"] { flex: 1; }

    /* Upload Area */
    .upload-area {
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
    }
    .upload-area:hover, .upload-area.dragover {
        border-color: var(--primary);
        background: rgba(79,70,229,0.1);
    }
    .upload-area .icon { font-size: 3rem; margin-bottom: 15px; }
    .upload-area h3 { margin-bottom: 8px; }
    .upload-area p { color: var(--text-muted); font-size: 0.9rem; }
    .upload-area input { display: none; }

    /* Image List */
    .image-list { margin-top: 15px; max-height: 300px; overflow-y: auto; }
    .image-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px;
        background: var(--bg-input);
        border-radius: var(--radius);
        margin-bottom: 8px;
    }
    .image-item.active {
        border: 2px solid var(--primary);
    }
    .image-item img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 4px;
    }
    .image-item .info { flex: 1; min-width: 0; }
    .image-item .name {
        font-size: 0.85rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .image-item .meta {
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    .image-item .actions { display: flex; gap: 5px; }
    .image-item .btn-icon {
        width: 28px;
        height: 28px;
        padding: 0;
        font-size: 0.9rem;
    }

    /* Preview Area */
    .preview-container {
        position: relative;
        background: repeating-conic-gradient(#374151 0% 25%, #1f2937 0% 50%) 50% / 20px 20px;
        border-radius: var(--radius);
        min-height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }
    .preview-container.empty {
        background: var(--bg-input);
    }
    .preview-container .placeholder {
        text-align: center;
        color: var(--text-muted);
    }
    .preview-container .placeholder .icon { font-size: 4rem; margin-bottom: 15px; opacity: 0.5; }
    #previewCanvas {
        max-width: 100%;
        max-height: 500px;
        border-radius: 4px;
    }

    /* Cropper Container */
    .cropper-container {
        position: relative;
        width: 100%;
        height: 400px;
        background: #1a1a2e;
        border-radius: var(--radius);
        overflow: hidden;
        display: none;
    }
    .cropper-container.active { display: block; }
    #cropperImage {
        max-width: 100%;
        max-height: 100%;
        display: block;
    }

    /* Crop Controls */
    .crop-controls {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 12px;
    }

    /* Output Panel */
    .output-info {
        background: var(--bg-input);
        border-radius: var(--radius);
        padding: 15px;
        margin-bottom: 15px;
    }
    .output-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
        font-size: 0.9rem;
    }
    .output-row:last-child { border-bottom: none; }
    .output-row .label { color: var(--text-muted); }
    .output-row .value { font-weight: 500; }
    .output-row .value.success { color: var(--success); }
    .output-row .value.warning { color: var(--warning); }

    /* Status Messages */
    .status {
        padding: 10px 15px;
        border-radius: var(--radius);
        font-size: 0.9rem;
        margin-bottom: 15px;
        display: none;
    }
    .status.show { display: flex; align-items: center; gap: 10px; }
    .status.processing {
        background: rgba(79,70,229,0.2);
        border: 1px solid var(--primary);
        color: var(--primary);
    }
    .status.success {
        background: rgba(16,185,129,0.2);
        border: 1px solid var(--success);
        color: var(--success);
    }
    .status.error {
        background: rgba(239,68,68,0.2);
        border: 1px solid var(--danger);
        color: var(--danger);
    }
    .spinner {
        width: 16px;
        height: 16px;
        border: 2px solid currentColor;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Instructions */
    .instructions {
        background: var(--bg-card);
        border-radius: var(--radius);
        padding: 20px;
        margin-top: 20px;
        border: 1px solid var(--border);
    }
    .instructions h2 {
        font-size: 1.1rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .instructions ol {
        margin-left: 20px;
        color: var(--text-muted);
    }
    .instructions li { margin-bottom: 8px; }
    .instructions .note {
        margin-top: 15px;
        padding: 12px;
        background: rgba(245,158,11,0.1);
        border: 1px solid rgba(245,158,11,0.3);
        border-radius: var(--radius);
        font-size: 0.85rem;
        color: var(--warning);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-input); border-radius: 3px; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

    /* Cropper.js Overrides */
    .cropper-view-box, .cropper-face { border-radius: 0; }
    .cropper-line { background-color: var(--primary); }
    .cropper-point { background-color: var(--primary); }
    .cropper-modal { background-color: rgba(0,0,0,0.7); }
    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
</head>
<body>
    <!-- UI -->
    <div class="container">
        <header class="header">
            <h1>ğŸ“· è¯ä»¶ç…§è£å‰ª & é€æ˜æ–‡å­—æ°´å°</h1>
            <a href="index.html" class="back-link">â† è¿”å›å·¥å…·ç®±</a>
        </header>

        <div class="privacy-banner">
            <div class="icon">ğŸ”’</div>
            <div class="text">
                <h3>æœ¬å·¥å…·å®Œå…¨ç¦»çº¿è¿è¡Œ</h3>
                <p>æ‰€æœ‰å›¾ç‰‡å¤„ç†å‡åœ¨æœ¬åœ°æµè§ˆå™¨å®Œæˆï¼Œæ— ä»»ä½•ç½‘ç»œè¯·æ±‚ï¼Œé€‚åˆèº«ä»½è¯ã€é©¾ç…§ã€æŠ¤ç…§ç­‰æ•æ„Ÿè¯ä»¶å¤„ç†ã€‚åˆ·æ–°é¡µé¢å³æ¸…ç©ºæ‰€æœ‰æ•°æ®ã€‚</p>
            </div>
        </div>

        <!-- åŠŸèƒ½ç‰¹ç‚¹åŒºå— -->
        <section class="features-section" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div class="feature-card" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px;">
                <div style="font-size: 2rem; margin-bottom: 12px;">ğŸ“</div>
                <h3 style="font-size: 1rem; margin-bottom: 8px; color: var(--text);">å¤šç§è§„æ ¼</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); line-height: 1.5;">æ”¯æŒä¸€å¯¸ã€äºŒå¯¸ã€å°ä¸€å¯¸ã€æŠ¤ç…§ç­‰å¸¸ç”¨è¯ä»¶ç…§å°ºå¯¸ï¼Œæ»¡è¶³å„ç±»è¯ä»¶éœ€æ±‚</p>
            </div>
            <div class="feature-card" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px;">
                <div style="font-size: 2rem; margin-bottom: 12px;">ğŸ¨</div>
                <h3 style="font-size: 1rem; margin-bottom: 8px; color: var(--text);">èƒŒæ™¯æ›´æ¢</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); line-height: 1.5;">ä¸€é”®æ›´æ¢çº¢ã€è“ã€ç™½ç­‰æ ‡å‡†è¯ä»¶ç…§èƒŒæ™¯è‰²ï¼Œä¹Ÿå¯è‡ªå®šä¹‰é¢œè‰²</p>
            </div>
            <div class="feature-card" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px;">
                <div style="font-size: 2rem; margin-bottom: 12px;">âœ‚ï¸</div>
                <h3 style="font-size: 1rem; margin-bottom: 8px; color: var(--text);">æ™ºèƒ½è£å‰ª</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); line-height: 1.5;">è‡ªç”±è°ƒæ•´è£å‰ªæ¡†ä½ç½®ï¼Œç²¾ç¡®æ§åˆ¶ç…§ç‰‡æ„å›¾æ¯”ä¾‹</p>
            </div>
            <div class="feature-card" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px;">
                <div style="font-size: 2rem; margin-bottom: 12px;">ğŸ”</div>
                <h3 style="font-size: 1rem; margin-bottom: 8px; color: var(--text);">å³æ‹å³ç”¨</h3>
                <p style="font-size: 0.85rem; color: var(--text-muted); line-height: 1.5;">çº¯å‰ç«¯å¤„ç†ï¼Œæ— éœ€ä¸Šä¼ æœåŠ¡å™¨ï¼Œä¿æŠ¤æ‚¨çš„éšç§å®‰å…¨</p>
            </div>
        </section>

        <div class="main-layout">
            <!-- Left Panel: Settings -->
            <div class="settings-panel">
                <!-- Upload -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-header">ğŸ“ å›¾ç‰‡å¯¼å…¥</div>
                    <div class="card-body">
                        <div class="upload-area" id="uploadArea">
                            <div class="icon">ğŸ“¤</div>
                            <h3>æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
                            <p>æ”¯æŒ JPG / PNG / WEBP</p>
                            <input type="file" id="fileInput" accept="image/jpeg,image/png,image/webp" multiple>
                        </div>
                        <div class="image-list" id="imageList"></div>
                    </div>
                </div>

                <!-- Settings Tabs -->
                <div class="card">
                    <div class="tabs">
                        <button class="tab active" data-tab="crop">è£å‰ª</button>
                        <button class="tab" data-tab="resize">å°ºå¯¸</button>
                        <button class="tab" data-tab="compress">å‹ç¼©</button>
                        <button class="tab" data-tab="watermark">æ°´å°</button>
                    </div>

                    <!-- Crop Tab -->
                    <div class="tab-content active" id="tab-crop">
                        <div class="form-group">
                            <label class="form-label">è¯ä»¶ç…§è§„æ ¼</label>
                            <div class="preset-grid">
                                <button class="preset-btn" data-ratio="0.71" data-w="295" data-h="413">
                                    1å¯¸ <small>25Ã—35mm</small>
                                </button>
                                <button class="preset-btn" data-ratio="0.77" data-w="413" data-h="531">
                                    2å¯¸ <small>35Ã—45mm</small>
                                </button>
                                <button class="preset-btn" data-ratio="0.75" data-w="390" data-h="520">
                                    å°2å¯¸ <small>33Ã—48mm</small>
                                </button>
                                <button class="preset-btn" data-ratio="0.77" data-w="413" data-h="531">
                                    æŠ¤ç…§ç…§ <small>35Ã—45mm</small>
                                </button>
                                <button class="preset-btn" data-ratio="0.63" data-w="358" data-h="441">
                                    é©¾ç…§ç…§ <small>22Ã—32mm</small>
                                </button>
                                <button class="preset-btn active" data-ratio="0">
                                    è‡ªç”±è£å‰ª <small>ä»»æ„æ¯”ä¾‹</small>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ—‹è½¬è§’åº¦</label>
                            <div class="btn-group">
                                <button class="btn btn-outline btn-sm" onclick="rotateImage(-90)">â†º å·¦è½¬90Â°</button>
                                <button class="btn btn-outline btn-sm" onclick="rotateImage(90)">â†» å³è½¬90Â°</button>
                                <button class="btn btn-outline btn-sm" onclick="rotateImage(180)">âŸ² 180Â°</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary btn-block" onclick="applyCrop()">âœ‚ï¸ åº”ç”¨è£å‰ª</button>
                        </div>
                    </div>

                    <!-- Resize Tab -->
                    <div class="tab-content" id="tab-resize">
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="lockRatio" checked>
                                <span>ğŸ”— é”å®šç­‰æ¯”ç¼©æ”¾</span>
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">å®½åº¦ (px)</label>
                                <input type="number" class="form-input" id="targetWidth" placeholder="è‡ªåŠ¨">
                            </div>
                            <div class="form-group">
                                <label class="form-label">é«˜åº¦ (px)</label>
                                <input type="number" class="form-input" id="targetHeight" placeholder="è‡ªåŠ¨">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¡«å……èƒŒæ™¯è‰²</label>
                            <div class="color-picker-group">
                                <input type="color" id="bgColor" value="#ffffff">
                                <input type="text" class="form-input" id="bgColorText" value="#ffffff">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="transparentBg">
                                <span>é€æ˜èƒŒæ™¯ (ä»…PNG)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Compress Tab -->
                    <div class="tab-content" id="tab-compress">
                        <div class="form-group">
                            <label class="form-label">è¾“å‡ºæ ¼å¼</label>
                            <select class="form-select" id="outputFormat">
                                <option value="image/jpeg">JPEG</option>
                                <option value="image/png">PNG</option>
                                <option value="image/webp">WEBP</option>
                            </select>
                        </div>
                        <div class="form-group" id="qualityGroup">
                            <label class="form-label">å›¾ç‰‡è´¨é‡</label>
                            <div class="range-group">
                                <input type="range" id="quality" min="10" max="100" value="85">
                                <span class="range-value" id="qualityValue">85%</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="targetSizeMode">
                                <span>ç›®æ ‡æ–‡ä»¶å¤§å°æ¨¡å¼</span>
                            </label>
                        </div>
                        <div class="form-group" id="targetSizeGroup" style="display: none;">
                            <label class="form-label">ç›®æ ‡å¤§å° (KB)</label>
                            <input type="number" class="form-input" id="targetSize" value="100" min="10">
                            <small style="color: var(--text-muted); font-size: 0.75rem;">å…è®¸ Â±10% è¯¯å·®</small>
                        </div>
                    </div>

                    <!-- Watermark Tab -->
                    <div class="tab-content" id="tab-watermark">
                        <div class="form-group">
                            <label class="form-checkbox">
                                <input type="checkbox" id="enableWatermark">
                                <span>å¯ç”¨æ°´å°</span>
                            </label>
                        </div>
                        <div id="watermarkSettings" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">æ°´å°æ–‡å­—</label>
                                <input type="text" class="form-input" id="watermarkText" placeholder="è¾“å…¥æ°´å°æ–‡å­—" value="ä»…ä¾›xxxä½¿ç”¨">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">å­—ä½“å¤§å°</label>
                                    <input type="number" class="form-input" id="watermarkSize" value="24" min="10" max="200">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">æ—‹è½¬è§’åº¦</label>
                                    <input type="number" class="form-input" id="watermarkRotate" value="-30" min="-180" max="180">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">æ°´å°é¢œè‰²</label>
                                <div class="color-picker-group">
                                    <input type="color" id="watermarkColor" value="#ff0000">
                                    <input type="text" class="form-input" id="watermarkColorText" value="#ff0000">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">é€æ˜åº¦</label>
                                <div class="range-group">
                                    <input type="range" id="watermarkOpacity" min="5" max="100" value="30">
                                    <span class="range-value" id="opacityValue">30%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">æ°´å°æ¨¡å¼</label>
                                <select class="form-select" id="watermarkMode">
                                    <option value="single">å•ç‚¹æ°´å°</option>
                                    <option value="tile" selected>å¹³é“ºæ°´å°</option>
                                </select>
                            </div>
                            <div id="singleWatermarkPos" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">æ°´å°ä½ç½®</label>
                                    <div class="position-grid">
                                        <button class="position-btn" data-pos="tl">å·¦ä¸Š</button>
                                        <button class="position-btn" data-pos="tc">ä¸­ä¸Š</button>
                                        <button class="position-btn" data-pos="tr">å³ä¸Š</button>
                                        <button class="position-btn" data-pos="ml">å·¦ä¸­</button>
                                        <button class="position-btn active" data-pos="mc">ä¸­å¿ƒ</button>
                                        <button class="position-btn" data-pos="mr">å³ä¸­</button>
                                        <button class="position-btn" data-pos="bl">å·¦ä¸‹</button>
                                        <button class="position-btn" data-pos="bc">ä¸­ä¸‹</button>
                                        <button class="position-btn" data-pos="br">å³ä¸‹</button>
                                    </div>
                                </div>
                            </div>
                            <div id="tileWatermarkSettings">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">æ°´å¹³é—´è·</label>
                                        <input type="number" class="form-input" id="tileSpacingX" value="100" min="20">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">å‚ç›´é—´è·</label>
                                        <input type="number" class="form-input" id="tileSpacingY" value="80" min="20">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center: Preview -->
            <div class="preview-panel">
                <div class="card">
                    <div class="card-header">
                        ğŸ‘ï¸ é¢„è§ˆ
                        <div style="margin-left: auto; display: flex; gap: 8px;">
                            <button class="btn btn-sm btn-outline" onclick="resetCropper()">é‡ç½®</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="statusMessage" class="status"></div>

                        <div class="cropper-container" id="cropperContainer">
                            <img id="cropperImage" src="">
                        </div>

                        <div class="preview-container" id="previewContainer">
                            <div class="placeholder">
                                <div class="icon">ğŸ–¼ï¸</div>
                                <p>è¯·å…ˆä¸Šä¼ å›¾ç‰‡</p>
                            </div>
                        </div>

                        <div class="crop-controls" id="cropControls" style="display: none;">
                            <button class="btn btn-sm btn-outline" onclick="zoomCropper(0.1)">ğŸ”+</button>
                            <button class="btn btn-sm btn-outline" onclick="zoomCropper(-0.1)">ğŸ”-</button>
                            <button class="btn btn-sm btn-outline" onclick="resetCropper()">â†º é‡ç½®</button>
                        </div>
                    </div>
                </div>

                <div class="instructions">
                    <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>
                    <ol>
                        <li><strong>ä¸Šä¼ å›¾ç‰‡</strong>ï¼šç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ éœ€è¦å¤„ç†çš„è¯ä»¶ç…§ï¼ˆæ”¯æŒæ‰¹é‡ï¼‰</li>
                        <li><strong>è£å‰ªè®¾ç½®</strong>ï¼šé€‰æ‹©è¯ä»¶ç…§è§„æ ¼æˆ–è‡ªç”±è£å‰ªï¼Œè°ƒæ•´è£å‰ªæ¡†</li>
                        <li><strong>å°ºå¯¸è°ƒæ•´</strong>ï¼šè®¾ç½®ç›®æ ‡åƒç´ å°ºå¯¸ï¼Œå¯é”å®šç­‰æ¯”ç¼©æ”¾</li>
                        <li><strong>å‹ç¼©è®¾ç½®</strong>ï¼šé€‰æ‹©è¾“å‡ºæ ¼å¼å’Œè´¨é‡ï¼Œæˆ–è®¾ç½®ç›®æ ‡æ–‡ä»¶å¤§å°</li>
                        <li><strong>æ·»åŠ æ°´å°</strong>ï¼šè®¾ç½®æ°´å°æ–‡å­—ã€é¢œè‰²ã€é€æ˜åº¦å’Œä½ç½®</li>
                        <li><strong>å¯¼å‡ºä¸‹è½½</strong>ï¼šç‚¹å‡»"ç”Ÿæˆé¢„è§ˆ"ç¡®è®¤æ•ˆæœï¼Œç„¶åä¸‹è½½</li>
                    </ol>
                    <div class="note">
                        <strong>âš ï¸ æ³¨æ„ï¼š</strong>è¶…å¤§å›¾ç‰‡ï¼ˆ>4000pxï¼‰ä¼šè‡ªåŠ¨ç¼©æ”¾ä»¥ä¿æŠ¤æµè§ˆå™¨æ€§èƒ½ã€‚
                    </div>
                </div>
            </div>

            <!-- Right Panel: Output -->
            <div class="output-panel">
                <div class="card">
                    <div class="card-header">ğŸ“¤ è¾“å‡ºè®¾ç½®</div>
                    <div class="card-body">
                        <div class="output-info">
                            <div class="output-row">
                                <span class="label">åŸå§‹å°ºå¯¸</span>
                                <span class="value" id="originalSize">-</span>
                            </div>
                            <div class="output-row">
                                <span class="label">åŸå§‹å¤§å°</span>
                                <span class="value" id="originalFileSize">-</span>
                            </div>
                            <div class="output-row">
                                <span class="label">è¾“å‡ºå°ºå¯¸</span>
                                <span class="value" id="outputSize">-</span>
                            </div>
                            <div class="output-row">
                                <span class="label">è¾“å‡ºå¤§å°</span>
                                <span class="value" id="outputFileSize">-</span>
                            </div>
                            <div class="output-row">
                                <span class="label">å‹ç¼©æ¯”ä¾‹</span>
                                <span class="value" id="compressionRatio">-</span>
                            </div>
                        </div>

                        <div class="btn-group" style="flex-direction: column;">
                            <button class="btn btn-primary btn-block" id="previewBtn" onclick="generatePreview()" disabled>
                                ğŸ‘ï¸ ç”Ÿæˆé¢„è§ˆ
                            </button>
                            <button class="btn btn-success btn-block" id="downloadBtn" onclick="downloadImage()" disabled>
                                ğŸ’¾ ä¸‹è½½å›¾ç‰‡
                            </button>
                            <button class="btn btn-outline btn-block" id="batchDownloadBtn" onclick="batchDownload()" style="display: none;">
                                ğŸ“¦ æ‰¹é‡ä¸‹è½½ (ZIP)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- LOGIC -->
    <script>
    (function() {
        'use strict';

        // State
        let images = [];
        let currentIndex = -1;
        let cropper = null;
        let processedBlob = null;
        let originalRatio = 1;

        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imageList = document.getElementById('imageList');
        const cropperContainer = document.getElementById('cropperContainer');
        const cropperImage = document.getElementById('cropperImage');
        const previewContainer = document.getElementById('previewContainer');
        const cropControls = document.getElementById('cropControls');
        const statusMessage = document.getElementById('statusMessage');
        const previewBtn = document.getElementById('previewBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const batchDownloadBtn = document.getElementById('batchDownloadBtn');

        // Tab Switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // Preset Buttons
        document.querySelectorAll('.preset-btn[data-ratio]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn[data-ratio]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const ratio = parseFloat(btn.dataset.ratio);
                if (cropper) {
                    if (ratio === 0) {
                        cropper.setAspectRatio(NaN);
                    } else {
                        cropper.setAspectRatio(ratio);
                    }
                }
                // Set target dimensions if specified
                if (btn.dataset.w && btn.dataset.h) {
                    document.getElementById('targetWidth').value = btn.dataset.w;
                    document.getElementById('targetHeight').value = btn.dataset.h;
                }
            });
        });

        // Position Buttons
        document.querySelectorAll('.position-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.position-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // File Upload
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            const validTypes = ['image/jpeg', 'image/png', 'image/webp'];
            Array.from(files).forEach(file => {
                if (!validTypes.includes(file.type)) {
                    showStatus('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: ' + file.name, 'error');
                    return;
                }
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        // Check for oversized images
                        let width = img.width;
                        let height = img.height;
                        let scaled = false;
                        const maxDim = 4000;
                        if (width > maxDim || height > maxDim) {
                            const scale = maxDim / Math.max(width, height);
                            width = Math.round(width * scale);
                            height = Math.round(height * scale);
                            scaled = true;
                            showStatus('å¤§å›¾å·²è‡ªåŠ¨ç¼©æ”¾ä»¥ä¿æŠ¤æ€§èƒ½', 'warning');
                        }

                        images.push({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            width: img.width,
                            height: img.height,
                            scaledWidth: width,
                            scaledHeight: height,
                            scaled: scaled,
                            dataUrl: e.target.result,
                            processed: false
                        });

                        renderImageList();
                        if (images.length === 1) {
                            selectImage(0);
                        }
                        updateBatchButton();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function renderImageList() {
            imageList.innerHTML = images.map((img, i) => `
                <div class="image-item ${i === currentIndex ? 'active' : ''}" onclick="selectImage(${i})">
                    <img src="${img.dataUrl}" alt="${img.name}">
                    <div class="info">
                        <div class="name">${img.name}</div>
                        <div class="meta">${img.width}Ã—${img.height} Â· ${formatSize(img.size)}</div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-outline btn-icon" onclick="event.stopPropagation(); removeImage(${i})">âœ•</button>
                    </div>
                </div>
            `).join('');
        }

        window.selectImage = function(index) {
            currentIndex = index;
            renderImageList();
            loadImageToCropper(images[index]);
            previewBtn.disabled = false;
            downloadBtn.disabled = true;
            processedBlob = null;

            // Update original info
            const img = images[index];
            document.getElementById('originalSize').textContent = `${img.width}Ã—${img.height}`;
            document.getElementById('originalFileSize').textContent = formatSize(img.size);
            document.getElementById('outputSize').textContent = '-';
            document.getElementById('outputFileSize').textContent = '-';
            document.getElementById('compressionRatio').textContent = '-';
        };

        window.removeImage = function(index) {
            images.splice(index, 1);
            if (currentIndex >= images.length) currentIndex = images.length - 1;
            renderImageList();
            if (images.length === 0) {
                resetUI();
            } else if (currentIndex >= 0) {
                selectImage(currentIndex);
            }
            updateBatchButton();
        };

        function loadImageToCropper(imgData) {
            cropperContainer.classList.add('active');
            previewContainer.style.display = 'none';
            cropControls.style.display = 'flex';

            if (cropper) {
                cropper.destroy();
            }

            cropperImage.src = imgData.dataUrl;
            originalRatio = imgData.width / imgData.height;

            cropperImage.onload = () => {
                const activePreset = document.querySelector('.preset-btn[data-ratio].active');
                const ratio = activePreset ? parseFloat(activePreset.dataset.ratio) : 0;

                cropper = new Cropper(cropperImage, {
                    aspectRatio: ratio === 0 ? NaN : ratio,
                    viewMode: 1,
                    dragMode: 'move',
                    autoCropArea: 0.8,
                    restore: false,
                    guides: true,
                    center: true,
                    highlight: true,
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                    toggleDragModeOnDblclick: true,
                    background: true,
                });
            };
        }

        window.rotateImage = function(deg) {
            if (cropper) {
                cropper.rotate(deg);
            }
        };

        window.zoomCropper = function(ratio) {
            if (cropper) {
                cropper.zoom(ratio);
            }
        };

        window.resetCropper = function() {
            if (cropper) {
                cropper.reset();
            }
        };

        window.applyCrop = function() {
            if (!cropper) return;
            showStatus('æ­£åœ¨åº”ç”¨è£å‰ª...', 'processing');

            setTimeout(() => {
                const canvas = cropper.getCroppedCanvas();
                if (canvas) {
                    images[currentIndex].croppedDataUrl = canvas.toDataURL();
                    images[currentIndex].croppedWidth = canvas.width;
                    images[currentIndex].croppedHeight = canvas.height;
                    showStatus('è£å‰ªå·²åº”ç”¨', 'success');
                }
            }, 100);
        };

        // Form Bindings
        document.getElementById('quality').addEventListener('input', (e) => {
            document.getElementById('qualityValue').textContent = e.target.value + '%';
        });

        document.getElementById('watermarkOpacity').addEventListener('input', (e) => {
            document.getElementById('opacityValue').textContent = e.target.value + '%';
        });

        document.getElementById('bgColor').addEventListener('input', (e) => {
            document.getElementById('bgColorText').value = e.target.value;
        });
        document.getElementById('bgColorText').addEventListener('input', (e) => {
            document.getElementById('bgColor').value = e.target.value;
        });

        document.getElementById('watermarkColor').addEventListener('input', (e) => {
            document.getElementById('watermarkColorText').value = e.target.value;
        });
        document.getElementById('watermarkColorText').addEventListener('input', (e) => {
            document.getElementById('watermarkColor').value = e.target.value;
        });

        document.getElementById('outputFormat').addEventListener('change', (e) => {
            const qualityGroup = document.getElementById('qualityGroup');
            qualityGroup.style.display = e.target.value === 'image/png' ? 'none' : 'block';
        });

        document.getElementById('targetSizeMode').addEventListener('change', (e) => {
            document.getElementById('targetSizeGroup').style.display = e.target.checked ? 'block' : 'none';
            document.getElementById('qualityGroup').style.display = e.target.checked ? 'none' : 'block';
        });

        document.getElementById('enableWatermark').addEventListener('change', (e) => {
            document.getElementById('watermarkSettings').style.display = e.target.checked ? 'block' : 'none';
        });

        document.getElementById('watermarkMode').addEventListener('change', (e) => {
            document.getElementById('singleWatermarkPos').style.display = e.target.value === 'single' ? 'block' : 'none';
            document.getElementById('tileWatermarkSettings').style.display = e.target.value === 'tile' ? 'block' : 'none';
        });

        document.getElementById('lockRatio').addEventListener('change', updateRatioLock);
        document.getElementById('targetWidth').addEventListener('input', () => {
            if (document.getElementById('lockRatio').checked && originalRatio) {
                const w = parseInt(document.getElementById('targetWidth').value) || 0;
                document.getElementById('targetHeight').value = Math.round(w / originalRatio);
            }
        });
        document.getElementById('targetHeight').addEventListener('input', () => {
            if (document.getElementById('lockRatio').checked && originalRatio) {
                const h = parseInt(document.getElementById('targetHeight').value) || 0;
                document.getElementById('targetWidth').value = Math.round(h * originalRatio);
            }
        });

        function updateRatioLock() {
            if (currentIndex >= 0) {
                const img = images[currentIndex];
                if (img.croppedWidth && img.croppedHeight) {
                    originalRatio = img.croppedWidth / img.croppedHeight;
                } else {
                    originalRatio = img.width / img.height;
                }
            }
        }

        // Generate Preview
        window.generatePreview = async function() {
            if (currentIndex < 0) return;

            showStatus('æ­£åœ¨å¤„ç†å›¾ç‰‡...', 'processing');
            previewBtn.disabled = true;

            try {
                const result = await processImage(images[currentIndex]);
                processedBlob = result.blob;

                // Show preview
                cropperContainer.classList.remove('active');
                previewContainer.style.display = 'flex';
                cropControls.style.display = 'none';

                const url = URL.createObjectURL(processedBlob);
                previewContainer.innerHTML = `<canvas id="previewCanvas"></canvas>`;
                const previewCanvas = document.getElementById('previewCanvas');
                const ctx = previewCanvas.getContext('2d');

                const img = new Image();
                img.onload = () => {
                    previewCanvas.width = img.width;
                    previewCanvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    URL.revokeObjectURL(url);
                };
                img.src = url;

                // Update output info
                document.getElementById('outputSize').textContent = `${result.width}Ã—${result.height}`;
                document.getElementById('outputFileSize').textContent = formatSize(processedBlob.size);
                const ratio = ((1 - processedBlob.size / images[currentIndex].size) * 100).toFixed(1);
                const ratioEl = document.getElementById('compressionRatio');
                ratioEl.textContent = (ratio > 0 ? '-' : '+') + Math.abs(ratio) + '%';
                ratioEl.className = 'value ' + (ratio > 0 ? 'success' : 'warning');

                downloadBtn.disabled = false;
                showStatus('å¤„ç†å®Œæˆ', 'success');

            } catch (err) {
                showStatus('å¤„ç†å¤±è´¥: ' + err.message, 'error');
            }

            previewBtn.disabled = false;
        };

        async function processImage(imgData) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    // Determine source dimensions
                    let srcCanvas;
                    if (cropper && imgData === images[currentIndex]) {
                        srcCanvas = cropper.getCroppedCanvas();
                    } else {
                        srcCanvas = document.createElement('canvas');
                        srcCanvas.width = img.width;
                        srcCanvas.height = img.height;
                        srcCanvas.getContext('2d').drawImage(img, 0, 0);
                    }

                    // Target dimensions
                    let targetW = parseInt(document.getElementById('targetWidth').value) || srcCanvas.width;
                    let targetH = parseInt(document.getElementById('targetHeight').value) || srcCanvas.height;

                    // Apply size limits
                    const maxDim = 4000;
                    if (targetW > maxDim || targetH > maxDim) {
                        const scale = maxDim / Math.max(targetW, targetH);
                        targetW = Math.round(targetW * scale);
                        targetH = Math.round(targetH * scale);
                    }

                    canvas.width = targetW;
                    canvas.height = targetH;

                    // Background
                    const format = document.getElementById('outputFormat').value;
                    const transparentBg = document.getElementById('transparentBg').checked;
                    if (!transparentBg || format === 'image/jpeg') {
                        ctx.fillStyle = document.getElementById('bgColor').value;
                        ctx.fillRect(0, 0, targetW, targetH);
                    }

                    // Draw image (centered if aspect ratio differs)
                    const srcRatio = srcCanvas.width / srcCanvas.height;
                    const targetRatio = targetW / targetH;
                    let drawW, drawH, drawX, drawY;

                    if (Math.abs(srcRatio - targetRatio) < 0.01) {
                        drawW = targetW;
                        drawH = targetH;
                        drawX = 0;
                        drawY = 0;
                    } else if (srcRatio > targetRatio) {
                        drawW = targetW;
                        drawH = targetW / srcRatio;
                        drawX = 0;
                        drawY = (targetH - drawH) / 2;
                    } else {
                        drawH = targetH;
                        drawW = targetH * srcRatio;
                        drawX = (targetW - drawW) / 2;
                        drawY = 0;
                    }

                    ctx.drawImage(srcCanvas, drawX, drawY, drawW, drawH);

                    // Watermark
                    if (document.getElementById('enableWatermark').checked) {
                        const text = document.getElementById('watermarkText').value || 'æ°´å°';
                        const size = parseInt(document.getElementById('watermarkSize').value) || 24;
                        const color = document.getElementById('watermarkColor').value;
                        const opacity = parseInt(document.getElementById('watermarkOpacity').value) / 100;
                        const rotate = parseInt(document.getElementById('watermarkRotate').value) || 0;
                        const mode = document.getElementById('watermarkMode').value;

                        ctx.font = `${size}px sans-serif`;
                        ctx.fillStyle = color;
                        ctx.globalAlpha = opacity;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';

                        if (mode === 'tile') {
                            const spacingX = parseInt(document.getElementById('tileSpacingX').value) || 100;
                            const spacingY = parseInt(document.getElementById('tileSpacingY').value) || 80;
                            const textWidth = ctx.measureText(text).width;
                            const stepX = textWidth + spacingX;
                            const stepY = size + spacingY;

                            for (let y = -targetH; y < targetH * 2; y += stepY) {
                                for (let x = -targetW; x < targetW * 2; x += stepX) {
                                    ctx.save();
                                    ctx.translate(x, y);
                                    ctx.rotate(rotate * Math.PI / 180);
                                    ctx.fillText(text, 0, 0);
                                    ctx.restore();
                                }
                            }
                        } else {
                            const pos = document.querySelector('.position-btn.active')?.dataset.pos || 'mc';
                            let x, y;
                            switch(pos) {
                                case 'tl': x = size * 2; y = size * 2; break;
                                case 'tc': x = targetW / 2; y = size * 2; break;
                                case 'tr': x = targetW - size * 2; y = size * 2; break;
                                case 'ml': x = size * 2; y = targetH / 2; break;
                                case 'mc': x = targetW / 2; y = targetH / 2; break;
                                case 'mr': x = targetW - size * 2; y = targetH / 2; break;
                                case 'bl': x = size * 2; y = targetH - size * 2; break;
                                case 'bc': x = targetW / 2; y = targetH - size * 2; break;
                                case 'br': x = targetW - size * 2; y = targetH - size * 2; break;
                                default: x = targetW / 2; y = targetH / 2;
                            }
                            ctx.save();
                            ctx.translate(x, y);
                            ctx.rotate(rotate * Math.PI / 180);
                            ctx.fillText(text, 0, 0);
                            ctx.restore();
                        }

                        ctx.globalAlpha = 1;
                    }

                    // Export
                    let quality = parseInt(document.getElementById('quality').value) / 100;
                    const targetSizeMode = document.getElementById('targetSizeMode').checked;
                    const targetSizeKB = parseInt(document.getElementById('targetSize').value) || 100;

                    if (targetSizeMode && format !== 'image/png') {
                        // Binary search for target size
                        let minQ = 0.1, maxQ = 1.0;
                        let blob;
                        for (let i = 0; i < 10; i++) {
                            quality = (minQ + maxQ) / 2;
                            canvas.toBlob((b) => { blob = b; }, format, quality);
                            // Sync workaround
                            const dataUrl = canvas.toDataURL(format, quality);
                            const size = Math.round(dataUrl.length * 0.75 / 1024);
                            if (size > targetSizeKB * 1.1) {
                                maxQ = quality;
                            } else if (size < targetSizeKB * 0.9) {
                                minQ = quality;
                            } else {
                                break;
                            }
                        }
                    }

                    canvas.toBlob((blob) => {
                        resolve({
                            blob,
                            width: targetW,
                            height: targetH
                        });
                    }, format, format === 'image/png' ? undefined : quality);
                };
                img.onerror = () => reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                img.src = imgData.croppedDataUrl || imgData.dataUrl;
            });
        }

        // Download
        window.downloadImage = function() {
            if (!processedBlob) return;

            const format = document.getElementById('outputFormat').value;
            const ext = format.split('/')[1];
            const name = images[currentIndex].name.replace(/\.[^.]+$/, '') + '_processed.' + ext;

            const url = URL.createObjectURL(processedBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            URL.revokeObjectURL(url);

            showStatus('ä¸‹è½½å·²å¼€å§‹', 'success');
        };

        // Batch Download
        window.batchDownload = async function() {
            if (images.length < 2) return;

            showStatus('æ­£åœ¨æ‰¹é‡å¤„ç†...', 'processing');
            batchDownloadBtn.disabled = true;

            try {
                const zip = new JSZip();
                const format = document.getElementById('outputFormat').value;
                const ext = format.split('/')[1];

                for (let i = 0; i < images.length; i++) {
                    showStatus(`æ­£åœ¨å¤„ç† ${i + 1}/${images.length}...`, 'processing');
                    const result = await processImage(images[i]);
                    const name = images[i].name.replace(/\.[^.]+$/, '') + '_processed.' + ext;
                    zip.file(name, result.blob);
                }

                showStatus('æ­£åœ¨æ‰“åŒ…ZIP...', 'processing');
                const zipBlob = await zip.generateAsync({ type: 'blob' });

                const url = URL.createObjectURL(zipBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'processed_photos.zip';
                a.click();
                URL.revokeObjectURL(url);

                showStatus('æ‰¹é‡ä¸‹è½½å®Œæˆ', 'success');

            } catch (err) {
                showStatus('æ‰¹é‡å¤„ç†å¤±è´¥: ' + err.message, 'error');
            }

            batchDownloadBtn.disabled = false;
        };

        function updateBatchButton() {
            batchDownloadBtn.style.display = images.length > 1 ? 'flex' : 'none';
        }

        function resetUI() {
            currentIndex = -1;
            processedBlob = null;
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
            cropperContainer.classList.remove('active');
            previewContainer.style.display = 'flex';
            previewContainer.innerHTML = `
                <div class="placeholder">
                    <div class="icon">ğŸ–¼ï¸</div>
                    <p>è¯·å…ˆä¸Šä¼ å›¾ç‰‡</p>
                </div>
            `;
            cropControls.style.display = 'none';
            previewBtn.disabled = true;
            downloadBtn.disabled = true;
            document.getElementById('originalSize').textContent = '-';
            document.getElementById('originalFileSize').textContent = '-';
            document.getElementById('outputSize').textContent = '-';
            document.getElementById('outputFileSize').textContent = '-';
            document.getElementById('compressionRatio').textContent = '-';
        }

        function showStatus(message, type) {
            statusMessage.className = 'status show ' + type;
            statusMessage.innerHTML = type === 'processing'
                ? `<div class="spinner"></div><span>${message}</span>`
                : `<span>${message}</span>`;

            if (type !== 'processing') {
                setTimeout(() => {
                    statusMessage.classList.remove('show');
                }, 3000);
            }
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1024 / 1024).toFixed(2) + ' MB';
        }

    })();
    </script>

    <!-- FAQ é—®ç­”åŒºå— -->
    <section class="faq-section" style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
        <h2 style="color: #e6edf3; font-size: 20px; margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid #30363d;">â“ å¸¸è§é—®é¢˜</h2>
        <div class="faq-list" style="display: flex; flex-direction: column; gap: 16px;">
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 500; color: #e6edf3; list-style: none; display: flex; justify-content: space-between; align-items: center;">
                    æ”¯æŒå“ªäº›è¯ä»¶ç…§å°ºå¯¸ï¼Ÿ
                    <span style="color: #8b949e; font-size: 18px;">+</span>
                </summary>
                <div style="padding: 0 20px 16px; color: #8b949e; line-height: 1.7;">
                    æ”¯æŒä¸€å¯¸(25x35mm)ã€äºŒå¯¸(35x49mm)ã€å°ä¸€å¯¸(22x32mm)ã€æŠ¤ç…§(33x48mm)ç­‰å¸¸ç”¨è¯ä»¶ç…§å°ºå¯¸ã€‚æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©"è‡ªç”±è£å‰ª"æ¨¡å¼ï¼Œè‡ªå®šä¹‰ä»»æ„å°ºå¯¸ã€‚
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 500; color: #e6edf3; list-style: none; display: flex; justify-content: space-between; align-items: center;">
                    èƒŒæ™¯è‰²æœ‰å“ªäº›é€‰æ‹©ï¼Ÿ
                    <span style="color: #8b949e; font-size: 18px;">+</span>
                </summary>
                <div style="padding: 0 20px 16px; color: #8b949e; line-height: 1.7;">
                    æ”¯æŒçº¢è‰²ã€è“è‰²ã€ç™½è‰²ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„è¯ä»¶ç…§èƒŒæ™¯è‰²ã€‚åœ¨"å°ºå¯¸"è®¾ç½®ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡é¢œè‰²é€‰æ‹©å™¨è‡ªå®šä¹‰ä»»æ„èƒŒæ™¯é¢œè‰²ã€‚
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 500; color: #e6edf3; list-style: none; display: flex; justify-content: space-between; align-items: center;">
                    ç…§ç‰‡ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨å—ï¼Ÿ
                    <span style="color: #8b949e; font-size: 18px;">+</span>
                </summary>
                <div style="padding: 0 20px 16px; color: #8b949e; line-height: 1.7;">
                    ä¸ä¼šï¼Œæ‰€æœ‰å¤„ç†åœ¨æœ¬åœ°æµè§ˆå™¨å®Œæˆï¼Œç…§ç‰‡ä¸ä¼šç¦»å¼€æ‚¨çš„è®¾å¤‡ã€‚è¿™æ˜¯ä¸€æ¬¾å®Œå…¨ç¦»çº¿è¿è¡Œçš„å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†èº«ä»½è¯ã€æŠ¤ç…§ç­‰æ•æ„Ÿè¯ä»¶ç…§ç‰‡ã€‚åˆ·æ–°é¡µé¢åæ‰€æœ‰æ•°æ®ä¼šè‡ªåŠ¨æ¸…é™¤ã€‚
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 500; color: #e6edf3; list-style: none; display: flex; justify-content: space-between; align-items: center;">
                    å¯ä»¥ç”¨æ‰‹æœºæ‹æ‘„çš„ç…§ç‰‡å—ï¼Ÿ
                    <span style="color: #8b949e; font-size: 18px;">+</span>
                </summary>
                <div style="padding: 0 20px 16px; color: #8b949e; line-height: 1.7;">
                    å¯ä»¥ï¼Œå»ºè®®åœ¨å…‰çº¿å……è¶³çš„ç¯å¢ƒä¸‹æ‹æ‘„æ­£é¢ç…§ï¼Œä¿æŒèƒŒæ™¯ç®€æ´ã€‚ä¸Šä¼ åä½¿ç”¨è£å‰ªåŠŸèƒ½è°ƒæ•´åˆ°åˆé€‚çš„è¯ä»¶ç…§æ¯”ä¾‹å³å¯ã€‚
                </div>
            </details>
            <details style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden;">
                <summary style="padding: 16px 20px; cursor: pointer; font-weight: 500; color: #e6edf3; list-style: none; display: flex; justify-content: space-between; align-items: center;">
                    å¯¼å‡ºçš„ç…§ç‰‡åˆ†è¾¨ç‡æ˜¯å¤šå°‘ï¼Ÿ
                    <span style="color: #8b949e; font-size: 18px;">+</span>
                </summary>
                <div style="padding: 0 20px 16px; color: #8b949e; line-height: 1.7;">
                    æ ¹æ®é€‰æ‹©çš„è§„æ ¼å¯¼å‡ºæ ‡å‡†æ‰“å°åˆ†è¾¨ç‡(300dpi)ã€‚ä¾‹å¦‚ä¸€å¯¸ç…§ç‰‡ä¸º295x413åƒç´ ï¼ŒäºŒå¯¸ç…§ç‰‡ä¸º413x531åƒç´ ï¼Œæ»¡è¶³å„ç±»è¯ä»¶ç…§æ‰“å°éœ€æ±‚ã€‚
                </div>
            </details>
        </div>
    </section>

    <!-- ç›¸å…³å·¥å…·æ¨è -->
    <section class="related-tools" style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
        <h3 style="color: #e6edf3; font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #30363d;">ğŸ”— ç›¸å…³å·¥å…·æ¨è</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            <a href="image-compressor.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ—œï¸</div>
                <div style="color: #e6edf3; font-weight: 500;">å›¾ç‰‡å‹ç¼©</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;">åœ¨çº¿å‹ç¼©å›¾ç‰‡å¤§å°</div>
            </a>
            <a href="image-editor.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">âœï¸</div>
                <div style="color: #e6edf3; font-weight: 500;">å›¾ç‰‡ç¼–è¾‘å™¨</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;">è£å‰ªã€æ—‹è½¬ã€æ»¤é•œ</div>
            </a>
            <a href="image-converter.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ”„</div>
                <div style="color: #e6edf3; font-weight: 500;">å›¾ç‰‡æ ¼å¼è½¬æ¢</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;">PNG/JPG/WebP äº’è½¬</div>
            </a>
            <a href="ico-maker.html" style="display: block; padding: 16px; background: #161b22; border: 1px solid #30363d; border-radius: 8px; text-decoration: none; transition: all 0.2s;">
                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ¯</div>
                <div style="color: #e6edf3; font-weight: 500;">ICO å›¾æ ‡åˆ¶ä½œ</div>
                <div style="color: #8b949e; font-size: 12px; margin-top: 4px;">ç”Ÿæˆç½‘ç«™å›¾æ ‡</div>
            </a>
        </div>
    </section>

    <footer style="text-align: center; padding: 30px 20px; border-top: 1px solid #30363d; color: #8b949e; font-size: 14px;">
        <p>çº¯å‰ç«¯å¤„ç†ï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
        <p style="margin-top: 12px;">
            <a href="index.html" style="color: #58a6ff; text-decoration: none;">â† è¿”å› Web Toolbox é¦–é¡µ</a>
            <span style="margin: 0 12px;">|</span>
            <a href="https://github.com/heyuan110" target="_blank" rel="noopener" style="color: #58a6ff; text-decoration: none;">GitHub</a>
        </p>
    </footer>
</body>
</html>
